> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2025-01-26 - 2025-02-01

# Weekly #99

[readme](../README.md) | [previous](202501W4.md) | [next](202501W6.md)

![](../images/2025/01/sittinat-thurdnampetch-TpUvIVq6kcw-unsplash.jpg "Weekly #99")

\**Photo by [Sittinat Thurdnampetch](https://unsplash.com/@mosthurd) on [Unsplash](https://unsplash.com/photos/a-woman-holding-a-sparkler-in-her-hand-TpUvIVq6kcw)*

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
	- Linux è¿›ç¨‹æ ‡è¯†
- [tip](#tip-)
	- åœ¨çº¿PSå·¥å…·
    - C++ Lambda è¡¨è¾¾å¼
- [share](#share-)

## algorithm [ğŸ”](#weekly-99)

## review [ğŸ”](#weekly-99)

### 1. [Linux è¿›ç¨‹æ ‡è¯†](http://www.wowotech.net/process_management/process_identification.html)

ä¸€ã€æ¦‚è¿°

æœ¬æ–‡ä¸»è¦æè¿°åœ¨ linux kernel ä¸­å¦‚ä½•æ ‡è¯†ä¸€ä¸ªæˆ–è€…ä¸€ç»„å’Œè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ç›¸å…³çš„å®ä½“ï¼ŒåŒ…æ‹¬ï¼š

- è¿›ç¨‹ IDï¼ˆçº¿ç¨‹ç»„ IDï¼‰
- çº¿ç¨‹ ID
- è¿›ç¨‹ç»„ ID
- Session ID

éœ€è¦å¼ºè°ƒçš„æ˜¯æœ¬æ–‡ focus åœ¨ identificationï¼Œå¾ˆå¤šå±•å¼€çš„å†…å®¹ä¼šæœ‰ä¸€ç³»åˆ—æ–‡æ¡£æè¿°ã€‚

äºŒã€ä»€ä¹ˆæ˜¯è¿›ç¨‹ IDï¼ˆçº¿ç¨‹ç»„ IDï¼‰

ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬éƒ½ä¼šå®šä¹‰è¿›ç¨‹æ˜¯ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºæˆ–è€…æ˜¯ä¸€ä¸ªç¨‹åºçš„è¿è¡Œå®ä¾‹ã€‚ç¨‹åºæ˜¯ä¸€ä¸ªé™æ€çš„æ¦‚å¿µï¼Œæ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŒ…æ‹¬ç¨‹åºä»£ç å’Œæ•°æ®ï¼ˆæ­£æ–‡æ®µã€æ•°æ®æ®µç­‰ï¼‰ã€‚å½“ç¨‹åºè¿è¡Œèµ·æ¥æˆä¸ºè¿›ç¨‹çš„æ—¶å€™ï¼Œå•çº¯çš„ç¨‹åºä»£ç åˆ™ä¸èƒ½æ¸…æ¥šçš„æè¿°è¿›ç¨‹ï¼Œå®ƒè¿˜éœ€è¦è‹¥å¹²æ•°æ®ç»“æ„æ¥æè¿°ç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€ï¼ˆç¡¬ä»¶ä¸Šä¸‹æ–‡å’Œè½¯ä»¶ä¸Šä¸‹æ–‡ï¼‰ä»¥åŠæ‹¥æœ‰çš„èµ„æºï¼ˆå¦‚åœ°å€ç©ºé—´ã€æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ç­‰ï¼‰ã€‚ä»å†…æ ¸çš„è§’åº¦çœ‹ï¼Œè¿›ç¨‹æ˜¯ä¸€ä¸ªå’Œç³»ç»Ÿèµ„æºï¼ˆCPU timeã€memory ç­‰ï¼‰åˆ†é…ç›¸å…³çš„å®ä½“ã€‚

åœ¨ POSIX æ ‡å‡†ä¸­ï¼Œç³»ç»Ÿå®šä¹‰äº† getpid å‡½æ•°æ¥è·å–ä¸€ä¸ªè¿›ç¨‹çš„ process IDã€‚åœ¨ linux kernel ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```C
asmlinkage long sys_getpid(void) {
	return current->tgid;
}
```

ä»å­—é¢ä¸Šçœ‹ task_struct ä¸­çš„ tgid æ˜¯ thread group IDï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ç»„ IDï¼Œåœ¨ linux kernel ä¸­ï¼Œè¿›ç¨‹æ˜¯æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª thread ç»„æˆï¼ˆPOSIX è§„å®šå¤šä¸ª thread è¦å…±äº«ä¸€ä¸ªè¿›ç¨‹ IDï¼‰ã€‚å¯¹äº linux kernelï¼Œæ¯ä¸€ä¸ª thread åˆ†é…ä¸€ä¸ª task_structï¼ˆå…¶ä¸­æœ‰ä¸€ä¸ª pid çš„æ ‡è¯†ï¼‰ï¼Œè¿™å’Œå¤§éƒ¨åˆ†çš„ kernel å¤„ç†ä¸ä¸€æ ·ï¼Œå…¶ä»–çš„ kernel é’ˆå¯¹ä¸€ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ª task_structï¼Œåœ¨è¯¥ task_struct ä¸­åµŒå…¥äº†å±äºè¯¥è¿›ç¨‹çš„å„ä¸ªçº¿ç¨‹çš„æ•°æ®ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œlinux kernel åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç»„çš„æ¦‚å¿µæ¥æ˜ å°„åˆ° POSIX ä¸­çš„è¿›ç¨‹æ¦‚å¿µã€‚

å¤šçº¿ç¨‹çš„è¿›ç¨‹ä¸­ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼Œgroup leaderï¼‰çš„ pid ç­‰äº tgidï¼Œä¹‹åï¼Œè¯¥çº¿ç¨‹ç»„ä¸­çš„çº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ pidï¼Œä½†æ˜¯å…±äº« tgidï¼Œä¹Ÿå°±æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„è¿›ç¨‹ IDã€‚task_struct æœ‰ä¸€ä¸ª group_leader æˆå‘˜ï¼ŒæŒ‡å‘è¯¥ task çš„ thread group leaderï¼Œå¯¹äº group leaderï¼Œè¯¥æˆå‘˜æŒ‡å‘è‡ªå·±çš„ task_struct æ•°æ®ç»“æ„ã€‚

ä¸‰ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹ ID

çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªå®ä½“ï¼Œæ˜¯è¢«ç³»ç»Ÿç‹¬ç«‹è°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹è‡ªå·±ä¸ç‹¬ç«‹æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œå®ƒæ˜¯ä¸åŒå±ä¸€ä¸ªè¿›ç¨‹çš„å…¶å®ƒçº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æºï¼ˆå¦‚åœ°å€ç©ºé—´ã€æ–‡ä»¶æè¿°ç¬¦å’Œä¿¡å·å¤„ç†ï¼‰ã€‚è¿™é¦–å…ˆè¡¨ç°åœ¨ï¼šæ‰€æœ‰çº¿ç¨‹éƒ½å…·æœ‰ç›¸åŒçš„åœ°å€ç©ºé—´ï¼ˆè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼‰ï¼Œè¿™æ„å‘³ç€ï¼Œçº¿ç¨‹å¯ä»¥è®¿é—®è¯¥åœ°å€ç©ºé—´çš„æ¯ä¸€ä¸ªè™šåœ°å€ï¼›æ­¤å¤–ï¼Œè¿˜å¯ä»¥è®¿é—®è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å·²æ‰“å¼€æ–‡ä»¶ã€å®šæ—¶å™¨ã€ä¿¡å·é‡ç­‰èµ„æºã€‚è¿›ç¨‹æ˜¯èµ„æºç®¡ç†çš„æœ€å°å•å…ƒï¼Œè€Œçº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œçš„æœ€å°å•å…ƒã€‚é™¤äº†å…±äº«çš„è¿›ç¨‹èµ„æºï¼Œè¿›ç¨‹ä¸­çš„å„ä¸ªçº¿ç¨‹ä¹Ÿå±äºè‡ªå·±çš„èµ„æºï¼Œå…·ä½“åŒ…æ‹¬ï¼šstackã€PC counter å’Œ CPU å¯„å­˜å™¨ã€‚

æ¯ä¸ªçº¿ç¨‹åº”è¯¥æœ‰è‡ªå·±çš„ IDï¼Œå°±æ˜¯çº¿ç¨‹ IDï¼Œåœ¨ linux kernel ä¸­ï¼Œæ¯ä¸€ä¸ª thread åˆ†é…ä¸€ä¸ª task_structï¼Œè¯¥ç»“æ„ä¸­çš„ pid æˆå‘˜å°±æ˜¯çº¿ç¨‹ IDã€‚åœ¨ POSIX æ ‡å‡†ä¸­ï¼Œå®šä¹‰äº† pthread_self æ¥è·å–çº¿ç¨‹ IDï¼Œlinux kernel é‡‡ç”¨äº† gettid çš„ç³»ç»Ÿè°ƒç”¨æ¥è·å–è°ƒç”¨è€…çš„çº¿ç¨‹ IDã€‚åœ¨ linux kernel ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```C
asmlinkage long sys_gettid(void) {
	return current->pid;
}
```

POSIX è§„å®šçº¿ç¨‹ ID åœ¨æ‰€å±è¿›ç¨‹ä¸­æ˜¯å”¯ä¸€çš„ï¼Œä¸è¿‡åœ¨ linux kernel çš„å®ç°ä¸­ï¼Œthread ID æ˜¯å…¨ç³»ç»Ÿå”¯ä¸€çš„ï¼Œå½“ç„¶ï¼Œè€ƒè™‘åˆ°å¯ç§»æ¤æ€§ï¼ŒApplication software ä¸åº”è¯¥å‡è®¾è¿™ä¸€ç‚¹ã€‚

å››ã€ä»€ä¹ˆæ˜¯è¿›ç¨‹ç»„ ID

æ¯ä¸ªè¿›ç¨‹å±äºä¸€ä¸ªè¿›ç¨‹ç»„ï¼Œæ¯ä¸ªè¿›ç¨‹ç»„æœ‰ä¸€ä¸ª Leader è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹ ID ç­‰äºè¿›ç¨‹ç»„ ID çš„é‚£ä¸ªè¿›ç¨‹ã€‚è¿›ç¨‹ç»„æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹äºè¿›ç¨‹ç»„ leader åˆ›å»ºè¿›ç¨‹ç»„ï¼Œç»“æŸäºè¿›ç¨‹ç»„å†…çš„æœ€åä¸€ä¸ªè¿›ç¨‹ç¦»å¼€è¿›ç¨‹ç»„ï¼ˆå¯èƒ½æ˜¯è¿›ç¨‹é€€å‡º, æˆ–åŠ å…¥å…¶ä»–è¿›ç¨‹ç»„ï¼‰ã€‚è¿›ç¨‹ç»„æ¦‚å¿µçš„æå‡ºä¸»è¦æ˜¯ç”±äºï¼š

1ã€å’Œ job control ç›¸å…³ï¼Œå…³äº job controlï¼Œåç»­ä¼šä¸“é—¨çš„æ–‡æ¡£è¯¦ç»†æè¿°ã€‚

2ã€ Signal å¯ä»¥å‘é€ç»™è¿›ç¨‹ç»„çš„æ¯ä¸€ä¸ªè¿›ç¨‹ï¼ˆjob control ä¹Ÿä½¿ç”¨è¿™ä¸ªç‰¹æ€§ã€‚ä¾‹å¦‚ job control signal ä¼šè¢«é€ç»™ jobï¼ˆè¿›ç¨‹ç»„ï¼‰ä¸­çš„æ¯ä¸€ä¸ªè¿›ç¨‹ï¼‰

3ã€è¿›ç¨‹åŒæ­¥çš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥ wait for è¿›ç¨‹ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªè¿›ç¨‹

åœ¨ POSIX æ ‡å‡†ä¸­ï¼Œç³»ç»Ÿå®šä¹‰äº† getpgid å‡½æ•°æ¥è·å–ä¸€ä¸ªè¿›ç¨‹çš„ process group IDã€‚åœ¨ linux kernel ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```C
asmlinkage long sys_getpgid(pid_t pid) {
    if (!pid) {
        // å¦‚æœ pid ç­‰äº 0ï¼Œé‚£ä¹ˆéœ€è¦è·å–å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ç»„ ID
        return process_group(current);
    } else {
        // å¦åˆ™ï¼Œè·å– pid æ ‡è¯†çš„é‚£ä¸ªè¿›ç¨‹å¯¹åº”çš„è¿›ç¨‹ç»„ ID
        int retval;
        struct task_struct * p;
        read_lock( & tasklist_lock);
        p = find_task_by_pid(pid);
        retval = -ESRCH;
        if (p) {
            // æ˜¯å¦æœ‰æƒåˆ©è·å–å…¶ä»–è¿›ç¨‹çš„è¿›ç¨‹ç»„ ID
            retval = security_task_getpgid(p);
            if (!retval)
                retval = process_group(p);
        }
        read_unlock( & tasklist_lock);
        return retval;
    }
}

static inline pid_t process_group(struct task_struct * tsk) {
    return tsk->signal->pgrp;
}
```


task_struct ä¸­çš„ signal ä¸­çš„ pgrp æˆå‘˜æ ‡è¯†äº†è¿›ç¨‹ç»„ IDã€‚ä» pgrp çš„ä½ç½®æ¥çœ‹ï¼Œè¿›ç¨‹ç»„åº”è¯¥æ˜¯å’Œä¿¡å·å¤„ç†ç›¸å…³çš„ï¼Œåç»­ä¼šä¸“é—¨çš„æ–‡æ¡£è¯¦ç»†æè¿°ã€‚

äº”ã€Session ID

å’Œè¿›ç¨‹å±äºè¿›ç¨‹ç»„ç±»ä¼¼ï¼Œæ¯ä¸ªè¿›ç¨‹ç»„éƒ½å±äºä¸€ä¸ª sessionï¼Œæ¯ä¸ª session æœ‰ä¸€ä¸ª Leader è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯åˆ›å»º session çš„é‚£ä¸ªè¿›ç¨‹ï¼Œsession leader çš„ ID å°±ç­‰äºè¯¥ session çš„ IDã€‚Session æ¦‚å¿µçš„æå‡ºå’Œç”¨æˆ·ç™»å½•ä»¥åŠç»ˆç«¯ç¼–ç¨‹ç›¸å…³ï¼Œåç»­ä¼šä¸“é—¨çš„æ–‡æ¡£è¯¦ç»†æè¿°ã€‚

åœ¨ POSIX æ ‡å‡†ä¸­ï¼Œç³»ç»Ÿå®šä¹‰äº† getsid å‡½æ•°æ¥è·å– session leader è¿›ç¨‹çš„ process group IDã€‚å¦‚æœæŒ‡å®šçš„ PID ä¸æ˜¯ session leaderï¼Œå°†è¿”å›é”™è¯¯ï¼Œä½†æ˜¯åœ¨ linux kernel ä¸­æ²¡æœ‰å®Œå…¨éµå®ˆè¿™ä¸ªè§„å®šï¼Œgetsid å‡½æ•°æ€»æ˜¯èƒ½è¿”å›æŒ‡å®š PID çš„ session IDï¼Œæ— è®ºè¯¥ PID æŒ‡å‘çš„è¿›ç¨‹æ˜¯å¦æ˜¯ session leaderï¼Œå…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š

```C
asmlinkage long sys_getsid(pid_t pid) {
    if (!pid) {
        // å¦‚æœ pid ç­‰äº 0ï¼Œé‚£ä¹ˆéœ€è¦è·å–å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ç»„ ID
        return process_session(current);
    } else {
        // å¦åˆ™ï¼Œè·å– pid æ ‡è¯†çš„é‚£ä¸ªè¿›ç¨‹å¯¹åº”çš„è¿›ç¨‹ç»„ ID
        int retval;
        struct task_struct * p;
        read_lock( & tasklist_lock);
        p = find_task_by_pid(pid);
        retval = -ESRCH;
        if (p) {
            retval = security_task_getsid(p);
            if (!retval)
                retval = process_session(p);
        }
        read_unlock( & tasklist_lock);

        return retval;
    }
}

static inline pid_t process_session(struct task_struct * tsk) {
    return signal_session(tsk->signal);
}

static inline pid_t signal_session(struct signal_struct * sig) {
    return sig->__session;
}
```

task_struct ä¸­çš„ signal ä¸­çš„ `__session` æˆå‘˜æ ‡è¯†äº†è¿›ç¨‹ç»„ IDã€‚

## tip [ğŸ”](#weekly-99)

### 1. [åœ¨çº¿PSå·¥å…·](https://www.onlinephotosoft.com/)

è¯¥ç½‘é¡µå°±æ˜¯ä¸ªåœ¨çº¿ PSï¼Œå¥½ç”¨ï¼

### 2. [C++ Lambda è¡¨è¾¾å¼](https://zhuanlan.zhihu.com/p/384314474)

c++ åœ¨ c++11 æ ‡å‡†ä¸­å¼•å…¥äº† lambda è¡¨è¾¾å¼ï¼Œä¸€èˆ¬ç”¨äºå®šä¹‰åŒ¿åå‡½æ•°ï¼Œä½¿å¾—ä»£ç æ›´åŠ çµæ´»ç®€æ´ã€‚lambda è¡¨è¾¾å¼ä¸æ™®é€šå‡½æ•°ç±»ä¼¼ï¼Œä¹Ÿæœ‰å‚æ•°åˆ—è¡¨ã€è¿”å›å€¼ç±»å‹å’Œå‡½æ•°ä½“ï¼Œåªæ˜¯å®ƒçš„å®šä¹‰æ–¹å¼æ›´ç®€æ´ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰ã€‚

æœ€å¸¸è§çš„ lambda çš„è¡¨è¾¾å¼å†™æ³•å¦‚ä¸‹

```c++
auto plus = [] (int v1, int v2) -> int { return v1 + v2; }
int sum = plus(1, 2);
```

è¿™é‡Œåªæ˜¯è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹è‚¯å®šæ˜¯ä¸ä¼šè¿™ä¹ˆç”¨çš„ï¼Œæ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯å’Œ stl çš„ä¸€äº›ç®—æ³•ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚è‡ªå®šä¹‰ä¸€ä¸ªç»“æ„ä½“çš„æ’åºè§„åˆ™å’Œæ‰“å°ã€‚

```C++
struct Item {
    Item(int aa, int bb) : a(aa), b(bb) {} 
    int a;
    int b;
};
    
int main() {
    std::vector<Item> vec;
    vec.push_back(Item(1, 19));
    vec.push_back(Item(10, 3));
    vec.push_back(Item(3, 7));
    vec.push_back(Item(8, 12));
    vec.push_back(Item(2, 1));

    // æ ¹æ®Itemä¸­æˆå‘˜aå‡åºæ’åº
    std::sort(vec.begin(), vec.end(),
        [] (const Item& v1, const Item& v2) { return v1.a < v2.a; });

    // æ‰“å°vecä¸­çš„itemæˆå‘˜
    std::for_each(vec.begin(), vec.end(),
        [] (const Item& item) { std::cout << item.a << " " << item.b << std::endl; });
    return 0;
}
```

åœ¨ c++ çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œç»™å‡ºäº† lamda è¡¨è¾¾å¼çš„å››ç§å†™æ³•ï¼š

![](../images/2025/01/v2-cd4aeb07f429759ecbd6943adbe6449b_r.jpg)

#### å››ç§è¡¨è¾¾å¼çš„å«ä¹‰

1. å®Œæ•´çš„ lambda è¡¨è¾¾å¼ï¼ŒåŒ…å«äº† lambda è¡¨è¾¾å¼çš„æ‰€æœ‰æˆåˆ†ã€‚
1. å¸¸é‡ lambda è¡¨è¾¾å¼ï¼Œæ•è·çš„å˜é‡éƒ½æ˜¯å¸¸é‡ï¼Œä¸èƒ½åœ¨ lambda è¡¨è¾¾å¼çš„ body ä¸­è¿›è¡Œä¿®æ”¹ã€‚
1. å’Œï¼ˆ2ï¼‰åŸºæœ¬ä¸€è‡´ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œlambda è¡¨è¾¾å¼çš„å‡½æ•°è¿”å›å€¼å¯ä»¥é€šè¿‡å‡½æ•°ä½“æ¨å¯¼å‡ºæ¥ã€‚ä¸€èˆ¬æƒ…å†µå‡½æ•°è¿”å›å€¼ç±»å‹æ˜ç¡®æˆ–è€…æ²¡æœ‰è¿”å›å€¼çš„æƒ…å†µä¸‹å¯ä»¥è¿™æ ·å†™ã€‚
1. lambda è¡¨è¾¾å¼çš„å‡½æ•°æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œä½†æ˜¯å¯ä»¥æ·»åŠ  lambda-specifiersï¼Œlambda-specifiers æ˜¯ä»€ä¹ˆæˆ‘ä»¬åç»­å†ä»‹ç»ã€‚

#### lambda è¡¨è¾¾å¼å„ä¸ªæˆå‘˜çš„è§£é‡Š

- *captures* æ•è·åˆ—è¡¨ï¼Œlambda å¯ä»¥æŠŠä¸Šä¸‹æ–‡å˜é‡ä»¥å€¼æˆ–å¼•ç”¨çš„æ–¹å¼æ•è·ï¼Œåœ¨ body ä¸­ç›´æ¥ä½¿ç”¨ã€‚
- *tparams* æ¨¡æ¿å‚æ•°åˆ—è¡¨(c++20 å¼•å…¥)ï¼Œè®© lambda å¯ä»¥åƒæ¨¡æ¿å‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ã€‚
- *params* å‚æ•°åˆ—è¡¨ï¼Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œåœ¨ c++14 ä¹‹åå…è®¸ä½¿ç”¨ auto å·¦å³å‚æ•°ç±»å‹ã€‚
- *lambda-specifiers* lambda è¯´æ˜ç¬¦ï¼Œä¸€äº›å¯é€‰çš„å‚æ•°ï¼Œè¿™é‡Œä¸å¤šä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥å»å®˜æ–¹æ–‡æ¡£ä¸Šçœ‹ã€‚è¿™é‡Œæ¯”è¾ƒå¸¸ç”¨çš„å‚æ•°å°±æ˜¯ mutable å’Œ exceptionã€‚å…¶ä¸­ï¼Œè¡¨è¾¾å¼ (1) ä¸­æ²¡æœ‰ trailing-return-typeï¼Œæ˜¯å› ä¸ºåŒ…å«åœ¨è¿™ä¸€é¡¹é‡Œé¢çš„ã€‚
- *trailing-return-type* è¿”å›å€¼ç±»å‹ï¼Œä¸€èˆ¬å¯ä»¥çœç•¥æ‰ï¼Œç”±ç¼–è¯‘å™¨æ¥æ¨å¯¼ã€‚
- *body* å‡½æ•°ä½“ï¼Œå‡½æ•°çš„å…·ä½“é€»è¾‘ã€‚

#### æ•è·åˆ—è¡¨

ä¸Šé¢ä»‹ç»å®Œäº† lambda è¡¨è¾¾å¼çš„å„ä¸ªæˆåˆ†ï¼Œå…¶å®å¾ˆå¤šéƒ¨åˆ†å’Œæ­£å¸¸çš„å‡½æ•°æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå…¶ä¸­æœ€å¤§çš„ä¸€ä¸ªä¸åŒç‚¹å°±æ˜¯æ•è·åˆ—è¡¨ã€‚æˆ‘åœ¨åˆšå¼€å§‹ç”¨ lambda è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œè¿˜ä¸€ç›´ä»¥ä¸ºè¿™ä¸ªæ²¡å•¥ç”¨ï¼Œåªæ˜¯ç”¨ä¸€ä¸ª [] æ¥æ ‡å¿—ç€è¿™æ˜¯ä¸€ä¸ª lambda è¡¨è¾¾å¼ã€‚åæ¥äº†è§£äº†æ‰çŸ¥é“ï¼ŒåŸæ¥è¿™ä¸ªæ•è·åˆ—è¡¨å¦‚æ­¤å¼ºå¤§ï¼Œç”šè‡³æˆ‘è§‰å¾—æ•è·åˆ—è¡¨å°±æ˜¯ lambda è¡¨è¾¾å¼çš„çµé­‚ã€‚ä¸‹é¢å…ˆä»‹ç»å‡ ç§å¸¸ç”¨çš„æ•è·æ–¹å¼ã€‚

- [] ä»€ä¹ˆä¹Ÿä¸æ•è·ï¼Œæ— æ³• lambda å‡½æ•°ä½“ä½¿ç”¨ä»»ä½•
- [=] æŒ‰å€¼çš„æ–¹å¼æ•è·æ‰€æœ‰å˜é‡
- [&] æŒ‰å¼•ç”¨çš„æ–¹å¼æ•è·æ‰€æœ‰å˜é‡
- [=, &a] é™¤äº†å˜é‡ a ä¹‹å¤–ï¼ŒæŒ‰å€¼çš„æ–¹å¼æ•è·æ‰€æœ‰å±€éƒ¨å˜é‡ï¼Œå˜é‡ a ä½¿ç”¨å¼•ç”¨çš„æ–¹å¼æ¥æ•è·ã€‚è¿™é‡Œå¯ä»¥æŒ‰å¼•ç”¨æ•è·å¤šä¸ªï¼Œä¾‹å¦‚ [=, &a, &b,&c]ã€‚è¿™é‡Œæ³¨æ„ï¼Œå¦‚æœå‰é¢åŠ äº† =ï¼Œåé¢åŠ çš„å…·ä½“çš„å‚æ•°å¿…é¡»ä»¥å¼•ç”¨çš„æ–¹å¼æ¥æ•è·ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
- [&, a] é™¤äº†å˜é‡ a ä¹‹å¤–ï¼ŒæŒ‰å¼•ç”¨çš„æ–¹å¼æ•è·æ‰€æœ‰å±€éƒ¨å˜é‡ï¼Œå˜é‡ a ä½¿ç”¨å€¼çš„æ–¹å¼æ¥æ•è·ã€‚è¿™é‡Œåé¢çš„å‚æ•°ä¹Ÿå¯ä»¥å¤šä¸ªï¼Œä¾‹å¦‚ [&, a, b, c]ã€‚è¿™é‡Œæ³¨æ„ï¼Œå¦‚æœå‰é¢åŠ äº† &ï¼Œåé¢åŠ çš„å…·ä½“çš„å‚æ•°å¿…é¡»ä»¥å€¼çš„æ–¹å¼æ¥æ•è·ã€‚
- [a, &b] ä»¥å€¼çš„æ–¹å¼æ•è· aï¼Œå¼•ç”¨çš„æ–¹å¼æ•è· bï¼Œä¹Ÿå¯ä»¥æ•è·å¤šä¸ªã€‚
- [this] åœ¨æˆå‘˜å‡½æ•°ä¸­ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ•è· this æŒ‡é’ˆï¼Œå…¶å®åœ¨æˆå‘˜å‡½æ•°ä¸­ï¼Œ[=]å’Œ [&] ä¹Ÿä¼šæ•è· this æŒ‡é’ˆã€‚


```C++
#include <iostream>

int main() {
    int a = 3;
    int b = 5;
    
    // æŒ‰å€¼æ¥æ•è·
    auto func1 = [a] { std::cout << a << std::endl; };
    func1();

    // æŒ‰å€¼æ¥æ•è·
    auto func2 = [=] { std::cout << a << " " << b << std::endl; };
    func2();

    // æŒ‰å¼•ç”¨æ¥æ•è·
    auto func3 = [&a] { std::cout << a << std::endl; };
    func3();

    // æŒ‰å¼•ç”¨æ¥æ•è·
    auto func4 = [&] { std::cout << a << " " << b << std::endl; };
    func4();
}
```

#### ç¼–è¯‘å™¨å¦‚ä½•çœ‹å¾… Lambda è¡¨è¾¾å¼

å…¶å®ï¼Œç¼–è¯‘å™¨ä¼šæŠŠæˆ‘ä»¬å†™çš„ lambda è¡¨è¾¾å¼ç¿»è¯‘æˆä¸€ä¸ªç±»ï¼Œå¹¶é‡è½½ `operator()` æ¥å®ç°ã€‚æ¯”å¦‚æˆ‘ä»¬å†™ä¸€ä¸ª lambda è¡¨è¾¾å¼ä¸º


```C++
auto plus = [] (int a, int b) -> int { return a + b; }
int c = plus(1, 2);
```

é‚£ä¹ˆç¼–è¯‘å™¨ä¼šæŠŠæˆ‘ä»¬å†™çš„è¡¨è¾¾å¼ç¿»è¯‘ä¸º

```C++
// ç±»åæ˜¯æˆ‘éšä¾¿èµ·çš„
class LambdaClass {
public:
    int operator () (int a, int b) const {
        return a + b;
    }
};

LambdaClass plus;
int c = plus(1, 2);
```

è°ƒç”¨çš„æ—¶å€™ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ª Lambda çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ opeartor () å‡½æ•°ã€‚ï¼ˆ**å¤‡æ³¨ï¼šè¿™é‡Œçš„ç¼–è¯‘çš„ç¿»è¯‘ç»“æœå¹¶ä¸å’ŒçœŸæ­£çš„ç»“æœå®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯æŠŠæœ€ä¸»è¦çš„éƒ¨åˆ†ä½“ç°å‡ºæ¥ï¼Œå…¶ä»–çš„åƒç±»åˆ°å‡½æ•°æŒ‡é’ˆçš„è½¬æ¢å‡½æ•°å‡çœç•¥**ï¼‰

ä¸Šé¢æ˜¯ä¸€ç§è°ƒç”¨æ–¹å¼ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å†™ä¸€ä¸ªå¤æ‚ä¸€ç‚¹çš„ lambda è¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼ä¸­çš„æˆåˆ†ä¼šå¦‚ä½•ä¸ç±»çš„æˆåˆ†å¯¹åº”å‘¢ï¼Ÿæˆ‘ä»¬å†çœ‹ä¸€ä¸ª å€¼æ•è· ä¾‹å­ã€‚

```C++
int x = 1; int y = 2;
auto plus = [=] (int a, int b) -> int { return x + y + a + b; };
int c = plus(1, 2);
```

ç¼–è¯‘å™¨çš„ç¿»è¯‘ç»“æœä¸º

```C++
class LambdaClass {
public:
    LambdaClass(int xx, int yy)
    : x(xx), y(yy) {}

    int operator () (int a, int b) const     {
        return x + y + a + b;
    }

private:
    int x;
    int y;
}

int x = 1; int y = 2;
LambdaClass plus(x, y);
int c = plus(1, 2);
```

å…¶å®è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºï¼Œå€¼æ•è·æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠŠæ•è·åˆ°çš„å€¼ä½œä¸ºç±»çš„æˆå‘˜å˜é‡ï¼Œå¹¶ä¸”å˜é‡æ˜¯ä»¥å€¼çš„æ–¹å¼ä¼ é€’çš„ã€‚éœ€è¦æ³¨æ„çš„æ—¶ï¼Œå¦‚æœæ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯å€¼æ•è·çš„æ–¹å¼ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ operator() å‡½æ•°æ˜¯ const å‡½æ•°çš„ï¼Œæ˜¯æ— æ³•ä¿®æ”¹æ•è·çš„å€¼çš„ï¼Œå“ªæ€•è¿™ä¸ªä¿®æ”¹ä¸ä¼šæ”¹å˜ lambda è¡¨è¾¾å¼å¤–éƒ¨çš„å˜é‡ï¼Œå¦‚æœæƒ³è¦åœ¨å‡½æ•°å†…ä¿®æ”¹æ•è·çš„å€¼ï¼Œéœ€è¦åŠ ä¸Šå…³é”®å­— mutableã€‚å‘ä¸‹é¢è¿™æ ·çš„å½¢å¼ã€‚

```C++
int x = 1; int y = 2;
auto plus = [=] (int a, int b) mutable -> int { x++; return x + y + a + b; };
int c = plus(1, 2);
```

æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªå¼•ç”¨æ•è·çš„ä¾‹å­ã€‚

```C++
int x = 1; int y = 2;
auto plus = [&] (int a, int b) -> int { x++; return x + y + a + b;};
int c = plus(1, 2);
```

ç¼–è¯‘å™¨çš„ç¿»è¯‘ç»“æœä¸º

```C++
class LambdaClass {
public:
    LambdaClass(int& xx, int& yy)
    : x(xx), y(yy) {}

    int operator () (int a, int b) {
        x++;
        return x + y + a + b;
    }

private:
    int &x;
    int &y;
};

```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥å¼•ç”¨çš„æ–¹å¼æ•è·å˜é‡ï¼Œå’Œå€¼æ•è·çš„æ–¹å¼æœ‰ 3 ä¸ªä¸åŒçš„åœ°æ–¹ï¼š1. å‚æ•°å¼•ç”¨çš„æ–¹å¼è¿›è¡Œä¼ é€’; 2. å¼•ç”¨æ•è·åœ¨å‡½æ•°ä½“ä¿®æ”¹å˜é‡ï¼Œä¼šç›´æ¥ä¿®æ”¹ lambda è¡¨è¾¾å¼å¤–éƒ¨çš„å˜é‡ï¼›3. opeartor() å‡½æ•°ä¸æ˜¯ const çš„ã€‚

é’ˆå¯¹ä¸Šé¢çš„é›†ä¸­æƒ…å†µï¼Œæˆ‘ä»¬æŠŠ lambda çš„å„ä¸ªæˆåˆ†å’Œç±»çš„å„ä¸ªæˆåˆ†å¯¹åº”èµ·æ¥å°±æ˜¯å¦‚ä¸‹çš„å…³ç³»:

- æ•è·åˆ—è¡¨ï¼Œå¯¹åº” LambdaClass ç±»çš„ private æˆå‘˜ã€‚
- å‚æ•°åˆ—è¡¨ï¼Œå¯¹åº” LambdaClass ç±»çš„æˆå‘˜å‡½æ•°çš„ operator() çš„å½¢å‚åˆ—è¡¨
- mutableï¼Œå¯¹åº” LambdaClass ç±»æˆå‘˜å‡½æ•° operator() çš„ const å±æ€§ ï¼Œä½†æ˜¯åªæœ‰åœ¨æ•è·åˆ—è¡¨æ•è·çš„å‚æ•°ä¸å«æœ‰å¼•ç”¨æ•è·çš„æƒ…å†µä¸‹æ‰ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºæ•è·åˆ—è¡¨åªè¦åŒ…å«å¼•ç”¨æ•è·ï¼Œé‚£ operator() å‡½æ•°å°±ä¸€å®šæ˜¯é const å‡½æ•°ã€‚
- è¿”å›ç±»å‹ï¼Œå¯¹åº” LambdaClass ç±»æˆå‘˜å‡½æ•° operator() çš„è¿”å›ç±»å‹
- å‡½æ•°ä½“ï¼Œå¯¹åº” LambdaClass ç±»æˆå‘˜å‡½æ•° operator() çš„å‡½æ•°ä½“ã€‚
- å¼•ç”¨æ•è·å’Œå€¼æ•è·ä¸åŒçš„ä¸€ç‚¹å°±æ˜¯ï¼Œå¯¹åº”çš„æˆå‘˜æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹ã€‚

## share [ğŸ”](#weekly-99)

[readme](../README.md) | [previous](202501W4.md) | [next](202501W6.md)
