> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2025-01-26 - 2025-02-01

# Weekly #99

[readme](../README.md) | [previous](202501W4.md) | [next](202501W6.md)

![](../images/2025/01/sittinat-thurdnampetch-TpUvIVq6kcw-unsplash.jpg "Weekly #99")

\**Photo by [Sittinat Thurdnampetch](https://unsplash.com/@mosthurd) on [Unsplash](https://unsplash.com/photos/a-woman-holding-a-sparkler-in-her-hand-TpUvIVq6kcw)*

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
	- Linux è¿›ç¨‹æ ‡è¯†
- [tip](#tip-)
	- åœ¨çº¿PSå·¥å…·
- [share](#share-)

## algorithm [ğŸ”](#weekly-99)

## review [ğŸ”](#weekly-99)

### 1. [Linux è¿›ç¨‹æ ‡è¯†](http://www.wowotech.net/process_management/process_identification.html)

ä¸€ã€æ¦‚è¿°

æœ¬æ–‡ä¸»è¦æè¿°åœ¨ linux kernel ä¸­å¦‚ä½•æ ‡è¯†ä¸€ä¸ªæˆ–è€…ä¸€ç»„å’Œè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰ç›¸å…³çš„å®ä½“ï¼ŒåŒ…æ‹¬ï¼š

- è¿›ç¨‹ IDï¼ˆçº¿ç¨‹ç»„ IDï¼‰
- çº¿ç¨‹ ID
- è¿›ç¨‹ç»„ ID
- Session ID

éœ€è¦å¼ºè°ƒçš„æ˜¯æœ¬æ–‡ focus åœ¨ identificationï¼Œå¾ˆå¤šå±•å¼€çš„å†…å®¹ä¼šæœ‰ä¸€ç³»åˆ—æ–‡æ¡£æè¿°ã€‚

äºŒã€ä»€ä¹ˆæ˜¯è¿›ç¨‹ IDï¼ˆçº¿ç¨‹ç»„ IDï¼‰

ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬éƒ½ä¼šå®šä¹‰è¿›ç¨‹æ˜¯ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºæˆ–è€…æ˜¯ä¸€ä¸ªç¨‹åºçš„è¿è¡Œå®ä¾‹ã€‚ç¨‹åºæ˜¯ä¸€ä¸ªé™æ€çš„æ¦‚å¿µï¼Œæ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŒ…æ‹¬ç¨‹åºä»£ç å’Œæ•°æ®ï¼ˆæ­£æ–‡æ®µã€æ•°æ®æ®µç­‰ï¼‰ã€‚å½“ç¨‹åºè¿è¡Œèµ·æ¥æˆä¸ºè¿›ç¨‹çš„æ—¶å€™ï¼Œå•çº¯çš„ç¨‹åºä»£ç åˆ™ä¸èƒ½æ¸…æ¥šçš„æè¿°è¿›ç¨‹ï¼Œå®ƒè¿˜éœ€è¦è‹¥å¹²æ•°æ®ç»“æ„æ¥æè¿°ç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€ï¼ˆç¡¬ä»¶ä¸Šä¸‹æ–‡å’Œè½¯ä»¶ä¸Šä¸‹æ–‡ï¼‰ä»¥åŠæ‹¥æœ‰çš„èµ„æºï¼ˆå¦‚åœ°å€ç©ºé—´ã€æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ç­‰ï¼‰ã€‚ä»å†…æ ¸çš„è§’åº¦çœ‹ï¼Œè¿›ç¨‹æ˜¯ä¸€ä¸ªå’Œç³»ç»Ÿèµ„æºï¼ˆCPU timeã€memory ç­‰ï¼‰åˆ†é…ç›¸å…³çš„å®ä½“ã€‚

åœ¨ POSIX æ ‡å‡†ä¸­ï¼Œç³»ç»Ÿå®šä¹‰äº† getpid å‡½æ•°æ¥è·å–ä¸€ä¸ªè¿›ç¨‹çš„ process IDã€‚åœ¨ linux kernel ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```C
asmlinkage long sys_getpid(void) {
	return current->tgid;
}
```

ä»å­—é¢ä¸Šçœ‹ task_struct ä¸­çš„ tgid æ˜¯ thread group IDï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ç»„ IDï¼Œåœ¨ linux kernel ä¸­ï¼Œè¿›ç¨‹æ˜¯æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ª thread ç»„æˆï¼ˆPOSIX è§„å®šå¤šä¸ª thread è¦å…±äº«ä¸€ä¸ªè¿›ç¨‹ IDï¼‰ã€‚å¯¹äº linux kernelï¼Œæ¯ä¸€ä¸ª thread åˆ†é…ä¸€ä¸ª task_structï¼ˆå…¶ä¸­æœ‰ä¸€ä¸ª pid çš„æ ‡è¯†ï¼‰ï¼Œè¿™å’Œå¤§éƒ¨åˆ†çš„ kernel å¤„ç†ä¸ä¸€æ ·ï¼Œå…¶ä»–çš„ kernel é’ˆå¯¹ä¸€ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ª task_structï¼Œåœ¨è¯¥ task_struct ä¸­åµŒå…¥äº†å±äºè¯¥è¿›ç¨‹çš„å„ä¸ªçº¿ç¨‹çš„æ•°æ®ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œlinux kernel åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç»„çš„æ¦‚å¿µæ¥æ˜ å°„åˆ° POSIX ä¸­çš„è¿›ç¨‹æ¦‚å¿µã€‚

å¤šçº¿ç¨‹çš„è¿›ç¨‹ä¸­ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼Œgroup leaderï¼‰çš„ pid ç­‰äº tgidï¼Œä¹‹åï¼Œè¯¥çº¿ç¨‹ç»„ä¸­çš„çº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ pidï¼Œä½†æ˜¯å…±äº« tgidï¼Œä¹Ÿå°±æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„è¿›ç¨‹ IDã€‚task_struct æœ‰ä¸€ä¸ª group_leader æˆå‘˜ï¼ŒæŒ‡å‘è¯¥ task çš„ thread group leaderï¼Œå¯¹äº group leaderï¼Œè¯¥æˆå‘˜æŒ‡å‘è‡ªå·±çš„ task_struct æ•°æ®ç»“æ„ã€‚

ä¸‰ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹ ID

çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªå®ä½“ï¼Œæ˜¯è¢«ç³»ç»Ÿç‹¬ç«‹è°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹è‡ªå·±ä¸ç‹¬ç«‹æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œå®ƒæ˜¯ä¸åŒå±ä¸€ä¸ªè¿›ç¨‹çš„å…¶å®ƒçº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æºï¼ˆå¦‚åœ°å€ç©ºé—´ã€æ–‡ä»¶æè¿°ç¬¦å’Œä¿¡å·å¤„ç†ï¼‰ã€‚è¿™é¦–å…ˆè¡¨ç°åœ¨ï¼šæ‰€æœ‰çº¿ç¨‹éƒ½å…·æœ‰ç›¸åŒçš„åœ°å€ç©ºé—´ï¼ˆè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼‰ï¼Œè¿™æ„å‘³ç€ï¼Œçº¿ç¨‹å¯ä»¥è®¿é—®è¯¥åœ°å€ç©ºé—´çš„æ¯ä¸€ä¸ªè™šåœ°å€ï¼›æ­¤å¤–ï¼Œè¿˜å¯ä»¥è®¿é—®è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å·²æ‰“å¼€æ–‡ä»¶ã€å®šæ—¶å™¨ã€ä¿¡å·é‡ç­‰èµ„æºã€‚è¿›ç¨‹æ˜¯èµ„æºç®¡ç†çš„æœ€å°å•å…ƒï¼Œè€Œçº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œçš„æœ€å°å•å…ƒã€‚é™¤äº†å…±äº«çš„è¿›ç¨‹èµ„æºï¼Œè¿›ç¨‹ä¸­çš„å„ä¸ªçº¿ç¨‹ä¹Ÿå±äºè‡ªå·±çš„èµ„æºï¼Œå…·ä½“åŒ…æ‹¬ï¼šstackã€PC counter å’Œ CPU å¯„å­˜å™¨ã€‚

æ¯ä¸ªçº¿ç¨‹åº”è¯¥æœ‰è‡ªå·±çš„ IDï¼Œå°±æ˜¯çº¿ç¨‹ IDï¼Œåœ¨ linux kernel ä¸­ï¼Œæ¯ä¸€ä¸ª thread åˆ†é…ä¸€ä¸ª task_structï¼Œè¯¥ç»“æ„ä¸­çš„ pid æˆå‘˜å°±æ˜¯çº¿ç¨‹ IDã€‚åœ¨ POSIX æ ‡å‡†ä¸­ï¼Œå®šä¹‰äº† pthread_self æ¥è·å–çº¿ç¨‹ IDï¼Œlinux kernel é‡‡ç”¨äº† gettid çš„ç³»ç»Ÿè°ƒç”¨æ¥è·å–è°ƒç”¨è€…çš„çº¿ç¨‹ IDã€‚åœ¨ linux kernel ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```C
asmlinkage long sys_gettid(void) {
	return current->pid;
}
```

POSIX è§„å®šçº¿ç¨‹ ID åœ¨æ‰€å±è¿›ç¨‹ä¸­æ˜¯å”¯ä¸€çš„ï¼Œä¸è¿‡åœ¨ linux kernel çš„å®ç°ä¸­ï¼Œthread ID æ˜¯å…¨ç³»ç»Ÿå”¯ä¸€çš„ï¼Œå½“ç„¶ï¼Œè€ƒè™‘åˆ°å¯ç§»æ¤æ€§ï¼ŒApplication software ä¸åº”è¯¥å‡è®¾è¿™ä¸€ç‚¹ã€‚

å››ã€ä»€ä¹ˆæ˜¯è¿›ç¨‹ç»„ ID

æ¯ä¸ªè¿›ç¨‹å±äºä¸€ä¸ªè¿›ç¨‹ç»„ï¼Œæ¯ä¸ªè¿›ç¨‹ç»„æœ‰ä¸€ä¸ª Leader è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹ ID ç­‰äºè¿›ç¨‹ç»„ ID çš„é‚£ä¸ªè¿›ç¨‹ã€‚è¿›ç¨‹ç»„æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹äºè¿›ç¨‹ç»„ leader åˆ›å»ºè¿›ç¨‹ç»„ï¼Œç»“æŸäºè¿›ç¨‹ç»„å†…çš„æœ€åä¸€ä¸ªè¿›ç¨‹ç¦»å¼€è¿›ç¨‹ç»„ï¼ˆå¯èƒ½æ˜¯è¿›ç¨‹é€€å‡º, æˆ–åŠ å…¥å…¶ä»–è¿›ç¨‹ç»„ï¼‰ã€‚è¿›ç¨‹ç»„æ¦‚å¿µçš„æå‡ºä¸»è¦æ˜¯ç”±äºï¼š

1ã€å’Œ job control ç›¸å…³ï¼Œå…³äº job controlï¼Œåç»­ä¼šä¸“é—¨çš„æ–‡æ¡£è¯¦ç»†æè¿°ã€‚

2ã€ Signal å¯ä»¥å‘é€ç»™è¿›ç¨‹ç»„çš„æ¯ä¸€ä¸ªè¿›ç¨‹ï¼ˆjob control ä¹Ÿä½¿ç”¨è¿™ä¸ªç‰¹æ€§ã€‚ä¾‹å¦‚ job control signal ä¼šè¢«é€ç»™ jobï¼ˆè¿›ç¨‹ç»„ï¼‰ä¸­çš„æ¯ä¸€ä¸ªè¿›ç¨‹ï¼‰

3ã€è¿›ç¨‹åŒæ­¥çš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥ wait for è¿›ç¨‹ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªè¿›ç¨‹

åœ¨ POSIX æ ‡å‡†ä¸­ï¼Œç³»ç»Ÿå®šä¹‰äº† getpgid å‡½æ•°æ¥è·å–ä¸€ä¸ªè¿›ç¨‹çš„ process group IDã€‚åœ¨ linux kernel ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```C
asmlinkage long sys_getpgid(pid_t pid) {
    if (!pid) {
        // å¦‚æœ pid ç­‰äº 0ï¼Œé‚£ä¹ˆéœ€è¦è·å–å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ç»„ ID
        return process_group(current);
    } else {
        // å¦åˆ™ï¼Œè·å– pid æ ‡è¯†çš„é‚£ä¸ªè¿›ç¨‹å¯¹åº”çš„è¿›ç¨‹ç»„ ID
        int retval;
        struct task_struct * p;
        read_lock( & tasklist_lock);
        p = find_task_by_pid(pid);
        retval = -ESRCH;
        if (p) {
            // æ˜¯å¦æœ‰æƒåˆ©è·å–å…¶ä»–è¿›ç¨‹çš„è¿›ç¨‹ç»„ ID
            retval = security_task_getpgid(p);
            if (!retval)
                retval = process_group(p);
        }
        read_unlock( & tasklist_lock);
        return retval;
    }
}

static inline pid_t process_group(struct task_struct * tsk) {
    return tsk->signal->pgrp;
}
```


task_struct ä¸­çš„ signal ä¸­çš„ pgrp æˆå‘˜æ ‡è¯†äº†è¿›ç¨‹ç»„ IDã€‚ä» pgrp çš„ä½ç½®æ¥çœ‹ï¼Œè¿›ç¨‹ç»„åº”è¯¥æ˜¯å’Œä¿¡å·å¤„ç†ç›¸å…³çš„ï¼Œåç»­ä¼šä¸“é—¨çš„æ–‡æ¡£è¯¦ç»†æè¿°ã€‚

äº”ã€Session ID

å’Œè¿›ç¨‹å±äºè¿›ç¨‹ç»„ç±»ä¼¼ï¼Œæ¯ä¸ªè¿›ç¨‹ç»„éƒ½å±äºä¸€ä¸ª sessionï¼Œæ¯ä¸ª session æœ‰ä¸€ä¸ª Leader è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯åˆ›å»º session çš„é‚£ä¸ªè¿›ç¨‹ï¼Œsession leader çš„ ID å°±ç­‰äºè¯¥ session çš„ IDã€‚Session æ¦‚å¿µçš„æå‡ºå’Œç”¨æˆ·ç™»å½•ä»¥åŠç»ˆç«¯ç¼–ç¨‹ç›¸å…³ï¼Œåç»­ä¼šä¸“é—¨çš„æ–‡æ¡£è¯¦ç»†æè¿°ã€‚

åœ¨ POSIX æ ‡å‡†ä¸­ï¼Œç³»ç»Ÿå®šä¹‰äº† getsid å‡½æ•°æ¥è·å– session leader è¿›ç¨‹çš„ process group IDã€‚å¦‚æœæŒ‡å®šçš„ PID ä¸æ˜¯ session leaderï¼Œå°†è¿”å›é”™è¯¯ï¼Œä½†æ˜¯åœ¨ linux kernel ä¸­æ²¡æœ‰å®Œå…¨éµå®ˆè¿™ä¸ªè§„å®šï¼Œgetsid å‡½æ•°æ€»æ˜¯èƒ½è¿”å›æŒ‡å®š PID çš„ session IDï¼Œæ— è®ºè¯¥ PID æŒ‡å‘çš„è¿›ç¨‹æ˜¯å¦æ˜¯ session leaderï¼Œå…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š

```C
asmlinkage long sys_getsid(pid_t pid) {
    if (!pid) {
        // å¦‚æœ pid ç­‰äº 0ï¼Œé‚£ä¹ˆéœ€è¦è·å–å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ç»„ ID
        return process_session(current);
    } else {
        // å¦åˆ™ï¼Œè·å– pid æ ‡è¯†çš„é‚£ä¸ªè¿›ç¨‹å¯¹åº”çš„è¿›ç¨‹ç»„ ID
        int retval;
        struct task_struct * p;
        read_lock( & tasklist_lock);
        p = find_task_by_pid(pid);
        retval = -ESRCH;
        if (p) {
            retval = security_task_getsid(p);
            if (!retval)
                retval = process_session(p);
        }
        read_unlock( & tasklist_lock);

        return retval;
    }
}

static inline pid_t process_session(struct task_struct * tsk) {
    return signal_session(tsk->signal);
}

static inline pid_t signal_session(struct signal_struct * sig) {
    return sig->__session;
}
```

task_struct ä¸­çš„ signal ä¸­çš„ `__session` æˆå‘˜æ ‡è¯†äº†è¿›ç¨‹ç»„ IDã€‚

## tip [ğŸ”](#weekly-99)

### 1. [åœ¨çº¿PSå·¥å…·](https://www.onlinephotosoft.com/)

è¯¥ç½‘é¡µå°±æ˜¯ä¸ªåœ¨çº¿ PSï¼Œå¥½ç”¨ï¼

## share [ğŸ”](#weekly-99)

[readme](../README.md) | [previous](202501W4.md) | [next](202501W6.md)
