> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2021-08-08 - 2021-08-14

# Weekly #41

[readme](../README.md) | [previous](202108W1.md) | [next](202108W3.md)

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
    - go-advice: List of advice and tricks for Goï¼ˆGitHubï¼‰
- [tip](#tip-)
- [share](#share-)

## algorithm [ğŸ”](#weekly-41)

## review [ğŸ”](#weekly-41)

### 1. [go-advice: List of advice and tricks for Goï¼ˆGitHubï¼‰](https://github.com/cristaloleg/go-advice)

1ã€[Go ç®´è¨€](https://go-proverbs.github.io/)

- é”™è¯¯æ˜¯å€¼
- ä¸è¦åªæ£€æŸ¥é”™è¯¯ï¼Œè¿˜è¦ä¼˜é›…åœ°å¤„ç†å®ƒä»¬
- è®¾è®¡æ¶æ„ï¼Œå‘½åç»„ä»¶ï¼Œæ–‡æ¡£è®°å½•ç»†èŠ‚
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ `panic()`

2ã€[Go ä¹‹ç¦…](https://the-zen-of-go.netlify.com/)

- æ¯ä¸ª package å®ç°å•ä¸€çš„ç›®çš„
- æ˜¾å¼å¤„ç†é”™è¯¯
- å°½æ—©è¿”å›ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ·±åµŒå¥—
- åœ¨å¯åŠ¨ä¸€ä¸ª goroutine æ—¶ï¼Œéœ€è¦çŸ¥é“ä½•æ—¶å®ƒä¼šåœæ­¢

3ã€ä»£ç é£æ ¼

- ä½¿ç”¨ `go fmt` æ ¼å¼åŒ–
- å¤šä¸ª if è¯­å¥å¯ä»¥æŠ˜å æˆ switch

```Golang
// NOT BAD
if foo() {
    // ...
} else if bar == baz {
    // ...
} else {
    // ...
}

// BETTER
switch {
case foo():
    // ...
case bar == baz:
    // ...
default:
    // ...
}
```

- `30 * time.Second` æ¯” `time.Duration(30) * time.Second` æ›´å¥½
- æŒ‰ç±»å‹åˆ†ç»„ const å£°æ˜ï¼ŒæŒ‰é€»è¾‘å’Œ/æˆ–ç±»å‹åˆ†ç»„ var

```Golang
// BAD
const (
    foo = 1
    bar = 2
    message = "warn message"
)

// MOSTLY BAD
const foo = 1
const bar = 2
const message = "warn message"

// GOOD
const (
    foo = 1
    bar = 2
)

const message = "warn message"
```

- æ£€æŸ¥ defer ä¸­çš„é”™è¯¯

```Golang
defer func() {
  err := ocp.Close()
  if err != nil {
      rerr = err
  }
}()
```

- å¦‚æœä½ æƒ³çœç•¥è¿”å›å‚æ•°ï¼Œä½ æœ€å¥½è¡¨ç¤ºå‡ºæ¥ï¼š`_ = f()` æ¯” `f()` æ›´å¥½
- ç”¨ range å¾ªç¯æ¥è¿›è¡Œæ•°ç»„æˆ– slice çš„è¿­ä»£
- å¤šè¡Œå­—ç¬¦ä¸²ç”¨åå¼•å·\`
- ç”¨ `_` æ¥è·³è¿‡ä¸ç”¨çš„å‚æ•°

```Golang
func f(a int, _ string) {}
```

- ä½¿ç”¨ time.Before æˆ– time.After æ¯”è¾ƒæ—¶é—´æˆ³
- ä¸€ä¸ª slice çš„é›¶å€¼æ˜¯ nil

```Golang
var s []int
fmt.Println(s, len(s), cap(s))
if s == nil {
fmt.Println("nil!")
}
// Output:
// [] 0 0
// nil!

var a []string
b := []string{}

fmt.Println(reflect.DeepEqual(a, []string{}))
fmt.Println(reflect.DeepEqual(b, []string{}))
// Output:
// false
// true
```

- æ³¨æ„ç©ºç»“æ„ `struct{}`ï¼Œä¸¤ä¸ªåŒç»“æ„ä½“å¹¶ä¸ç›¸åŒ

```Golang
func f1() {
    var a, b struct{}
    print(&a, "\n", &b, "\n") // Prints same address
    fmt.Println(&a == &b)     // Comparison returns false
}
```

- **åœ¨ Go é‡Œé¢è¦å°å¿ƒä½¿ç”¨ range**
    - `for i := range a` å’Œ `for i, v := range &a`ï¼Œéƒ½ä¸æ˜¯ a çš„å‰¯æœ¬
    - ä½†æ˜¯ `for i, v := range a` é‡Œé¢çš„å°±æ˜¯ a çš„å‰¯æœ¬
    - æ›´å¤š: https://play.golang.org/p/4b181zkB1O
- ä¸è¦ä¾èµ–äºè®¡ç®—é¡ºåºï¼Œç‰¹åˆ«æ˜¯åœ¨ return è¯­å¥ä¸­

```Golang
// BAD
return res, json.Unmarshal(b, &res)

// GOOD
err := json.Unmarshal(b, &res)
return res, err

```

- é˜²æ­¢ç»“æ„ä½“å­—æ®µç”¨çº¯å€¼æ–¹å¼åˆå§‹åŒ–ï¼Œæ·»åŠ  `_ struct {}` å­—æ®µï¼š

```Golang
type Point struct {
  X, Y float64
  _    struct{} // to prevent unkeyed literals
}
```

å¯¹äº `Point {X:1, Y:1}` éƒ½å¯ä»¥ï¼Œä½†æ˜¯å¯¹äº `Point {1, 1}` åˆ™ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯

- ä¸ºäº†é˜²æ­¢ç»“æ„æ¯”è¾ƒï¼Œæ·»åŠ  `func` ç±»å‹çš„ç©ºå­—æ®µ

```Golang
type Point struct {
    _ [0]func() // unexported, zero-width non-comparable field
    X, Y float64
}
```

- ç§»åŠ¨ `defer` åˆ°é¡¶éƒ¨
- JavaScript è§£ææ•´æ•°ä¸ºæµ®ç‚¹æ•°å¹¶ä¸”ä½ çš„ int64 å¯èƒ½æº¢å‡ºï¼Œç”¨ `json:"id,string"` ä»£æ›¿

è¿˜æœ‰å…¶ä»–éƒ¨åˆ†æˆ‘æ²¡åˆ—å‡ºæ¥ï¼Œå…·ä½“å¯ä»¥å»çœ‹ [>> å‰©ä½™éƒ¨åˆ†](https://github.com/cristaloleg/go-advice/blob/master/README_ZH.md#%E5%B9%B6%E5%8F%91)

## tip [ğŸ”](#weekly-41)

## share [ğŸ”](#weekly-41)

[readme](../README.md) | [previous](202108W1.md) | [next](202108W3.md)
