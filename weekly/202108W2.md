> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2021-08-08 - 2021-08-14

# Weekly #41

[readme](../README.md) | [previous](202108W1.md) | [next](202108W3.md)

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
    - go-advice: List of advice and tricks for Go（GitHub）
- [tip](#tip-)
- [share](#share-)

## algorithm [🔝](#weekly-41)

## review [🔝](#weekly-41)

### 1. [go-advice: List of advice and tricks for Go（GitHub）](https://github.com/cristaloleg/go-advice)

1、[Go 箴言](https://go-proverbs.github.io/)

- 错误是值
- 不要只检查错误，还要优雅地处理它们
- 设计架构，命名组件，文档记录细节
- 不要在生产环境使用 `panic()`

2、[Go 之禅](https://the-zen-of-go.netlify.com/)

- 每个 package 实现单一的目的
- 显式处理错误
- 尽早返回，而不是使用深嵌套
- 在启动一个 goroutine 时，需要知道何时它会停止

3、代码风格

- 使用 `go fmt` 格式化
- 多个 if 语句可以折叠成 switch

```Golang
// NOT BAD
if foo() {
    // ...
} else if bar == baz {
    // ...
} else {
    // ...
}

// BETTER
switch {
case foo():
    // ...
case bar == baz:
    // ...
default:
    // ...
}
```

- `30 * time.Second` 比 `time.Duration(30) * time.Second` 更好
- 按类型分组 const 声明，按逻辑和/或类型分组 var

```Golang
// BAD
const (
    foo = 1
    bar = 2
    message = "warn message"
)

// MOSTLY BAD
const foo = 1
const bar = 2
const message = "warn message"

// GOOD
const (
    foo = 1
    bar = 2
)

const message = "warn message"
```

- 检查 defer 中的错误

```Golang
defer func() {
  err := ocp.Close()
  if err != nil {
      rerr = err
  }
}()
```

- 如果你想省略返回参数，你最好表示出来：`_ = f()` 比 `f()` 更好
- 用 range 循环来进行数组或 slice 的迭代
- 多行字符串用反引号\`
- 用 `_` 来跳过不用的参数

```Golang
func f(a int, _ string) {}
```

- 使用 time.Before 或 time.After 比较时间戳
- 一个 slice 的零值是 nil

```Golang
var s []int
fmt.Println(s, len(s), cap(s))
if s == nil {
fmt.Println("nil!")
}
// Output:
// [] 0 0
// nil!

var a []string
b := []string{}

fmt.Println(reflect.DeepEqual(a, []string{}))
fmt.Println(reflect.DeepEqual(b, []string{}))
// Output:
// false
// true
```

- 注意空结构 `struct{}`，两个同结构体并不相同

```Golang
func f1() {
    var a, b struct{}
    print(&a, "\n", &b, "\n") // Prints same address
    fmt.Println(&a == &b)     // Comparison returns false
}
```

- **在 Go 里面要小心使用 range**
    - `for i := range a` 和 `for i, v := range &a`，都不是 a 的副本
    - 但是 `for i, v := range a` 里面的就是 a 的副本
    - 更多: https://play.golang.org/p/4b181zkB1O
- 不要依赖于计算顺序，特别是在 return 语句中

```Golang
// BAD
return res, json.Unmarshal(b, &res)

// GOOD
err := json.Unmarshal(b, &res)
return res, err

```

- 防止结构体字段用纯值方式初始化，添加 `_ struct {}` 字段：

```Golang
type Point struct {
  X, Y float64
  _    struct{} // to prevent unkeyed literals
}
```

对于 `Point {X:1, Y:1}` 都可以，但是对于 `Point {1, 1}` 则会出现编译错误

- 为了防止结构比较，添加 `func` 类型的空字段

```Golang
type Point struct {
    _ [0]func() // unexported, zero-width non-comparable field
    X, Y float64
}
```

- 移动 `defer` 到顶部
- JavaScript 解析整数为浮点数并且你的 int64 可能溢出，用 `json:"id,string"` 代替

还有其他部分我没列出来，具体可以去看 [>> 剩余部分](https://github.com/cristaloleg/go-advice/blob/master/README_ZH.md#%E5%B9%B6%E5%8F%91)

## tip [🔝](#weekly-41)

## share [🔝](#weekly-41)

[readme](../README.md) | [previous](202108W1.md) | [next](202108W3.md)
