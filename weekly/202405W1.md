> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2024-05-05 - 2024-05-11

# Weekly #61

[readme](../README.md) | [previous](202404W4.md) | [next](202405W2.md)

![](../images/2024/05/sebastian-knoll-jHa4qLp4uZA-unsplash.jpg "Weekly #61")

\**Photo by [Sebastian Knoll](https://unsplash.com/@skenb) on [Unsplash](https://unsplash.com/photos/the-night-sky-is-filled-with-stars-and-the-milky-jHa4qLp4uZA)*

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
    - Rust vs Go in 2024
    - tinyTorrent: ä»å¤´å†™ä¸€ä¸ª Deno çš„ BitTorrent ä¸‹è½½å™¨
- [tip](#tip-)
- [share](#share-)
    - å¦‚ä½•åšæŒå†™æ–‡æ¡£

## algorithm [ğŸ”](#weekly-61)

## review [ğŸ”](#weekly-61)

### 1. [Rust vs Go in 2024](https://bitfieldconsulting.com/posts/rust-vs-go)

1ã€å†…å­˜å®‰å…¨

Rust å’Œ Go ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œä½†ä¸¤è€…éƒ½æ—¨åœ¨æ¯”å…¶ä»–è¯­è¨€æ›´æ™ºèƒ½ã€æ›´å®‰å…¨åœ°ç®¡ç†å†…å­˜ã€‚

2ã€æ€§èƒ½

Go å’Œ Rust éƒ½éå¸¸å¿«ã€‚ç„¶è€Œï¼Œè™½ç„¶ Go çš„è®¾è®¡åå‘äºå¿«é€Ÿç¼–è¯‘ï¼Œä½† Rust é’ˆå¯¹å¿«é€Ÿæ‰§è¡Œè¿›è¡Œäº†ä¼˜åŒ–ã€‚

Rust çš„è¿è¡Œæ—¶æ€§èƒ½ä¹Ÿæ›´åŠ ä¸€è‡´ï¼Œå› ä¸ºå®ƒä¸ä½¿ç”¨åƒåœ¾å›æ”¶ã€‚å¦ä¸€æ–¹é¢ï¼ŒGo çš„åƒåœ¾å›æ”¶å™¨å‡è½»äº†ç¨‹åºå‘˜çš„ä¸€äº›è´Ÿæ‹…ï¼Œä½¿å…¶æ›´å®¹æ˜“ä¸“æ³¨äºè§£å†³ä¸»è¦é—®é¢˜ï¼Œè€Œä¸æ˜¯å†…å­˜ç®¡ç†çš„ç»†èŠ‚ã€‚

å¯¹äºæ‰§è¡Œé€Ÿåº¦èƒœè¿‡æ‰€æœ‰å…¶ä»–è€ƒè™‘å› ç´ çš„é¢†åŸŸï¼Œä¾‹å¦‚æ¸¸æˆç¼–ç¨‹ã€æ“ä½œç³»ç»Ÿå†…æ ¸ã€Web æµè§ˆå™¨ç»„ä»¶å’Œå®æ—¶æ§åˆ¶ç³»ç»Ÿï¼ŒRust æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚

3ã€å¹¶å‘

ä¸å¤§å¤šæ•°è¯­è¨€ä¸åŒï¼ŒGo è®¾è®¡æœ‰ç”¨äºå¹¶å‘ç¼–ç¨‹çš„å†…ç½®åŠŸèƒ½ï¼Œä¾‹å¦‚ goroutinesï¼ˆçº¿ç¨‹çš„è½»é‡çº§ç‰ˆæœ¬ï¼‰å’Œ channelsï¼ˆåœ¨å¹¶å‘ä»»åŠ¡ä¹‹é—´ä¼ è¾“æ•°æ®çš„å®‰å…¨æœ‰æ•ˆæ–¹å¼ï¼‰ã€‚

è¿™äº›ä½¿ Go æˆä¸ºå¤§è§„æ¨¡å¹¶å‘åº”ç”¨ç¨‹åºï¼ˆå¦‚ Web æœåŠ¡å™¨å’Œå¾®æœåŠ¡ï¼‰çš„å®Œç¾é€‰æ‹©ã€‚

4ã€å®‰å…¨

Rust ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œä»¥ç¡®ä¿ç¨‹åºå‘˜ä¸èƒ½åšä¸€äº›ä»–ä»¬ä¸æƒ³åšçš„äº‹æƒ…ï¼Œä¾‹å¦‚è¦†ç›–å…±äº«å˜é‡ã€‚ç¼–è¯‘å™¨è¦æ±‚æ‚¨æ˜ç¡®è¯´æ˜åœ¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¹‹é—´å…±äº«æ•°æ®çš„æ–¹å¼ï¼Œå¹¶ä¸”å¯ä»¥æ£€æµ‹è®¸å¤šå¸¸è§çš„é”™è¯¯å’Œé”™è¯¯ã€‚

å› æ­¤ï¼Œæ‰€è°“çš„ â€œä¸å€Ÿç”¨æ£€æŸ¥å™¨ï¼ˆborrow checkerï¼‰æ‰“æ¶â€ æ˜¯æ–° Rust ç¨‹åºå‘˜çš„å¸¸è§æŠ±æ€¨ã€‚åœ¨å®‰å…¨çš„ Rust ä»£ç ä¸­å®ç°ä½ çš„ç¨‹åºé€šå¸¸æ„å‘³ç€ä»æ ¹æœ¬ä¸Šé‡æ–°æ€è€ƒå®ƒçš„è®¾è®¡ï¼Œè¿™å¯èƒ½ä¼šä»¤äººæ²®ä¸§ï¼Œä½†å½“å¯é æ€§æ˜¯ä½ çš„é¦–è¦ä»»åŠ¡æ—¶ï¼Œå¥½å¤„æ˜¯å€¼å¾—çš„ã€‚

### 2. [tinyTorrent: ä»å¤´å†™ä¸€ä¸ª Deno çš„ BitTorrent ä¸‹è½½å™¨](https://cjting.me/2020/10/31/tinytorrent-a-deno-bt-downloader/)

[Jesse Li çš„åšå®¢](https://blog.jse.li/posts/torrent/) å›¾æ–‡å¹¶èŒ‚ï¼Œè®²è¿°äº†å¦‚ä½•ç”¨ Go å¼€å‘ä¸€ä¸ª BT çš„ä¸‹è½½å™¨ã€‚å†…å®¹æ¶‰åŠåˆ° BT åè®®ä»¥åŠä¸‹è½½å™¨çš„ä»£ç è®¾è®¡ï¼Œæ€è·¯æ¸…æ™°ï¼Œå€¼å¾—ä¸€è¯»ã€‚

å¯¹äºå–œæ¬¢åŠ¨æ‰‹çš„æœ‹å‹ï¼Œå¯ä»¥å…ˆå…³æ‰è¿™ç¯‡åšå®¢ï¼Œå‚è€ƒ Jesse çš„ä»£ç å°è¯•è‡ªå·±å†™ä¸€ä¸ª BT ä¸‹è½½å™¨ã€‚å†™å®Œä»¥åå†å›æ¥ï¼Œå¯¹æ¯”æˆ‘ç”¨ Deno å¼€å‘çš„ä¸‹è½½å™¨ï¼Œç›¸ä¿¡ä¼šæœ‰ä¸ä¸€æ ·çš„æ”¶è·ã€‚

BT æ˜¯ä¸€ä¸ªåè®®ï¼Œå’Œ HTTP, FTP ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªåº”ç”¨å±‚çš„åè®®ï¼Œè¿™ä¸ªåè®®è¢«è®¾è®¡ç”¨æ¥å®ç° P2P (Peer to Peer) ä¸‹è½½ã€‚

ä¼ ç»Ÿçš„ä¸‹è½½æ˜¯å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨è·å–èµ„æºï¼Œä¸‹è½½æ–¹å’Œèµ„æºæä¾›æ–¹çš„è§’è‰²å¾ˆæ¸…æ¥šã€‚è¿™æ ·åšçš„ä¼˜ç‚¹æ˜¯ç®€å•ï¼Œæ˜“äºç†è§£ï¼Œæˆ‘è¦ä¸‹è½½ä¸œè¥¿ï¼Œæˆ‘å°±å»è¯·æ±‚æœåŠ¡å™¨ï¼Œç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š

- ä¸€æ—¦æœåŠ¡å™¨æ•…éšœï¼Œå¤§å®¶éƒ½æ— æ³•ä¸‹è½½
- æœåŠ¡å™¨å¸¦å®½æœ‰é™ï¼Œä¸‹è½½çš„äººå¤šé€Ÿåº¦å¿…ç„¶ä¸‹é™

è€Œ P2P åˆ™ä¸ä¸€æ ·ï¼Œæ¯ä¸€ä¸ªå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿæ˜¯æœåŠ¡å™¨ï¼Œä»åˆ«äººé‚£é‡Œä¸‹è½½èµ„æºçš„åŒæ—¶ï¼Œä¹Ÿæä¾›èµ„æºç»™åˆ°åˆ«äººã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±è§„é¿äº†æœåŠ¡å™¨æ¨¡å‹çš„ç¼ºç‚¹ï¼š

- æ¯ä¸ªäººéƒ½æ˜¯æœåŠ¡å™¨ï¼Œé™¤éæ‰€æœ‰æœºå™¨éƒ½æ•…éšœäº†ï¼Œå¦åˆ™ç½‘ç»œä¾æ—§å¯ä»¥è¿è½¬
- ä¸ä¼šå»è¯·æ±‚å•ä¸€æœºå™¨ï¼Œå¸¦å®½å¾—åˆ°æœ€å¤§åˆ©ç”¨

1ã€Torrent File

ç§å­æ–‡ä»¶ä½¿ç”¨äº†ä¸€ç§åä¸º [Bencode](https://en.wikipedia.org/wiki/Bencode) çš„ç¼–ç ï¼Œè¿™ä¸ªç¼–ç éå¸¸ç®€å•ï¼Œåªæ”¯æŒå¦‚ä¸‹å››ç§æ•°æ®ç±»å‹ã€‚å› ä¸ºå­˜åœ¨ List å’Œ Dictionaryï¼Œæ‰€ä»¥ä¹Ÿæœ‰èƒ½åŠ›è¡¨è¾¾å¤æ‚çš„æ•°æ®ç»“æ„ã€‚

- Byte String
- Integer
- List
- Dictionary

[deno-bencode](https://deno.land/x/bencode@v0.1.2) æ˜¯æˆ‘ç»™ Deno å†™çš„ä¸€ä¸ª Bencode ç¼–è§£ç åº“ï¼Œæˆ‘ä»¬ç°åœ¨ä½¿ç”¨è¿™ä¸ªåº“æ¥çœ‹çœ‹ç§å­æ–‡ä»¶ä¸­åˆ°åº•æœ‰ä»€ä¹ˆã€‚

```js
// decode.ts
import { decode } from "https://deno.land/x/bencode@v0.1.2/mod.ts"

const file = Deno.args[0]
console.log(decode(Deno.readFileSync(file)))
```

```Bash
$ wget https://cdimage.debian.org/debian-cd/current/amd64/bt-cd/debian-10.6.0-amd64-netinst.iso.torrent
$ deno run --allow-read decode.ts debian-10.6.0-amd64-netinst.iso.torrent
{
  announce: "http://bttracker.debian.org:6969/announce",
  comment: '"Debian CD from cdimage.debian.org"',
  "creation date": 1601120878,
  httpseeds: [
    "https://cdimage.debian.org/cdimage/release/10.6.0//srv/cdbuilder.debian.org/dst/deb-cd/weekly-builds...",
    "https://cdimage.debian.org/cdimage/archive/10.6.0//srv/cdbuilder.debian.org/dst/deb-cd/weekly-builds..."
  ],
  info: {
    length: 365953024,
    name: "debian-10.6.0-amd64-netinst.iso",
    "piece length": 262144,
    pieces: Uint8Array(27920) [
      144,  55, 173,  67, 115, 234, 169, 248, 222,  41, 139, 142, 125,
      100, 183, 130,  43, 148, 137, 130,   2, 194,  83, 109, 140, 147,
      123, 174, 234, 135,  58, 207, 217, 141, 107,  86, 245, 137,  79,
      150,  23,  33, 151, 157, 125, 159,  97,  10, 200, 137,  36, 158,
       74,  19,  97, 194, 171, 164,  32, 145, 175, 213,  91, 193, 120,
       26,  89, 109, 114,  61,  90, 166, 168, 137, 218, 154, 219, 119,
      107,  46, 240,  50, 134, 161, 162,  18, 224,  51, 210,  61,  41,
        6, 207, 124,  62, 199, 227, 134, 146, 206,
      ... 27820 more items
    ]
  }
}
```

é¦–å…ˆï¼Œç§å­æ–‡ä»¶æ˜¯ä¸€ä¸ª Bencode ç¼–ç çš„ Dictionaryï¼Œé‡Œé¢å«æœ‰ä¸€äº›å­—æ®µï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯è¿™äº›ï¼š

- announce: è¿™æ˜¯ä¸€ä¸ª URLï¼Œä½œç”¨åé¢å†è¯´
- info: è¿™ä¸ªåˆæ˜¯ä¸€ä¸ª Dictionaryï¼Œé‡Œé¢å«æœ‰æ–‡ä»¶ç›¸å…³çš„ä¿¡æ¯
    - length: æ–‡ä»¶çš„æ€»é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚
    - name: æ–‡ä»¶å
    - piece length: Pieceï¼ˆåˆ†æ®µï¼‰ çš„é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚
    - pieces: ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢å¯¹åº”äº†æ¯ä¸ª Piece çš„ SHA1 å“ˆå¸Œå€¼ï¼Œç”¨äºæ ¡éªŒï¼ˆSHA1 å“ˆå¸Œå€¼é•¿åº¦å›ºå®šä¸º 20 ä¸ªå­—èŠ‚ï¼‰

ä»æ–‡ä»¶é‡Œé¢çš„ä¿¡æ¯æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œç§å­æ˜¯åˆ†ä¸º Piece çš„ï¼Œæ¯ä¸ª Piece çš„é•¿åº¦åœ¨æ–‡ä»¶ä¸­å·²ç»ç¡®å®šï¼ŒåŒæ—¶ï¼Œç§å­æ–‡ä»¶ä¹Ÿä¼šæä¾›æ¯ä¸ª Piece çš„ SHA1 å“ˆå¸Œå€¼ç”¨äºæ ¡éªŒ Piece çš„æœ‰æ•ˆæ€§ã€‚

æˆ‘ä»¬æ¥æ ¸å¯¹ä¸€ä¸‹æ•°æ®ã€‚

- æ–‡ä»¶é•¿åº¦æ˜¯ 365953024 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ 349MBï¼Œ
- æ¯ä¸ª Piece çš„é•¿åº¦ä¸º 262144 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ 256KBã€‚
- é‚£ä¹ˆä¸€å…±æ˜¯ 365953024 / 262144 = 1396 ä¸ª Pieceï¼ˆæ³¨æ„ï¼Œè¿™é‡Œä¸ä¸€å®šæ•´é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€åä¸€ä¸ª Piece å®ƒçš„é•¿åº¦å¯èƒ½ä¸ç­‰äº piece lengthï¼‰
- æ¯ä¸ª Piece çš„ SHA1 å“ˆå¸Œæ˜¯ 20 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æ€»çš„æ˜¯ 1396 * 20 = 27920 ä¸ªå­—èŠ‚

å¤§å®¶å¯ä»¥å‘ç°ï¼Œä¸Šé¢çš„ç§å­åªåŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ‰“å¼€ç§å­æ—¶ï¼Œé‡Œé¢ä¼šæœ‰å¤šä¸ªæ–‡ä»¶ï¼Œä¸‹è½½å™¨ä¼šè®©æˆ‘ä»¬é€‰æ‹©å“ªäº›æ–‡ä»¶éœ€è¦è¢«ä¸‹è½½ã€‚

è¿™é‡Œå°±æ¶‰åŠåˆ°å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œ[å•æ–‡ä»¶ç§å­](https://wiki.theory.org/BitTorrentSpecification#Info_in_Single_File_Mode) å’Œ [å¤šæ–‡ä»¶ç§å­](https://wiki.theory.org/BitTorrentSpecification#Info_in_Multiple_File_Mode)ï¼Œå®ƒä»¬å­˜å‚¨çš„ä¿¡æ¯ç•¥æœ‰ä¸åŒï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥çœ‹ã€‚

æˆ‘éšä¾¿æ‰¾äº†ä¸€ä¸ª Taylor Swift çš„ä¸“è¾‘ Red çš„ç§å­ï¼Œæ‰“å¼€çœ‹çœ‹ã€‚

```Bash
$ deno run --allow-read decode.ts red.torrent
{
  announce: "http://tracker.nwps.ws:6969/announce",
  "announce-list": [
    [ "http://tracker.nwps.ws:6969/announce" ],
    [ "http://tracker.winglai.com/announce" ],
    [ "http://fr33dom.h33t.com:3310/announce" ],
    [ "http://exodus.desync.com:6969/announce" ],
    [ "http://torrent.gresille.org/announce" ],
    [ "http://tracker.trackerfix.com/announce" ],
    [ "udp://tracker.btzoo.eu:80/announce" ],
    [ "http://tracker.windsormetalbattery.com/announce" ],
    [ "udp://10.rarbg.me:80/announce" ],
    [ "udp://ipv4.tracker.harry.lu:80/announce" ],
    [ "udp://tracker.ilibr.org:6969/announce" ],
    [ "udp://tracker.zond.org:80/announce" ],
    [ "http://torrent-tracker.ru/announce.php" ],
    [ "http://bigfoot1942.sektori.org:6969/announce" ],
    [ "http://tracker.best-torrents.net:6969/announce" ],
    [ "http://announce.torrentsmd.com:6969/announce" ],
    [ "udp://tracker.token.ro:80/announce" ],
    [ "udp://open.demonii.com:80" ],
    [ "udp://tracker.coppersurfer.tk:80" ],
    [ "http://tracker.thepiratebay.org/announce" ],
    [ "udp://9.rarbg.com:2710/announce" ],
    [ "udp://open.demonii.com:1337/announce" ],
    [ "udp://tracker.ccc.de:80/announce" ],
    [ "udp://tracker.istole.it:80/announce" ],
    [ "udp://tracker.publicbt.com:80/announce" ],
    [ "udp://tracker.openbittorrent.com:80/announce" ],
    [ "udp://tracker.istole.it:80/announce" ],
    [ "http://tracker.istole.it/announce" ],
    [ "udp://tracker.publicbt.com:80/announce" ],
    [ "http://tracker.publicbt.com/announce" ],
    [ "udp://open.demonii.com:1337/announce" ],
    [ "udp://11.rarbg.me:80/announce" ],
    [ "udp://10.rarbg.me:80/announce" ],
    [ "udp://9.rarbg.com:2710/announce" ],
    [ "udp://tracker.token.ro:80/announce" ],
    [ "udp://12.rarbg.me:80/announce" ],
    [ "http://tracker.trackerfix.com/announce" ]
  ],
  comment: "Torrent downloaded from torrent cache at http://itorrents.org",
  "created by": "uTorrent/3210",
  "creation date": 1351095350,
  encoding: "UTF-8",
  info: {
    files: [
      { length: 13236894, path: [Array] },
      { length: 12992666, path: [Array] },
      { length: 12031154, path: [Array] },
      { length: 11899411, path: [Array] },
      { length: 11535936, path: [Array] },
      { length: 11465792, path: [Array] },
      { length: 9888023, path: [Array] },
      { length: 9853495, path: [Array] },
      { length: 9781419, path: [Array] },
      { length: 9684472, path: [Array] },
      { length: 9681093, path: [Array] },
      { length: 9574507, path: [Array] },
      { length: 9355103, path: [Array] },
      { length: 9154619, path: [Array] },
      { length: 9028224, path: [Array] },
      { length: 8994573, path: [Array] },
      { length: 8903823, path: [Array] },
      { length: 8895321, path: [Array] },
      { length: 8859865, path: [Array] },
      { length: 8304962, path: [Array] },
      { length: 8188974, path: [Array] },
      { length: 7797281, path: [Array] },
      { length: 7357902, path: [Array] }
    ],
    name: "Taylor Swift - Red (Deluxe Version)",
    "piece length": 16384,
    pieces: Uint8Array(276460) [
      107,  33, 238, 211, 243,  14, 230, 146,  23,  98, 147, 188, 251, 168,
      170, 253, 105,  99,  55, 208, 230,  60,  87, 198,  22, 246, 245, 186,
      141, 162,  52, 196, 196, 128,  98, 236, 121,  55, 150, 208,  40, 194,
       18,  57, 112, 165, 245,  17,  18,  51,   4,  44, 243, 254,  34, 207,
       12, 106, 201, 132,  96, 207,  61, 144, 118, 130, 211,  91,   7, 141,
       71,  36, 129, 132,  70, 115,  27, 133,  80, 240, 140, 121, 239,  28,
      240,  58, 212,  35,  20, 208,  94, 203, 176, 178, 126,  90,  37, 255,
      245,  17,
      ... 276360 more items
    ]
  }
}
```

å¯ä»¥å‘ç°ï¼Œæœ€å¤§çš„åŒºåˆ«åœ¨äº info é‡Œé¢å¤šäº†ä¸€ä¸ªå­—æ®µå«åš filesã€‚é»˜è®¤çš„ console.log æ²¡æœ‰æ‰“å°å‡º path å†…å®¹ï¼Œæˆ‘ä»¬æ”¹ä¸€ä¸‹ä»£ç ï¼Œå•ç‹¬æ‰“å° filesã€‚

```Bash
// decode2.ts
import { decode } from "https://deno.land/x/bencode@v0.1.2/mod.ts"

const file = Deno.args[0]
const result = decode(Deno.readFileSync(file)) as any
console.log(result.info.files)
```

```Bash
$  deno run --allow-read decode2.ts red.torrent
[
  { length: 13236894, path: [ "Taylor Swift - All Too Well.mp3" ] },
  {
    length: 12992666,
    path: [ "Taylor Swift - State of Grace (Acoustic Version).mp3" ]
  },
  {
    length: 12031154,
    path: [ "Taylor Swift Feat Gary Lightbody - The Last Time.mp3" ]
  },
  { length: 11899411, path: [ "Taylor Swift - State of Grace.mp3" ] },
  { length: 11535936, path: [ "Taylor Swift - The Moment I Knew.mp3" ] },
  { length: 11465792, path: [ "Taylor Swift - Sad Beautiful Tragic.mp3" ] },
  {
    length: 9888023,
    path: [ "Taylor Swift Feat Ed Sheeran - Everything Has Changed.mp3" ]
  },
  { length: 9853495, path: [ "Taylor Swift - I Almost Do.mp3" ] },
  { length: 9781419, path: [ "Taylor Swift - Treacherous.mp3" ] },
  { length: 9684472, path: [ "Taylor Swift - Treacherous (Demo).mp3" ] },
  { length: 9681093, path: [ "Taylor Swift - The Lucky One.mp3" ] },
  { length: 9574507, path: [ "Taylor Swift - Begin Again.mp3" ] },
  { length: 9355103, path: [ "Taylor Swift - 22.mp3" ] },
  { length: 9154619, path: [ "Taylor Swift - Red (Demo).mp3" ] },
  { length: 9028224, path: [ "Taylor Swift - Come Back... Be Here.mp3" ] },
  { length: 8994573, path: [ "Taylor Swift - Red.mp3" ] },
  { length: 8903823, path: [ "Taylor Swift - Girl At Home.mp3" ] },
  { length: 8895321, path: [ "Taylor Swift - Starlight.mp3" ] },
  { length: 8859865, path: [ "Taylor Swift - I Knew You Were Trouble..mp3" ] },
  { length: 8304962, path: [ "Taylor Swift - Stay Stay Stay.mp3" ] },
  { length: 8188974, path: [ "Taylor Swift - Holy Ground.mp3" ] },
  {
    length: 7797281,
    path: [ "Taylor Swift - We Are Never Ever Getting Back Together.mp3" ]
  },
  { length: 7357902, path: [ "Digital Booklet - Red (Deluxe).pdf" ] }
]
```

ç°åœ¨å°±å¾ˆæ¸…æ¥šäº†ï¼Œå¯¹å¤šæ–‡ä»¶ç§å­æ¥è¯´ï¼Œfiles é‡Œé¢å­˜å‚¨äº†æ¯ä¸ªæ–‡ä»¶çš„é•¿åº¦ï¼Œä»¥åŠæ¯ä¸ªæ–‡ä»¶çš„è·¯å¾„ã€‚

2ã€Tracker

ç°åœ¨æˆ‘ä»¬æ¥çœ‹ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¦‚ä½•æ‰¾åˆ° Peer ä»¥åŠå¦‚ä½•è®© Peer æ‰¾åˆ°æˆ‘ä»¬ï¼Ÿè¿™é‡Œçš„å…³é”®å°±æ˜¯ç§å­æ–‡ä»¶ä¸­å­˜å‚¨çš„ announce å­—æ®µï¼Œè¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ª URLï¼Œè¿™ä¸ª URL æŒ‡å‘äº†ä¸€ä¸ª Tracker æœåŠ¡å™¨ã€‚

Tracker æœåŠ¡å™¨é¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€ä¸ªè¿½è¸ªè€…ï¼Œæˆ–è€…è¯´æ˜¯ä¸­ä»‹ã€‚å®ƒæœ¬èº«ä¸æä¾›ä»»ä½•ä¸‹è½½æœåŠ¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”¨æ¥æ²Ÿé€š Peersã€‚

æ¯ä¸ª Peer é€šè¿‡ PeerID æ¥æ ‡è¯†è‡ªå·±ï¼Œè¿™æ˜¯ä¸€ä¸ª 20 å­—èŠ‚çš„æ•°æ®ï¼Œæ ¼å¼æ²¡æœ‰è¦æ±‚ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯·æ±‚ Tracker è·å–åˆ°å½“å‰èµ„æºæœ‰å“ªäº› Peerï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘ Tracker æ³¨å†Œè‡ªå·±æˆä¸ºä¸€ä¸ª Peerã€‚

Tracker ä½¿ç”¨ HTTP åè®®ï¼Œè¯·æ±‚æ—¶é€šè¿‡ Query æºå¸¦å‚æ•°ï¼Œä¸‹é¢æ˜¯ä¸‰ä¸ªå…³é”®å‚æ•°ï¼š

- info_hash: è¿™ä¸ªç”¨æ¥è¡¨æ˜æˆ‘ä»¬è¯·æ±‚çš„èµ„æºæ˜¯ä»€ä¹ˆï¼Œåœ¨ BT ä¸‹è½½ä¸­ï¼Œå¯¹èµ„æºçš„å”¯ä¸€æ ‡è¯†ä½¿ç”¨çš„æ˜¯ InfoHashï¼Œä¹Ÿå°±æ˜¯ç§å­æ–‡ä»¶ä¸­çš„ info å­—æ®µçš„å†…å®¹è¿›è¡Œ SHA1 å“ˆå¸Œä»¥åå¾—åˆ°çš„ç»“æœï¼Œ20 ä¸ªå­—èŠ‚
- peer_id: æˆ‘ä»¬è‡ªå·±ç”Ÿæˆçš„æ ‡è¯†èº«ä»½çš„ä¸€ä¸ª IDï¼Œ20 ä¸ªå­—èŠ‚
- port: æˆ‘ä»¬å®¢æˆ·ç«¯çš„ç›‘å¬ç«¯å£ï¼Œç”¨äºæ¥æ”¶å…¶ä»– Peer å‘æ¥çš„æ¶ˆæ¯
- Tracker è¿”å›çš„ä¿¡æ¯ä½¿ç”¨ Bencode ç¼–ç ï¼Œé‡Œé¢å«æœ‰ä¸¤ä¸ªæ•°æ®ï¼Œinterval å’Œ peersã€‚

```bash
{
  interval: 900,
  peers: Uint8Array(300) [
    171,  33, 254,  92, 200, 213,  75,  85, 105, 120,  26, 225,  87, 122,
    122, 178, 217,   4,  89, 160, 104,  18, 200, 213, 105, 233,  64,  91,
    200, 213, 112,   3, 198, 231, 200, 213, 177, 136, 104,   4, 200, 213,
     84,   3, 130,  32, 234,  96, 206, 144,  63, 149, 200, 213,  51,  15,
    200,  26, 194, 246,  95,  78, 126, 134, 200, 213, 100,  38,  32, 104,
    200, 213, 123, 113,  10, 254, 200, 213, 148, 251, 183,  98,  26, 225,
    186, 179, 163,  68,  26, 225,  38,  88, 192,  43,  26, 225,  90, 189,
    212, 240,
    ... 200 more items
  ]
}
```

peers æ˜¯ä¸€ä¸ª Byte Arrayï¼Œæ¯ 6 ä¸ªå­—èŠ‚ä»£è¡¨ä¸€ä¸ª Peerï¼Œå‰ 4 ä¸ªå­—èŠ‚ä¸º IP åœ°å€ï¼Œå 2 ä¸ªå­—èŠ‚ä¸º BigEndian çš„ç«¯å£å·ã€‚

ä»¥ä¸Šé¢çš„è¾“å‡ºä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œç¬¬ä¸€ä¸ª Peer çš„åœ°å€æ˜¯ 171.33.254.92:51413ã€‚

3ã€Download Process

æœ€åæˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ä½¿ç”¨ BT ä¸‹è½½çš„å®Œæ•´æµç¨‹ï¼š

1. è§£æç§å­æ–‡ä»¶
2. è¯·æ±‚ Trackerï¼Œè·å– Peers åˆ—è¡¨
3. è¯·æ±‚ Peersï¼Œä¸‹è½½ Pieceï¼Œæ ¹æ® pieces å­—æ®µæ ¡éªŒ Piece çš„æœ‰æ•ˆæ€§
4. ç»„è£… Pieceï¼Œå¾—åˆ°å®Œæ•´çš„æ–‡ä»¶

ä»ç§å­æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œèµ„æºè¢«åˆ’åˆ†ä¸º Pieceï¼Œæ¯ä¸ª Piece çš„é•¿åº¦åœ¨ç§å­æ–‡ä»¶ä¸­å·²ç»ç¡®å®šã€‚

è¿™é‡Œæˆ‘ä»¬è¯´çš„èµ„æºå¯ä»¥æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼ˆå•æ–‡ä»¶ç§å­ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªæ–‡ä»¶ï¼ˆå¤šæ–‡ä»¶ç§å­ï¼‰ï¼Œåœ¨ BT ä¸‹è½½çš„æ—¶å€™ï¼Œå…¶å®ä¸åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µã€‚ä¸ç®¡æ˜¯å•æ–‡ä»¶è¿˜æ˜¯å¤šæ–‡ä»¶ï¼Œéƒ½æ˜¯ä¸‹è½½ä¸€å®šæ•°é‡çš„ Pieceã€‚åœ¨å¤šæ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°æ€»æ•°æ®ä»¥åï¼Œå†æ ¹æ® files å­—æ®µä¸­æ ‡æ˜çš„é•¿åº¦å’Œè·¯å¾„æ¥è¿›è¡Œåˆ‡å‰²ã€‚


æ€æ ·è¯·æ±‚ Peers ä¸‹è½½ Pieceï¼Ÿè¿™é‡Œå°±æ˜¯ BT åè®®çš„é‡ç‚¹éƒ¨åˆ†ã€‚

å½“æˆ‘ä»¬ TCP è¿æ¥ Peer çš„æ—¶å€™ï¼Œç¬¬ä¸€æ­¥æ˜¯æ¡æ‰‹ã€‚

å‘é€å¦‚ä¸‹æ•°æ®ç»™åˆ°å¯¹æ–¹è¿›è¡Œæ¡æ‰‹ï¼š

- 1 å­—èŠ‚çš„åè®®é•¿åº¦ ProtocolLengthï¼Œå¡«å†™å›ºå®šå€¼ `0x13`
- 19 ä¸ªå­—èŠ‚çš„åè®®å ProtocolNameï¼Œå¡«å†™å›ºå®šå€¼ `BitTorrent protocol`
- 8 å­—èŠ‚çš„ä¿ç•™å­—æ®µ Reservedï¼Œéƒ½å¡«å†™ä¸º 0
- 20 ä¸ªå­—èŠ‚çš„ InfoHashï¼Œä»ç§å­æ–‡ä»¶ä¸­è®¡ç®—å¾—åˆ°
- 20 ä¸ªå­—èŠ‚çš„ PeerIDï¼Œæˆ‘ä»¬è‡ªå·±ç”Ÿæˆ

å¦‚æœå¯¹æ–¹æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ BT Peer çš„è¯ï¼Œæˆ‘ä»¬ä¼šæ”¶åˆ°åŒæ ·ç»“æ„çš„å“åº”ï¼Œä»ä¸­æå–å‡º InfoHashï¼Œå¦‚æœå’Œæˆ‘ä»¬å‘é€çš„ InfoHash ä¸€æ ·ï¼Œé‚£ä¹ˆå°±æ¡æ‰‹æˆåŠŸäº†

æ¡æ‰‹æˆåŠŸä»¥åï¼Œæ¥ä¸‹æ¥ä¾¿æ˜¯äº’å‘æ¶ˆæ¯ã€‚BT æ˜¯åŸºäº TCP çš„ä¸€ä¸ªä¸Šå±‚åè®®ï¼Œå’Œä»»ä½•ä¸€ä¸ªè‡ªå®šä¹‰åè®®ä¸€æ ·ï¼ŒBT å®šä¹‰äº†è‡ªå·±çš„æ¶ˆæ¯æ ¼å¼ BTMessageï¼ŒPeer ä¹‹é—´é€šè¿‡ BTMessage æ¥äº¤æ¢ä¿¡æ¯ã€‚

ä¸€ä¸ª BTMessage ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼š

- 4 å­—èŠ‚çš„ Lengthï¼ŒBigEndian
- 1 å­—èŠ‚çš„ IDï¼Œè¡¨æ˜æ¶ˆæ¯çš„ç±»å‹
- X å­—èŠ‚çš„æ¶ˆæ¯ä½“ Payloadï¼Œå«æœ‰å…·ä½“çš„æ•°æ®ï¼ŒX ä¸º Length - 1

é‡è¦çš„æ¶ˆæ¯ç±»å‹æœ‰å¦‚ä¸‹å‡ ç§ï¼š

- Choke: å‘Šè¯‰å¯¹æ–¹ä¸èƒ½è¯·æ±‚ä»»ä½•æ•°æ®ï¼Œå…ˆç­‰å¾…
- Unchoke: å‘Šè¯‰å¯¹æ–¹å¯ä»¥å¼€å§‹è¯·æ±‚æ•°æ®äº†
- Have: å‘Šè¯‰å¯¹æ–¹æˆ‘æœ‰æŸä¸ª Piece
- Bitfield: å°†æˆ‘æœ‰çš„æ‰€æœ‰ Piece ç¼–ç æˆ Bitfield å‘é€ç»™å¯¹æ–¹
- Request: å‘å¯¹æ–¹è¯·æ±‚ä¸‹è½½æŸä¸ª Piece
- Piece: å‘é€ Piece æ•°æ®ç»™åˆ°å¯¹æ–¹

å½“æˆ‘ä»¬è¿æ¥ Peer æ—¶ï¼Œé»˜è®¤å¤„äº Choked çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ä¸å…è®¸å‘ Peer è¯·æ±‚ä»»ä½•æ•°æ®ï¼Œå¿…é¡»å…ˆç­‰å¾… Peer å‘é€ Unchoke æ¶ˆæ¯ã€‚

è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ Request ä¸‹è½½æ—¶ï¼Œå¹¶ä¸æ˜¯ä¸€æ¬¡è¯·æ±‚ä¸€ä¸ªå®Œæ•´çš„ Pieceï¼Œè€Œæ˜¯åˆ†ä¸º Block ä¸‹è½½ï¼ŒBlock çš„å¤§å°å¯ä»¥åœ¨æ¶ˆæ¯ä½“ä¸­æŒ‡å®šï¼Œä¸€èˆ¬ä¸º 16Kã€‚

æ‰€ä»¥ï¼Œä» Peer ä¸‹è½½æ•°æ®çš„æµç¨‹æ˜¯

- æ¡æ‰‹
- æ¥æ”¶ Peer å‘é€çš„ Bitfield ä¿¡æ¯ï¼Œè·çŸ¥ Peer æœ‰å“ªäº› Piece
- ç­‰å¾… Peer å‘é€ Unchoke ä¿¡æ¯
- ä¸‹è½½ Piece1
- å‘é€ Request æ¶ˆæ¯ç»™ Peerï¼Œè¯·æ±‚ Piece1 çš„ Block1
- æ”¶åˆ° Piece æ¶ˆæ¯ï¼Œå¾—åˆ° Block1 æ•°æ®
- è¯·æ±‚ Piece1 çš„ Block2
- æ”¶åˆ° Block2 æ•°æ®
- ...
- Piece1 çš„æ‰€æœ‰ Block ä¸‹è½½å®Œæ¯•ï¼Œæ ¡éªŒ SHA1 å“ˆå¸Œå€¼
- ä¸‹è½½ Piece2

æ¯ä¸€ä¸ªæ¶ˆæ¯ç±»å‹çš„å…·ä½“æ¶ˆæ¯ä½“è¿™æ ·å°±ä¸å†å±•å¼€äº†ï¼Œè¿™äº›ç»†èŠ‚å¯¹äºç†è§£ BT ä¸é‡è¦ï¼Œåœ¨ç¼–ç æ—¶å¯¹ç…§ Spec æ¥åšå°±å¥½ã€‚

## tip [ğŸ”](#weekly-61)

## share [ğŸ”](#weekly-61)

### 1. å¦‚ä½•åšæŒå†™æ–‡æ¡£

åšæŒå†™æ–‡æ¡£è¾“å‡ºæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¹ æƒ¯ï¼Œä¸ä»…å¯ä»¥æŠŠè‡ªå·±æ‰€æ€ã€æ‰€å­¦ã€æ‰€æƒ³æ²‰æ·€ä¸‹æ¥åç»­å›è¿‡å¤´æ¥å†çœ‹ï¼ˆæ¸©æ•…è€ŒçŸ¥æ–°ï¼‰ï¼Œä¹Ÿèƒ½ç»™åˆ«äººåˆ†äº«ä»è€Œæ‰©å¤§è‡ªå·±çš„å½±å“åŠ›ã€‚

çªç„¶æƒ³å†™è¿™ä¸€ç‚¹æ˜¯å› ä¸ºå‰ä¸¤å¤©çœ‹åˆ°ç¾¤é‡Œè·Ÿæˆ‘å·®ä¸å¤šæ—¶é—´å…¥èŒçš„åŒå­¦åˆ†äº«ä»–è¿‘ä¸‰å¹´æ¥æ²‰æ·€çš„æ–‡æ¡£é›†åˆï¼ˆä»–ç”šè‡³æ‰“å°å‡ºæ¥ä¸Šä¸‹å†Œï¼‰ï¼Œè‡ªæ„§ä¸å¦‚ï¼Œéå¸¸ä½©æœä»–çš„æ¯…åŠ›ä»¥åŠè€å¿ƒï¼Œå›æƒ³è‡ªå·±å…¥èŒè¿‘ä¸‰å¹´æ¥å¯èƒ½ä¹Ÿå°±å‰ä¸€å¹´æœ‰æ‰€æ–‡æ¡£äº§å‡ºï¼Œåé¢åŸºæœ¬æ²¡å’‹å†™äº†ï¼Œæ­£å¦‚æœ¬é¡¹ç›®ä¸€èˆ¬ï¼Œçªç„¶ä¸­æ–­æ‰ã€‚

é‚£ä¹ˆå¦‚ä½•åšæŒå‘¢ï¼Ÿæˆ‘è§‰å¾—è¿˜æ˜¯è¦é€¼è‡ªå·±ä¸€æŠŠï¼ŒæŒ‘æ„Ÿå…´è¶£çš„ä¸œè¥¿å†™ï¼Œæ— è®ºæ˜¯å¦æŠ€æœ¯å‘ï¼Œå½“ç„¶é¦–å…ˆè¿˜æ˜¯éœ€è¦è¾“å…¥ï¼Œç„¶åæ‰èƒ½è·Ÿè‡ªå·±çš„æ€æƒ³è¿›è¡Œç¢°æ’äº§ç”Ÿç«èŠ±ï¼Œæœ‰æ‰€å†…å®¹å¯ä»¥è®°å½•ã€‚

[readme](../README.md) | [previous](202404W4.md) | [next](202405W2.md)
