> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2024-04-14 - 2024-04-14

# Weekly #59

[readme](../README.md) | [previous](202404W2.md) | [next](202404W4.md)

![](../images/2024/04/tommao-wang-99qnY06CFH4-unsplash.jpg "Weekly #59")

\**Photo by [tommao wang](https://unsplash.com/@tommaomaoer) on [Unsplash](https://unsplash.com/photos/brown-and-white-boat-on-white-sand-during-daytime-99qnY06CFH4)*

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
- [tip](#tip-)
    - Linux 防止文件被误删除或修改
- [share](#share-)

## algorithm [🔝](#weekly-59)

## review [🔝](#weekly-59)

## tip [🔝](#weekly-59)

### 1. [Linux 防止文件被误删除或修改](https://www.cnblogs.com/qujingtongxiao/p/13418383.html)

Linux 没有回收站，一旦文件或文件夹被误删除，要寻找回来很麻烦，不如事先对一些重要的文件做一些保护，这时我们需要一个命令 chattr, 其使用格式为 `chattr 操作符 属性 文件名`

操作符有以下三种

```Bash
+ 给文件增加属性
- 去除文件属性
= 设置文件的仅有属性
```

属性有

```Bash
a 允许给文件追加内容
i 保护模式（不允许删除或修改）
```

比方说我们执行

```Bash
sudo chattr +i a.cpp
```

接着我们删除

```Bash
rm a.cpp
```

此时会提示

```Bash
rm: 无法删除'a.cpp': 不允许的操作
```

即便加上 sudo 也无法删除，此时也无法修改文件了。如果我们要去除这个保护，只需要执行

```Bash
sudo chattr -i a.cpp
```

如果我们防止文件被删除，但允许追加内容，可以执行

```Bash
sudo chattr +a a.cpp
```

此时添加

```Bash
echo 'Hi' >> a.cpp
```

但是不能通过 vim 添加

如果我们是想保护文件夹，可以使用 `-R` 用以递归到目录里所有文件，比如

```Bash
sudo chattr -R +i ./testchattr/
```

查看文件属性

```Bash
lsattr a.cpp
```

附命令详解：

<table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td>参数</td><td>作用</td></tr><tr><td>i</td><td>无法对文件进行修改；若对目录设置了该参数，则仅能修改其中的子文件内容而不能新建或删除文件</td></tr><tr><td>a</td><td>仅允许补充（追加）内容，无法覆盖 / 删除内容（Append Only）</td></tr><tr><td>S</td><td>文件内容在变更后立即同步到硬盘（sync）</td></tr><tr><td>s</td><td>彻底从硬盘中删除，不可恢复（用 0 填充原文件所在硬盘区域）</td></tr><tr><td>A</td><td>不再修改这个文件或目录的最后访问时间（atime）</td></tr><tr><td>b</td><td>不再修改文件或目录的存取时间</td></tr><tr><td>D</td><td>检查压缩文件中的错误</td></tr><tr><td>d</td><td>使用 dump 命令备份时忽略本文件 / 目录</td></tr><tr><td>c</td><td>默认将文件或目录进行压缩</td></tr><tr><td>u</td><td>当删除该文件后依然保留其在硬盘中的数据，方便日后恢复</td></tr><tr><td>t</td><td>让文件系统支持尾部合并（tail-merging）</td></tr><tr><td>x</td><td>可以直接访问压缩文件中的内容</td></tr></tbody></table>

常用选项

```Bash
-R：递归处理，将指令目录下的所有文件及子目录一并处理；
-v<版本编号>：设置文件或目录版本；
-V：显示指令执行过程；
+<属性>：开启文件或目录的该项属性；
-<属性>：关闭文件或目录的该项属性；
=<属性>：指定文件或目录的该项属性。
参考示例：
chattr +i file //设置不能对文件进行修改，此时文件无法被写入也无法被删除。
chattr -i file //撤销 chattr +i file  的设置，此时file可以被删除

chattr +a file //不许删除文件 修改文件名，可以写入文件
```

## share [🔝](#weekly-59)

[readme](../README.md) | [previous](202404W2.md) | [next](202404W4.md)
