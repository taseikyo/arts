> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2025-03-02 - 2025-03-08

# Weekly #104

[readme](../README.md) | [previous](202502W4.md) | [next](202503W2.md)

![](../images/2025/03/morefun_boy-UlVJyfUZWYs-unsplash.jpg "Weekly #104")

\**Photo by [morefun_boy](https://unsplash.com/@equeen) on [Unsplash](https://unsplash.com/photos/a-woman-in-a-kimono-reaching-up-to-a-cherry-blossom-tree-UlVJyfUZWYs)*

-[toc]

## algorithm [ğŸ”](#weekly-104)

## review [ğŸ”](#weekly-104)

### 1. [MySQL çš„ COUNT è¯­å¥ --count (\*)ã€ count (å¸¸é‡)ã€ count (åˆ—å)](https://lhrbest.blog.csdn.net/article/details/102658504)

å…³äºæ•°æ®åº“ä¸­è¡Œæ•°ç»Ÿè®¡ï¼Œæ— è®ºæ˜¯ MySQL è¿˜æ˜¯ Oracleï¼Œéƒ½æœ‰ä¸€ä¸ªå‡½æ•°å¯ä»¥ä½¿ç”¨ï¼Œé‚£å°±æ˜¯ COUNT

ä½†æ˜¯ï¼Œå°±æ˜¯è¿™ä¸ªå¸¸ç”¨çš„ COUNT å‡½æ•°ï¼Œå´æš—è—ç€å¾ˆå¤šç„æœºï¼Œå°¤å…¶æ˜¯åœ¨é¢è¯•çš„æ—¶å€™ï¼Œä¸€ä¸å°å¿ƒå°±ä¼šè¢«è™ã€‚ ä¸ä¿¡çš„è¯è¯·å°è¯•å›ç­”ä¸‹ä»¥ä¸‹é—®é¢˜ï¼š

> 1ã€COUNT æœ‰å‡ ç§ç”¨æ³•ï¼Ÿ
>
> 2ã€COUNT(å­—æ®µå) å’Œ COUNT(\*) çš„æŸ¥è¯¢ç»“æœæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
>
> 3ã€COUNT(1) å’Œ COUNT(\*) ä¹‹é—´æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
>
> 4ã€COUNT(1) å’Œ COUNT(\*) ä¹‹é—´çš„æ•ˆç‡å“ªä¸ªæ›´é«˜ï¼Ÿ
>
> 5ã€ä¸ºä»€ä¹ˆã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹å»ºè®®ä½¿ç”¨ COUNT(\*)
>
> 6ã€MySQL çš„ MyISAM å¼•æ“å¯¹ COUNT(\*) åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ
>
> 7ã€MySQL çš„ InnoDB å¼•æ“å¯¹ COUNT(\*) åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ
>
> 8ã€ä¸Šé¢æåˆ°çš„ MySQL å¯¹ COUNT(\*) åšçš„ä¼˜åŒ–ï¼Œæœ‰ä¸€ä¸ªå…³é”®çš„å‰ææ˜¯ä»€ä¹ˆï¼Ÿ
>
> 9ã€SELECT COUNT(\*) çš„æ—¶å€™ï¼ŒåŠ ä¸åŠ  where æ¡ä»¶æœ‰å·®åˆ«å—ï¼Ÿ
>
> 10ã€COUNT(\*)ã€COUNT(1) å’Œ COUNT(å­—æ®µå) çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ

#### è®¤è¯† COUNT

å…³äº COUNT å‡½æ•°ï¼Œåœ¨ MySQL å®˜ç½‘ä¸­æœ‰è¯¦ç»†ä»‹ç»ï¼š

ç®€å•ç¿»è¯‘ä¸€ä¸‹ï¼š

- 1ã€COUNT(expr) ï¼Œè¿”å› SELECT è¯­å¥æ£€ç´¢çš„è¡Œä¸­ expr çš„å€¼ä¸ä¸º NULL çš„æ•°é‡ã€‚ ç»“æœæ˜¯ä¸€ä¸ª BIGINT å€¼ã€‚
- 2ã€å¦‚æœæŸ¥è¯¢ç»“æœæ²¡æœ‰å‘½ä¸­ä»»ä½•è®°å½•ï¼Œåˆ™è¿”å› 0
- 3ã€ä½†æ˜¯ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ COUNT(\*) çš„ç»Ÿè®¡ç»“æœä¸­ï¼Œä¼šåŒ…å«å€¼ä¸º NULL çš„è¡Œæ•°ã€‚

```SQL
create table t_count(id int,id2 int);
insert into t_count values(null,null);
insert into t_count values(1,null);
insert into t_count values(null,1);
insert into t_count values(1,null);
insert into t_count values(null,1);
insert into t_count values(1,null);
insert into t_count values(null,null);
select count(*),count(id),count(id2),count(1) from t_count;
```

å³ä»¥ä¸‹è¡¨è®°å½•ï¼š

```BASH
root@localhost[lhrdb]> create table t_count(id int,id2 int);
Query OK, 0 rows affected (0.36 sec)
root@localhost[lhrdb]> insert into t_count values(null,null);
Query OK, 1 row affected (0.07 sec)

root@localhost[lhrdb]> insert into t_count values(1,null);
Query OK, 1 row affected (0.06 sec)

root@localhost[lhrdb]> insert into t_count values(null,1);
Query OK, 1 row affected (0.08 sec)

root@localhost[lhrdb]> insert into t_count values(1,null);
Query OK, 1 row affected (0.03 sec)

root@localhost[lhrdb]> insert into t_count values(null,1);
Query OK, 1 row affected (0.05 sec)

root@localhost[lhrdb]> insert into t_count values(1,null);
Query OK, 1 row affected (0.03 sec)

root@localhost[lhrdb]> insert into t_count values(null,null);
Query OK, 1 row affected (0.08 sec)

root@localhost[lhrdb]>
root@localhost[lhrdb]> select * from t_count;
+
| id   | id2  |
+
| NULL | NULL |
|    1 | NULL |
| NULL |    1 |
|    1 | NULL |
| NULL |    1 |
|    1 | NULL |
| NULL | NULL |
+
7 rows in set (0.00 sec)
```

æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š

```BASH
root@localhost[lhrdb]> select count(*),count(id),count(id2),count(1),count(2) from t_count;

+
| count(*) | count(id) | count(id2) | count(1) | count(2) |
+
|        7 |         3 |          2 |        7 |        7 |
+

1 row in set (0.00 sec)
```

é™¤äº† COUNT(id) å’Œ COUNT(\*) ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ COUNT(å¸¸é‡) ï¼ˆå¦‚ COUNT(1) ï¼‰æ¥ç»Ÿè®¡è¡Œæ•°ï¼Œé‚£ä¹ˆè¿™ä¸‰æ¡ SQL è¯­å¥æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ åˆ°åº•å“ªç§æ•ˆç‡æ›´é«˜å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸­å¼ºåˆ¶è¦æ±‚ä¸è®©ä½¿ç”¨ COUNT(åˆ—å) æˆ– COUNT(å¸¸é‡) æ¥æ›¿ä»£ COUNT(\*) å‘¢ï¼Ÿ

#### COUNT(åˆ—å)ã€COUNT(å¸¸é‡) å’Œ COUNT(\*) ä¹‹é—´çš„åŒºåˆ«

å‰é¢æˆ‘ä»¬æåˆ°è¿‡ COUNT(expr) ç”¨äºåšè¡Œæ•°ç»Ÿè®¡ï¼Œç»Ÿè®¡çš„æ˜¯ expr ä¸ä¸º NULL çš„è¡Œæ•°ï¼Œé‚£ä¹ˆ COUNT(åˆ—å) ã€ COUNT(å¸¸é‡) å’Œ COUNT(\*) è¿™ä¸‰ç§è¯­æ³•ä¸­ï¼Œexpr åˆ†åˆ«æ˜¯ åˆ—å ã€ å¸¸é‡ å’Œ \* ã€‚

é‚£ä¹ˆ åˆ—å ã€ å¸¸é‡ å’Œ \* è¿™ä¸‰ä¸ªæ¡ä»¶ä¸­ï¼Œ å¸¸é‡ æ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œè‚¯å®šä¸ä¸º NULLã€‚ \* å¯ä»¥ç†è§£ä¸ºæŸ¥è¯¢æ•´è¡Œï¼Œæ‰€ä»¥è‚¯å®šä¹Ÿä¸ä¸º NULLï¼Œé‚£ä¹ˆå°±åªæœ‰ åˆ—å çš„æŸ¥è¯¢ç»“æœæœ‰å¯èƒ½æ˜¯ NULL äº†ã€‚

æ‰€ä»¥ï¼Œ COUNT(å¸¸é‡) å’Œ COUNT(\*) è¡¨ç¤ºçš„æ˜¯ç›´æ¥æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ•°æ®åº“è¡¨çš„è¡Œæ•°ã€‚è€Œ COUNT(åˆ—å) è¡¨ç¤ºçš„æ˜¯æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„åˆ—çš„å€¼ä¸ä¸º NULL çš„è¡Œæ•°ã€‚

é™¤äº†æŸ¥è¯¢å¾—åˆ°ç»“æœé›†æœ‰åŒºåˆ«ä¹‹å¤–ï¼Œ COUNT(\*) ç›¸æ¯” COUNT(å¸¸é‡) å’Œ COUNT(åˆ—å) æ¥è®²ï¼Œ COUNT(\*) æ˜¯ SQL92 å®šä¹‰çš„æ ‡å‡†ç»Ÿè®¡è¡Œæ•°çš„è¯­æ³•ï¼Œå› ä¸ºä»–æ˜¯æ ‡å‡†è¯­æ³•ï¼Œæ‰€ä»¥ MySQL æ•°æ®åº“å¯¹ä»–è¿›è¡Œè¿‡å¾ˆå¤šä¼˜åŒ–ã€‚

SQL92ï¼Œæ˜¯æ•°æ®åº“çš„ä¸€ä¸ª ANSI/ISO æ ‡å‡†ã€‚å®ƒå®šä¹‰äº†ä¸€ç§è¯­è¨€ï¼ˆSQLï¼‰ä»¥åŠæ•°æ®åº“çš„è¡Œä¸ºï¼ˆäº‹åŠ¡ã€éš”ç¦»çº§åˆ«ç­‰ï¼‰ã€‚

#### COUNT(\*) çš„ä¼˜åŒ–

å‰é¢æåˆ°äº† COUNT(\*) æ˜¯ SQL92 å®šä¹‰çš„æ ‡å‡†ç»Ÿè®¡è¡Œæ•°çš„è¯­æ³•ï¼Œæ‰€ä»¥ MySQL æ•°æ®åº“å¯¹ä»–è¿›è¡Œè¿‡å¾ˆå¤šä¼˜åŒ–ã€‚ é‚£ä¹ˆï¼Œå…·ä½“éƒ½åšè¿‡å“ªäº›äº‹æƒ…å‘¢ï¼Ÿ

è¿™é‡Œçš„ä»‹ç»è¦åŒºåˆ†ä¸åŒçš„æ‰§è¡Œå¼•æ“ã€‚ MySQL ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ‰§è¡Œå¼•æ“å°±æ˜¯ InnoDB å’Œ MyISAMã€‚

MyISAM å’Œ InnoDB æœ‰å¾ˆå¤šåŒºåˆ«ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå…³é”®çš„åŒºåˆ«å’Œæˆ‘ä»¬æ¥ä¸‹æ¥è¦ä»‹ç»çš„ COUNT(\*) æœ‰å…³ï¼Œé‚£å°±æ˜¯ MyISAM ä¸æ”¯æŒäº‹åŠ¡ï¼ŒMyISAM ä¸­çš„é”æ˜¯è¡¨çº§é”ï¼› è€Œ InnoDB æ”¯æŒäº‹åŠ¡ï¼Œå¹¶ä¸”æ”¯æŒè¡Œçº§é”ã€‚

å› ä¸º MyISAM çš„é”æ˜¯è¡¨çº§é”ï¼Œæ‰€ä»¥åŒä¸€å¼ è¡¨ä¸Šé¢çš„æ“ä½œéœ€è¦ä¸²è¡Œè¿›è¡Œï¼Œæ‰€ä»¥ï¼Œ MyISAM åšäº†ä¸€ä¸ªç®€å•çš„ä¼˜åŒ–ï¼Œé‚£å°±æ˜¯å®ƒå¯ä»¥æŠŠè¡¨çš„æ€»è¡Œæ•°å•ç‹¬è®°å½•ä¸‹æ¥ï¼Œå¦‚æœä»ä¸€å¼ è¡¨ä¸­ä½¿ç”¨ COUNT(\*) è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥è¿”å›è¿™ä¸ªè®°å½•ä¸‹æ¥çš„æ•°å€¼å°±å¯ä»¥äº†ï¼Œå½“ç„¶ï¼Œå‰ææ˜¯ä¸èƒ½æœ‰ where æ¡ä»¶ã€‚

MyISAM ä¹‹æ‰€ä»¥å¯ä»¥æŠŠè¡¨ä¸­çš„æ€»è¡Œæ•°è®°å½•ä¸‹æ¥ä¾› COUNT(\*) æŸ¥è¯¢ä½¿ç”¨ï¼Œé‚£æ˜¯å› ä¸º MyISAM æ•°æ®åº“æ˜¯è¡¨çº§é”ï¼Œä¸ä¼šæœ‰å¹¶å‘çš„æ•°æ®åº“è¡Œæ•°ä¿®æ”¹ï¼Œæ‰€ä»¥æŸ¥è¯¢å¾—åˆ°çš„è¡Œæ•°æ˜¯å‡†ç¡®çš„ã€‚

ä½†æ˜¯ï¼Œå¯¹äº InnoDB æ¥è¯´ï¼Œå°±ä¸èƒ½åšè¿™ç§ç¼“å­˜æ“ä½œäº†ï¼Œå› ä¸º InnoDB æ”¯æŒäº‹åŠ¡ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯è¡Œçº§é”ï¼Œæ‰€ä»¥å¯èƒ½è¡¨çš„è¡Œæ•°å¯èƒ½ä¼šè¢«å¹¶å‘ä¿®æ”¹ï¼Œé‚£ä¹ˆç¼“å­˜è®°å½•ä¸‹æ¥çš„æ€»è¡Œæ•°å°±ä¸å‡†ç¡®äº†ã€‚

ä½†æ˜¯ï¼ŒInnoDB è¿˜æ˜¯é’ˆå¯¹ COUNT(\*) è¯­å¥åšäº†äº›ä¼˜åŒ–çš„ã€‚

åœ¨ InnoDB ä¸­ï¼Œä½¿ç”¨ COUNT(\*) æŸ¥è¯¢è¡Œæ•°çš„æ—¶å€™ï¼Œä¸å¯é¿å…çš„è¦è¿›è¡Œæ‰«è¡¨äº†ï¼Œé‚£ä¹ˆï¼Œå°±å¯ä»¥åœ¨æ‰«è¡¨è¿‡ç¨‹ä¸­ä¸‹åŠŸå¤«æ¥ä¼˜åŒ–æ•ˆç‡äº†ã€‚

ä» MySQL 8.0.13 å¼€å§‹ï¼Œé’ˆå¯¹ InnoDB çš„ SELECT COUNT(\*) FROM tbl_name è¯­å¥ï¼Œç¡®å®åœ¨æ‰«è¡¨çš„è¿‡ç¨‹ä¸­åšäº†ä¸€äº›ä¼˜åŒ–ã€‚ å‰ææ˜¯æŸ¥è¯¢è¯­å¥ä¸­ä¸åŒ…å« WHERE æˆ– GROUP BY ç­‰æ¡ä»¶ã€‚

æˆ‘ä»¬çŸ¥é“ï¼ŒCOUNT(\*) çš„ç›®çš„åªæ˜¯ä¸ºäº†ç»Ÿè®¡æ€»è¡Œæ•°ï¼Œæ‰€ä»¥ï¼Œä»–æ ¹æœ¬ä¸å…³å¿ƒè‡ªå·±æŸ¥åˆ°çš„å…·ä½“å€¼ï¼Œæ‰€ä»¥ï¼Œä»–å¦‚æœèƒ½å¤Ÿåœ¨æ‰«è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæˆæœ¬è¾ƒä½çš„ç´¢å¼•è¿›è¡Œçš„è¯ï¼Œé‚£å°±å¯ä»¥å¤§å¤§èŠ‚çœæ—¶é—´ã€‚

æˆ‘ä»¬çŸ¥é“ï¼ŒInnoDB ä¸­ç´¢å¼•åˆ†ä¸ºèšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰å’Œéèšç°‡ç´¢å¼•ï¼ˆéä¸»é”®ç´¢å¼•ï¼‰ï¼Œèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜çš„æ˜¯æ•´è¡Œè®°å½•ï¼Œè€Œéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸­ä¿å­˜çš„æ˜¯è¯¥è¡Œè®°å½•çš„ä¸»é”®çš„å€¼ã€‚

æ‰€ä»¥ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œéèšç°‡ç´¢å¼•è¦æ¯”èšç°‡ç´¢å¼•å°å¾ˆå¤šï¼Œæ‰€ä»¥ MySQL ä¼šä¼˜å…ˆé€‰æ‹©æœ€å°çš„éèšç°‡ç´¢å¼•æ¥æ‰«è¡¨ã€‚ æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å»ºè¡¨çš„æ—¶å€™ï¼Œé™¤äº†ä¸»é”®ç´¢å¼•ä»¥å¤–ï¼Œåˆ›å»ºä¸€ä¸ªéä¸»é”®ç´¢å¼•è¿˜æ˜¯æœ‰å¿…è¦çš„ã€‚

è‡³æ­¤ï¼Œæˆ‘ä»¬ä»‹ç»å®Œäº† MySQL æ•°æ®åº“å¯¹äº COUNT(\*) çš„ä¼˜åŒ–ï¼Œè¿™äº›ä¼˜åŒ–çš„å‰æéƒ½æ˜¯æŸ¥è¯¢è¯­å¥ä¸­ä¸åŒ…å« WHERE ä»¥åŠ GROUP BY æ¡ä»¶ã€‚

#### COUNT(\*) å’Œ COUNT(1)

ä»‹ç»å®Œäº† COUNT(\*) ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ COUNT(1) ï¼Œå¯¹äºï¼Œè¿™äºŒè€…åˆ°åº•æœ‰æ²¡æœ‰åŒºåˆ«ï¼Œç½‘ä¸Šçš„è¯´æ³•ä¼—è¯´çº·çº­ã€‚

æœ‰çš„è¯´ COUNT(\*) æ‰§è¡Œæ—¶ä¼šè½¬æ¢æˆ COUNT(1) ï¼Œæ‰€ä»¥ COUNT(1) å°‘äº†è½¬æ¢æ­¥éª¤ï¼Œæ‰€ä»¥æ›´å¿«ã€‚

è¿˜æœ‰çš„è¯´ï¼Œå› ä¸º MySQL é’ˆå¯¹ COUNT(\*) åšäº†ç‰¹æ®Šä¼˜åŒ–ï¼Œæ‰€ä»¥ COUNT(\*) æ›´å¿«ã€‚

é‚£ä¹ˆï¼Œåˆ°åº•å“ªç§è¯´æ³•æ˜¯å¯¹çš„å‘¢ï¼Ÿ çœ‹ä¸‹ MySQL å®˜æ–¹æ–‡æ¡£æ˜¯æ€ä¹ˆè¯´çš„ï¼š

> InnoDB handles SELECT COUNT(\*) and SELECT COUNT(1) operations in the same way. There is no performance difference.

ç”»é‡ç‚¹ï¼š same way , no performance difference ã€‚ æ‰€ä»¥ï¼Œå¯¹äº COUNT(1) å’Œ COUNT(\*)ï¼ŒMySQL çš„ä¼˜åŒ–æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œæ ¹æœ¬ä¸å­˜åœ¨è°æ¯”è°å¿«ï¼

é‚£æ—¢ç„¶ COUNT(\*) å’Œ COUNT(1) ä¸€æ ·ï¼Œå»ºè®®ç”¨å“ªä¸ªå‘¢ï¼Ÿ

å»ºè®®ä½¿ç”¨ COUNT(\*) ï¼ å› ä¸ºè¿™ä¸ªæ˜¯ SQL92 å®šä¹‰çš„æ ‡å‡†ç»Ÿè®¡è¡Œæ•°çš„è¯­æ³•ï¼Œè€Œä¸”æœ¬æ–‡åªæ˜¯åŸºäº MySQL åšäº†åˆ†æï¼Œå…³äº Oracle ä¸­çš„è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿæ˜¯ä¼—è¯´çº·çº­çš„å‘¢ã€‚

#### COUNT(å­—æ®µ)

æœ€åï¼Œå°±æ˜¯æˆ‘ä»¬ä¸€ç›´è¿˜æ²¡æåˆ°çš„ COUNT(å­—æ®µ)ï¼Œä»–çš„æŸ¥è¯¢å°±æ¯”è¾ƒç®€å•ç²—æš´äº†ï¼Œå°±æ˜¯è¿›è¡Œå…¨è¡¨æ‰«æï¼Œç„¶ååˆ¤æ–­æŒ‡å®šå­—æ®µçš„å€¼æ˜¯ä¸æ˜¯ä¸º NULLï¼Œä¸ä¸º NULL åˆ™ç´¯åŠ ã€‚

ç›¸æ¯” COUNT(\*) ï¼Œ COUNT(å­—æ®µ) å¤šäº†ä¸€ä¸ªæ­¥éª¤å°±æ˜¯åˆ¤æ–­æ‰€æŸ¥è¯¢çš„å­—æ®µæ˜¯å¦ä¸º NULLï¼Œæ‰€ä»¥ä»–çš„æ€§èƒ½è¦æ¯” COUNT(\*) æ…¢ã€‚

### 2. [kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±](https://blog.csdn.net/m0_62645012/article/details/139565489)

Kafka å‘é€æ¶ˆæ¯æ˜¯å¼‚æ­¥å‘é€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸï¼Œæ‰€ä»¥ä¼šå¯èƒ½é€ æˆæ¶ˆæ¯ä¸¢å¤±ã€‚è€Œä¸” Kafka æ¶æ„æ˜¯ç”±ç”Ÿäº§è€… - æœåŠ¡å™¨ç«¯ - æ¶ˆè´¹è€…ä¸‰ç§ç»„æˆéƒ¨åˆ†æ„æˆçš„ã€‚è¦ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œé‚£ä¹ˆä¸»è¦æœ‰ä¸‰ç§è§£å†³æ–¹æ³•ã€‚

![](../images/2025/03/a56c94819cc2d746d37e00254d529851.png)

#### ç”Ÿäº§è€… (producer) ç«¯å¤„ç†

ç”Ÿäº§è€…é»˜è®¤å‘é€æ¶ˆæ¯ä»£ç å¦‚ä¸‹ï¼š

```JAVA
import org.apache.kafka.clients.producer.Producer;
import org.apache.kafka.clients.producer.KafkaProducer;
import org.apache.kafka.clients.producer.ProducerRecord;
import java.util.Properties;

public class KafkaMessageProducer {

    public static void main(String[] args) {
        // é…ç½®Kafkaç”Ÿäº§è€…
        Properties props = new Properties();
        props.put("bootstrap.servers", "localhost:9092"); // Kafkaé›†ç¾¤åœ°å€
        props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer"); // é”®çš„åºåˆ—åŒ–å™¨
        props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer"); // å€¼çš„åºåˆ—åŒ–å™¨

        // åˆ›å»ºKafkaç”Ÿäº§è€…å®ä¾‹
        Producer<String, String> producer = new KafkaProducer<>(props);

        String topic = "test"; // Kafkaä¸»é¢˜

        try {
            // å‘é€æ¶ˆæ¯åˆ°Kafka
            for (int i = 0; i < 10; i++) {
                String message = "Message " + i;
                ProducerRecord<String, String> record = new ProducerRecord<>(topic, message);
                producer.send(record);
                System.out.println("Sent message: " + message);
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            // å…³é—­Kafkaç”Ÿäº§è€…
            producer.close();
        }
    }
}
```

ç”Ÿäº§è€…ç«¯è¦ä¿è¯æ¶ˆæ¯å‘é€æˆåŠŸï¼Œå¯ä»¥æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š

1. æŠŠå¼‚æ­¥å‘é€æ”¹æˆåŒæ­¥å‘é€ï¼Œè¿™æ · producer å°±èƒ½å®æ—¶çŸ¥é“æ¶ˆæ¯çš„å‘é€ç»“æœã€‚

è¦å°† Kafka å‘é€æ–¹æ³•æ”¹ä¸ºåŒæ­¥å‘é€ï¼Œå¯ä»¥ä½¿ç”¨ `send()` æ–¹æ³•çš„è¿”å›å€¼ `Future<RecordMetadata>`ï¼Œ å¹¶è°ƒç”¨ `get()` æ–¹æ³•æ¥ç­‰å¾…å‘é€å®Œæˆã€‚

ä»¥ä¸‹æ˜¯å°† Kafka å‘é€æ–¹æ³•æ”¹ä¸ºåŒæ­¥å‘é€çš„ç¤ºä¾‹ä»£ç ï¼š

```JAVA
import org.apache.kafka.clients.producer.Producer;
import org.apache.kafka.clients.producer.KafkaProducer;
import org.apache.kafka.clients.producer.ProducerRecord;
import java.util.Properties;
import java.util.concurrent.ExecutionException;
import org.apache.kafka.clients.producer.RecordMetadata;

public class KafkaMessageProducer {

    public static void main(String[] args) {
        // é…ç½® Kafka ç”Ÿäº§è€…
        Properties props = new Properties();
        props.put("bootstrap.servers", "localhost:9092"); // Kafka é›†ç¾¤åœ°å€
        props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer"); // é”®çš„åºåˆ—åŒ–å™¨
        props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer"); // å€¼çš„åºåˆ—åŒ–å™¨

        // åˆ›å»º Kafka ç”Ÿäº§è€…å®ä¾‹
        Producer<String, String> producer = new KafkaProducer<>(props);

        String topic = "test"; // Kafka ä¸»é¢˜

        try {
            // å‘é€æ¶ˆæ¯åˆ° Kafka
            for (int i = 0; i < 10; i++) {
                String message = "Message " + i;
                ProducerRecord<String, String> record = new ProducerRecord<>(topic, message);
                RecordMetadata metadata = producer.send(record).get(); // åŒæ­¥å‘é€å¹¶ç­‰å¾…å‘é€å®Œæˆ
                System.out.println("Sent message: " + message + ", offset: " + metadata.offset());
            }
        } catch (InterruptedException | ExecutionException e) {
            e.printStackTrace();
        } finally {
            // å…³é—­ Kafka ç”Ÿäº§è€…
            producer.close();
        }
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡è°ƒç”¨ `send(record).get()` å®ç°äº†åŒæ­¥å‘é€ï¼Œå…¶ä¸­ `get()` æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å‘é€å®Œæˆå¹¶è¿”å›æ¶ˆæ¯çš„å…ƒæ•°æ®ã€‚

2. æ·»åŠ å¼‚æ­¥å›è°ƒå‡½æ•°æ¥ç›‘å¬æ¶ˆæ¯å‘é€çš„ç»“æœï¼Œå¦‚æœå‘é€å¤±è´¥ï¼Œå¯ä»¥åœ¨å›è°ƒå‡½æ•°é‡Œé‡æ–°å‘é€ã€‚

è¦ä¿æŒå‘é€æ¶ˆæ¯æˆåŠŸå¹¶æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä½ å¯ä»¥åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™æŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚å›è°ƒ å‡½æ•°å°†åœ¨æ¶ˆæ¯å‘é€å®Œæˆåè¢«è°ƒç”¨ï¼Œä»¥ä¾¿ä½ å¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­å¤„ç†å‘é€ç»“æœã€‚

```JAVA
import org.apache.kafka.clients.producer.Producer;
import org.apache.kafka.clients.producer.KafkaProducer;
import org.apache.kafka.clients.producer.ProducerRecord;
import java.util.Properties;
import org.apache.kafka.clients.producer.Callback;
import org.apache.kafka.clients.producer.RecordMetadata;

public class KafkaMessageProducer {

    public static void main(String[] args) {
        // é…ç½® Kafka ç”Ÿäº§è€…
        Properties props = new Properties();
        props.put("bootstrap.servers", "localhost:9092"); // Kafka é›†ç¾¤åœ°å€
        props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer"); // é”®çš„åºåˆ—åŒ–å™¨
        props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer"); // å€¼çš„åºåˆ—åŒ–å™¨

        // åˆ›å»º Kafka ç”Ÿäº§è€…å®ä¾‹
        Producer<String, String> producer = new KafkaProducer<>(props);

        String topic = "test"; // Kafka ä¸»é¢˜

        try {
            // å‘é€æ¶ˆæ¯åˆ° Kafka
            for (int i = 0; i < 10; i++) {
                String message = "Message " + i;
                ProducerRecord<String, String> record = new ProducerRecord<>(topic, message);

                // å‘é€æ¶ˆæ¯å¹¶æŒ‡å®šå›è°ƒå‡½æ•°
                producer.send(record, new Callback() {
                    @Override
                    public void onCompletion(RecordMetadata metadata, Exception exception) {
                        if (exception == null) {
                            System.out.println("Sent message: " + message + ", offset: " + metadata.offset());
                        } else {
                            // è¿™é‡Œé‡æ–°å‘é€æ¶ˆæ¯
                            producer.send(record);
                            exception.printStackTrace();
                        }
                    }
                });
            }
        } finally {
            // å…³é—­ Kafka ç”Ÿäº§è€…
            producer.close();
        }
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `send(record, callback)` æ–¹æ³•æ¥å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¼ é€’äº†ä¸€ä¸ªå®ç°äº† Callback æ¥å£çš„åŒ¿åå†…éƒ¨ç±»ä½œä¸ºå›è°ƒå‡½æ•°ã€‚å½“æ¶ˆæ¯å‘é€å®Œæˆåï¼Œå›è°ƒå‡½æ•°çš„ `onCompletion()` æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚ä½ å¯ä»¥æ ¹æ® RecordMetadata å’Œ Exception å‚æ•°æ¥å¤„ç†å‘é€ç»“æœã€‚

å¦å¤– producer è¿˜æä¾›äº†ä¸€ä¸ªé‡è¯•å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å« retriesï¼Œå¦‚æœå› ä¸ºç½‘ç»œé—®é¢˜æˆ–è€… Broker æ•…éšœå¯¼è‡´ producer å‘é€æ¶ˆæ¯å¤±è´¥ï¼Œé‚£ä¹ˆ producer ä¼šæ ¹æ®è¿™ä¸ªå‚æ•°çš„å€¼è¿›è¡Œé‡è¯•å‘é€æ¶ˆæ¯ã€‚

#### æœåŠ¡å™¨ç«¯ (Broker) ç«¯

Kafka Brokerï¼ˆæœåŠ¡å™¨ç«¯ï¼‰é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥ç¡®ä¿ç”Ÿäº§è€…ç«¯æ¶ˆæ¯å‘é€çš„æˆåŠŸå’Œä¸ä¸¢å¤±ï¼š

1. æ¶ˆæ¯æŒä¹…åŒ–ï¼ˆå¼‚æ­¥åˆ·ç›˜ï¼‰ï¼šKafka Broker å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚è¿™æ ·å³ä½¿åœ¨æ¶ˆæ¯å‘é€åå‘ç”Ÿæ•…éšœï¼ŒBroker èƒ½å¤Ÿæ¢å¤å¹¶ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚ï¼ˆæ³¨æ„ï¼šæŒä¹…åŒ–æ˜¯ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦çš„ï¼Œå¦‚æœæŒä¹…åŒ–ä¹‹å‰ç³»ç»Ÿå´©æºƒäº†ï¼Œé‚£ä¹ˆå°±å› ä¸ºä¸èƒ½æŒä¹…åŒ–å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œä½†æ˜¯ Kafka æ²¡æä¾›åŒæ­¥åˆ·ç›˜ç­–ç•¥ï¼‰

2. å¤åˆ¶ä¸é«˜å¯ç”¨æ€§ï¼šKafka æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå¯ä»¥å°†æ¶ˆæ¯åˆ†å¸ƒåˆ°å¤šä¸ª Broker ä¸Šå½¢æˆä¸€ä¸ª Broker é›†ç¾¤ã€‚åœ¨é›†ç¾¤ä¸­ï¼Œæ¶ˆæ¯è¢«å¤åˆ¶åˆ°å¤šä¸ªå‰¯æœ¬ä¸­ï¼Œä»¥æä¾›å†—ä½™å’Œé«˜å¯ç”¨æ€§ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶ï¼Œå®ƒå¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä»»ä½•ä¸€ä¸ª Brokerï¼Œç„¶å Broker å°†ç¡®ä¿æ¶ˆæ¯åœ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰å‰¯æœ¬ä¸­éƒ½è¢«å¤åˆ¶æˆåŠŸã€‚

3. æ¶ˆæ¯æäº¤ç¡®è®¤ï¼šå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åï¼Œåœ¨æ”¶åˆ° Broker çš„ç¡®è®¤å“åº”ä¹‹å‰ï¼Œç”Ÿäº§è€…ä¼šç­‰å¾…ã€‚å¦‚æœæ¶ˆæ¯æˆåŠŸå†™å…¥å¹¶å¤åˆ¶åˆ°äº†æŒ‡å®šçš„å‰¯æœ¬ä¸­ï¼ŒBroker ä¼šå‘é€ç¡®è®¤å“åº”ç»™ç”Ÿäº§è€…ã€‚å¦‚æœç”Ÿäº§è€…åœ¨æŒ‡å®šçš„æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤å“åº”ï¼Œå®ƒå°†ä¼šå°è¯•é‡æ–°å‘é€æ¶ˆæ¯ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚

4. å¯é æ€§è®¾ç½®ï¼ˆåŒæ­¥åˆ·ç›˜ï¼‰ï¼šç”Ÿäº§è€…å¯ä»¥é…ç½®ä¸€äº›å‚æ•°æ¥æé«˜æ¶ˆæ¯å‘é€çš„å¯é æ€§ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½® `acks` å‚æ•°æ¥æŒ‡å®šéœ€è¦æ”¶åˆ°å¤šå°‘ä¸ª Broker çš„ç¡®è®¤å“åº”æ‰è®¤ä¸ºæ¶ˆæ¯å‘é€æˆåŠŸã€‚å¯ä»¥å°† `acks` è®¾ç½®ä¸º `"all"`ï¼Œè¡¨ç¤ºéœ€è¦æ”¶åˆ°æ‰€æœ‰å‰¯æœ¬çš„ç¡®è®¤å“åº”æ‰ç®—å‘é€æˆåŠŸã€‚

æ€»ä¹‹ï¼ŒKafka Broker é€šè¿‡æŒä¹…åŒ–å’Œå¤åˆ¶æœºåˆ¶ï¼Œä»¥åŠæ¶ˆæ¯ç¡®è®¤å’Œå¯é æ€§è®¾ç½®ï¼Œç¡®ä¿ç”Ÿäº§è€…ç«¯çš„æ¶ˆæ¯å‘é€æˆåŠŸä¸”ä¸ä¸¢å¤±ã€‚åŒæ—¶ï¼Œåº”æ³¨æ„åŠæ—¶å¤„ç†å¯èƒ½çš„é”™è¯¯æƒ…å†µï¼Œå¹¶æ ¹æ®ç”Ÿäº§è€…ç«¯éœ€æ±‚å’Œåœºæ™¯åˆç†é…ç½®ç›¸åº”çš„å‚æ•°ã€‚

å¯¹äºä½¿ç”¨ YAML æ–‡ä»¶è¿›è¡Œ Kafka é…ç½®çš„æƒ…å†µï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è®¾ç½® acks å‚æ•°ï¼š

```YAML
# Kafkaç”Ÿäº§è€…é…ç½®
producer:
  bootstrap.servers: your-kafka-server:9092
  acks: all        # è®¾ç½®ackså‚æ•°ä¸º"all"
  key.serializer: org.apache.kafka.common.serialization.StringSerializer
  value.serializer: org.apache.kafka.common.serialization.StringSerializer
```

#### æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰å¤„ç†

Kafka Consumer é»˜è®¤ä¼šç¡®ä¿æ¶ˆæ¯çš„è‡³å°‘ä¸€æ¬¡ä¼ é€’ï¼ˆat least once deliveryï¼‰ã€‚è¿™æ„å‘³ç€å½“ Consumer å®Œæˆå¯¹ä¸€æ¡æ¶ˆæ¯çš„å¤„ç†åï¼Œä¼šå‘ Kafka æäº¤æ¶ˆæ¯çš„åç§»é‡ï¼ˆoffsetï¼‰ï¼Œå‘ŠçŸ¥ Kafka è¿™æ¡æ¶ˆæ¯å·²è¢«æˆåŠŸå¤„ç†ã€‚å¦‚æœ Consumer åœ¨å¤„ç†æ¶ˆæ¯æ—¶å‘ç”Ÿé”™è¯¯ï¼Œå¯ä»¥é€šè¿‡å›æ»šåç§»é‡æ¥é‡è¯•å¤„ç†ä¹‹å‰çš„æ¶ˆæ¯ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›ç¡®ä¿æ¶ˆæ¯æ¶ˆè´¹æˆåŠŸçš„æ–¹æ³•ï¼š

- ä½¿ç”¨è‡ªåŠ¨æäº¤åç§»é‡ï¼ˆAuto Commit Offsetsï¼‰
- æ‰‹åŠ¨æäº¤åç§»é‡ï¼ˆManual Commit Offsetsï¼‰
- è®¾ç½®æ¶ˆè´¹è€…çš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼š
- è®¾ç½®é€‚å½“çš„æ¶ˆè´¹è€…å‚æ•°

å°½ç®¡ Kafka æä¾›äº†å¯é çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼Œä½†ä»ç„¶éœ€è¦åœ¨æ¶ˆè´¹è€…ç«¯å®ç°é€‚å½“çš„é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘ï¼Œä»¥å¤„ç†å¯èƒ½å‘ç”Ÿçš„é”™è¯¯æƒ…å†µã€‚

## tip [ğŸ”](#weekly-104)

## share [ğŸ”](#weekly-104)

[readme](../README.md) | [previous](202502W4.md) | [next](202503W2.md)
