> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2025-01-12 - 2025-01-18

# Weekly #97

[readme](../README.md) | [previous](202501W2.md) | [next](202501W4.md)

![](../images/2025/01/andrey-zvyagintsev-7N2NUZ9Vr40-unsplash.jpg "Weekly #97")

\**Photo by [Andrey Zvyagintsev](https://unsplash.com/@zvandrei) on [Unsplash](https://unsplash.com/photos/woman-in-black-and-white-long-sleeve-shirt-standing-on-road-during-daytime-7N2NUZ9Vr40)*      

## Table of Contents

- [algorithm](#algorithm-)
	- å­—æ¯å¼‚ä½è¯åˆ†ç»„
	- æœ€é•¿è¿ç»­åºåˆ—
- [review](#review-)
	- live å›¾åŸç†ä»‹ç»
	- åŒå› å­è®¤è¯è§£å†³æ–¹æ¡ˆ
- [tip](#tip-)
- [share](#share-)

## algorithm [ğŸ”](#weekly-97)

### 1. [49. å­—æ¯å¼‚ä½è¯åˆ†ç»„](https://leetcode.cn/problems/group-anagrams/description/?envType=study-plan-v2&envId=top-100-liked)

#### é¢˜ç›®

ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¯·ä½ å°† å­—æ¯å¼‚ä½è¯ ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœåˆ—è¡¨ã€‚

å­—æ¯å¼‚ä½è¯ æ˜¯ç”±é‡æ–°æ’åˆ—æºå•è¯çš„æ‰€æœ‰å­—æ¯å¾—åˆ°çš„ä¸€ä¸ªæ–°å•è¯ã€‚

 

ç¤ºä¾‹ 1:

è¾“å…¥: strs = ["eat", "tea", "tan", "ate", "nat", "bat"]
è¾“å‡º: [["bat"],["nat","tan"],["ate","eat","tea"]]
ç¤ºä¾‹ 2:

è¾“å…¥: strs = [""]
è¾“å‡º: [[""]]
ç¤ºä¾‹ 3:

è¾“å…¥: strs = ["a"]
è¾“å‡º: [["a"]]

æç¤ºï¼š

- 1 <= strs.length <= 104
- 0 <= strs[i].length <= 100
- strs[i] ä»…åŒ…å«å°å†™å­—æ¯

#### è§£æ³•

> [49.group-anagrams.go](../code/leetcode/49.group-anagrams.go)

```go
func groupAnagrams(strs []string) [][]string {
    if len(strs) == 1 {
        return [][]string{strs}
    }

    maps := make(map[string][]string, 0)
    for _, str := range strs {
        bytes := []byte(str)
        sort.Slice(bytes, func(i, j int) bool {
            return bytes[i] < bytes[j]
        })

        newStr := string(bytes)
        maps[newStr] = append(maps[newStr], str)
    }

    res := make([][]string, 0)
    for _, v := range maps {
        res = append(res, v)
    }

    return res
}
```

æ•°æ®ï¼š8ms 70.07%; 9.23MB 82.70%

### 2. [128. æœ€é•¿è¿ç»­åºåˆ—](https://leetcode.cn/problems/longest-consecutive-sequence/description/?envType=study-plan-v2&envId=top-100-liked)

#### é¢˜ç›®

ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡ºæ•°å­—è¿ç»­çš„æœ€é•¿åºåˆ—ï¼ˆä¸è¦æ±‚åºåˆ—å…ƒç´ åœ¨åŸæ•°ç»„ä¸­è¿ç»­ï¼‰çš„é•¿åº¦ã€‚

è¯·ä½ è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚

ç¤ºä¾‹ 1ï¼š

è¾“å…¥ï¼šnums = [100,4,200,1,3,2]
è¾“å‡ºï¼š4
è§£é‡Šï¼šæœ€é•¿æ•°å­—è¿ç»­åºåˆ—æ˜¯ [1, 2, 3, 4]ã€‚å®ƒçš„é•¿åº¦ä¸º 4ã€‚
ç¤ºä¾‹ 2ï¼š

è¾“å…¥ï¼šnums = [0,3,7,2,5,8,4,6,0,1]
è¾“å‡ºï¼š9
ç¤ºä¾‹ 3ï¼š

è¾“å…¥ï¼šnums = [1,0,1,2]
è¾“å‡ºï¼š3
 

æç¤ºï¼š

- 0 <= nums.length <= 105
- -109 <= nums[i] <= 109

#### è§£ç­”

> è§£é¢˜æ€è·¯ï¼šhttps://leetcode.cn/problems/longest-consecutive-sequence/description/comments/2436490/
>
> å‡è®¾é¢˜ç›®æ²¡æœ‰è¦O(n)çš„æ—¶é—´å¤æ‚åº¦çš„è¯ï¼Œè‚¯å®šå°±æ˜¯å…ˆå°†æ•°ç»„æ’åºååœ¨éå†æ•°ç»„è®¡ç®—æœ€é•¿çš„è¿ç»­åºåˆ—ã€‚
>
> é‚£ä¹ˆè¯¥å¦‚ä½•åªç”¨O(n)çš„æ—¶é—´å¤æ‚åº¦æ¥å®Œæˆè¿™é“é¢˜å‘¢?
>
> æ’åºçš„ç›®çš„æ˜¯ä¸ºäº†è®©è¿ç»­çš„æ•°å­—åœ¨ç‰©ç†å±‚é¢ç´§æŒ¨åœ¨ä¸€èµ·ï¼Œä¸æ’åºçš„è¯ï¼Œç°åœ¨è®©å®ƒä»¬é€»è¾‘ä¸ŠæŒ¨åœ¨ä¸€èµ·å°±è¡Œäº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å“ˆå¸Œè¡¨æ¥å®ç°æ•°å­—åœ¨é€»è¾‘æ–¹é¢æŒ¨åœ¨ä¸€èµ·ã€‚å“ˆå¸Œè¡¨çš„keyå°±æ˜¯æ•°å­—ï¼Œvalueåˆ™ä¸ºåŒ…å«keyçš„æœ€é•¿è¿ç»­åºåˆ—çš„é•¿åº¦ã€‚
é‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±å˜æˆçš„å¦‚ä½•ç”¨valueè¡¨ç¤ºåŒ…å«keyçš„æœ€é•¿è¿ç»­åºåˆ—çš„é•¿åº¦ã€‚
éå†æ•°ç»„ï¼Œå°†ç¬¬iä½å…ƒç´ numæ’å…¥å“ˆå¸Œè¡¨ï¼Œå°±å­˜åœ¨3ç§æƒ…å†µï¼š
>
> - ä»…numåœ¨å“ˆå¸Œè¡¨ä¸­ã€‚
> - num-1æˆ–è€…num+1ä¹Ÿåœ¨å“ˆå¸Œè¡¨ä¸­ã€‚
> - num-1å’Œnum+1éƒ½åœ¨å“ˆå¸Œè¡¨ä¸­ã€‚
>
> å› ä¸ºå“ˆå¸Œè¡¨çš„valueå­˜çš„æ˜¯é•¿åº¦ï¼Œå½“æœ‰æ–°æ•°å­—æ’å…¥æ—¶ï¼Œä¸å…¶ç›¸é‚»çš„æ•°å­—é•¿åº¦ä¹Ÿéœ€è¦æ”¹å˜ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸éœ€è¦æŠŠè¿™ä¸ªè¿ç»­åºåˆ—å…¨éƒ¨éƒ½ä¿®æ”¹ï¼Œåªéœ€è¦ä¿®æ”¹è¿™ä¸ªè¿ç»­åºåˆ—çš„è¾¹ç¼˜æ•°å­—ï¼Œå› ä¸ºè¿ç»­åºåˆ—å†…çš„æ•°å­—æ”¹å˜æ²¡æœ‰æ„ä¹‰ï¼Œæˆ‘ä»¬ä¸ä¼šæŠŠæ•°å­—æ’å…¥åˆ°è¿ç»­åºåˆ—å†…

> [128.longest-consecutive-sequence.go](../code/leetcode/128.longest-consecutive-sequence.go)

```go
func longestConsecutive(nums []int) int {
    dict := make(map[int]int)
    for _, num := range nums {
        if _, ok := dict[num]; !ok {
            prev := dict[num-1]
            next := dict[num+1]

            dict[num] += prev+next+1
            dict[num-prev] = dict[num]
            dict[num+next] = dict[num]
        }
    }

    res := 0
    for _, v := range dict {
        if v > res {
            res = v
        }
    }
    return res
}
```

æ•°æ®ï¼š63ms 10.11%; 13.98MB 10.99%

é€Ÿåº¦æœ€å¿«çš„è§£æ³•å¦‚ä¸‹ï¼Œå…ˆæ’åºç„¶åéå†è®¡æ•°ï¼š

```go
func longestConsecutive(nums []int) int {
	if len(nums) == 0 {
		return 0
	}
	sort.Ints(nums)
	res := 1
	cur := 1
	for j := 1; j < len(nums); j++ {
		switch nums[j] - nums[j-1] {
		case 1:
			cur++
			res = max(res, cur)
		case 0:
		default:
			cur = 1
		}
	}
	return res
}
```

## review [ğŸ”](#weekly-97)

### 1. [live å›¾åŸç†ä»‹ç»](https://github.com/LLLLLayer/Live-Photos)

å›¾ç‰‡æ‹¥æœ‰å±æ€§ï¼Œå¯¹äºå¤§å¤šæ•°å›¾åƒæ–‡ä»¶æ ¼å¼ï¼Œä½¿ç”¨ [CGImageSource](https://developer.apple.com/documentation/imageio/cgimagesource) ç±»å‹å¯ä»¥æœ‰æ•ˆåœ°è¯»å–æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ [The Photo Investigator](https://apps.apple.com/us/app/photo-investigator-view-edit/id571574618) åº”ç”¨æŸ¥çœ‹ç…§ç‰‡ä¸­çš„æ‰€æœ‰ Metadataï¼š

![](../images/2025/01/ThePhotoInvestigator.png)

æ‹æ‘„ç…§ç‰‡æ—¶ï¼ŒApple ç›¸æœºä¼šè‡ªåŠ¨ä¸ºç…§ç‰‡æ·»åŠ ä¸åŒç§ç±»çš„ Metadataã€‚å¤§å¤šæ•°å…ƒæ•°æ®éƒ½å¾ˆå¥½ç†è§£ï¼Œå¦‚ä½ç½®å­˜å‚¨åœ¨ GPS Metadata ä¸­ã€ç›¸æœºä¿¡æ¯ä½äº EXIF Metadata ä¸­ã€‚

å…¶ä¸­ [kCGImagePropertyMakerAppleDictionary](https://developer.apple.com/documentation/imageio/kcgimagepropertymakerappledictionary) æ˜¯ Apple ç›¸æœºæ‹æ‘„çš„ç…§ç‰‡çš„é”®å€¼å¯¹å­—å…¸ã€‚â€œ17â€ æ˜¯ Maker Apple ä¸­çš„ LivePhotoVideoIndexï¼Œæ˜¯ Live Photo çš„ Identifier Keyï¼Œå®Œæ•´åˆ—è¡¨å¯ä»¥å‚è€ƒ [Apple Tags](https://exiftool.org/TagNames/Apple.html)ã€‚

Live Photo éœ€è¦æœ‰ç‰¹æ®Š Metadata çš„ JPEG å›¾åƒï¼š

```Markdown
[kCGImagePropertyMakerAppleDictionary : [17 : <Identifier>]]
```

> [!NOTE]  
> ä½œè€…è¿˜ä»‹ç»äº†å¦‚ä½• å°† Live Photo åˆ†è§£ä¸ºç…§ç‰‡å’Œè§†é¢‘ ä»¥åŠ ä½¿ç”¨ç…§ç‰‡å’Œè§†é¢‘åˆ›å»º Live Photo

### 2. [åŒå› å­è®¤è¯è§£å†³æ–¹æ¡ˆ](https://www.cnblogs.com/think-in-java/p/11443014.html)

#### ä»€ä¹ˆå«åŒå› å­è®¤è¯ï¼Ÿ

> é€šä¿—çš„è®²ï¼Œä¸€èˆ¬çš„è®¤è¯æ–¹å¼éƒ½æ˜¯ç”¨æˆ·å / å¯†ç çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åªæœ‰å¯†ç è¿™ä¸€ä¸ªå› å­æ¥ä½œè®¤è¯ï¼ŒåŒå› å­æ— éæ˜¯å¢åŠ ä¸€ä¸ªå› å­ï¼Œå¢å¼ºè®¤è¯çš„å®‰å…¨æ€§ã€‚

#### å¸¸è§è§£å†³æ–¹æ¡ˆ

- çŸ­ä¿¡æ–¹å¼
- é‚®ä»¶æ–¹å¼
- ç”µè¯è¯­éŸ³æ–¹å¼
- TOTP è§£å†³æ–¹æ¡ˆ

å‰ä¸‰ç§æ–¹æ¡ˆï¼Œå…¶å®éƒ½å¤§åŒå°å¼‚ã€‚Server ç«¯é€šè¿‡æŸç§ç®—æ³•ç”Ÿæˆä¸€æ®µéšæœºå¯†ç ï¼Œé€šè¿‡çŸ­ä¿¡ã€é‚®ä»¶æˆ–è€…ç”µè¯çš„æ–¹å¼ä¼ é€’ç»™ç”¨æˆ·ï¼Œç”¨æˆ·æŠŠéšæœºå¯†ç ä½œä¸ºç™»å½•çš„å‡­è¯ä¼ é€’ç»™ Serverï¼ŒServer éªŒè¯é€šè¿‡ä¹‹åï¼Œå°±å®Œæˆäº†ä¸€æ¬¡åŒå› å­è®¤è¯ã€‚ä½†æ˜¯çŸ­ä¿¡å’Œç”µè¯è¯­éŸ³å¯¹äºè¿è¥å…¬å¸æ˜¯æœ‰ä¸€å®šçš„æˆæœ¬çš„ï¼Œé™¤æ­¤ä¹‹å¤–æœ‰äº›éäº’è”ç½‘çš„åº”ç”¨å¯èƒ½å¹¶ä¸é€šå…¬ç½‘ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒTOTP ä¸å¤±ä¸ºä¸€ç§å¥½çš„åŒå› å­è®¤è¯çš„è§£å†³æ–¹æ¡ˆã€‚

#### ä»€ä¹ˆæ˜¯ TOTPï¼Ÿ

> æ˜¯ Time-based One-Time Password çš„ç®€å†™ï¼Œè¡¨ç¤ºåŸºäºæ—¶é—´æˆ³ç®—æ³•çš„ä¸€æ¬¡æ€§å¯†ç ã€‚

å¦‚æœå¤§å®¶ç©è¿‡æ¢¦å¹»è¥¿æ¸¸çš„è¯ï¼Œé‚£ä¹ˆå¯¹`å°†å†›ä»¤`åº”è¯¥ä¸é™Œç”Ÿï¼Œè¿™ä¸ªå°±æ˜¯åŸºäº TOTP çš„ä¸€ä¸ªäº§ç‰©ã€‚

#### OTP

ä»‹ç» TOTP ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸‹`OTP`

> One-Time Password çš„ç®€å†™ï¼Œè¡¨ç¤ºä¸€æ¬¡æ€§å¯†ç ã€‚

`OTP(K,C) = Truncate(HMAC-SHA-1(K,C))`

å…¶ä¸­ï¼ŒK ä»£è¡¨å¯†é’¥ä¸²ï¼›C æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºéšæœºæ•°ï¼›HMAC-SHA-1 è¡¨ç¤ºç”¨ SHA-1 åš HMACï¼›

Truncate æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæˆªå–åŠ å¯†åçš„ä¸²ï¼Œå¹¶å–åŠ å¯†åä¸²çš„ä¸€äº›å­—æ®µç»„æˆä¸€ä¸ªæ•°å­—ã€‚

å¯¹ HMAC-SHA-1 æ–¹å¼åŠ å¯†æ¥è¯´ï¼ŒTruncate å®ç°å¦‚ä¸‹ï¼š

- HMAC-SHA-1 åŠ å¯†åçš„é•¿åº¦å¾—åˆ°ä¸€ä¸ª 20 å­—èŠ‚çš„å¯†ä¸²ï¼›
- å–è¿™ä¸ª 20 å­—èŠ‚çš„å¯†ä¸²çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œå–è¿™å­—èŠ‚çš„ä½ 4 ä½ï¼Œä½œä¸ºæˆªå–åŠ å¯†ä¸²çš„ä¸‹æ ‡åç§»é‡ï¼›
- æŒ‰ç…§ä¸‹æ ‡åç§»é‡å¼€å§‹ï¼Œè·å– 4 ä¸ªå­—èŠ‚ï¼Œä»¥å¤§ç«¯ï¼ˆæŠŠé«˜ä½å­—èŠ‚æ”¾åœ¨ä½ä½åœ°å€ï¼‰çš„æ–¹å¼ç»„æˆä¸€ä¸ªæ•´æ•°ï¼›
- æˆªå–è¿™ä¸ªæ•´æ•°çš„å 6 ä½æˆ–è€… 8 ä½è½¬æˆå­—ç¬¦ä¸²è¿”å›ã€‚

```java
public static String generateOTP(String K, String C, String returnDigits, String crypto) {
	int codeDigits = Integer.decode(returnDigits).intValue();
	String result = null;

	// Kæ˜¯å¯†ç 
	// Cæ˜¯äº§ç”Ÿçš„éšæœºæ•°
	// cryptoæ˜¯åŠ å¯†ç®—æ³• HMAC-SHA-1
	byte[] hash = hmac_sha(crypto, K, C);
	// hashä¸º20å­—èŠ‚çš„å­—ç¬¦ä¸²

	// put selected bytes into result int
	// è·å–hashæœ€åä¸€ä¸ªå­—èŠ‚çš„ä½4ä½ï¼Œä½œä¸ºé€‰æ‹©ç»“æœçš„å¼€å§‹ä¸‹æ ‡åç§»
	int offset = hash[hash.length - 1] & 0xf;

	// è·å–4ä¸ªå­—èŠ‚ç»„æˆä¸€ä¸ªæ•´æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚æœ€é«˜ä½ä¸ºç¬¦å·ä½ï¼Œä¸è·å–ï¼Œä½¿ç”¨0x7f
	int binary = ((hash[offset] & 0x7f) << 24) | ((hash[offset + 1] & 0xff) << 16) | ((hash[offset + 2] & 0xff) << 8) | (hash[offset + 3] & 0xff);
	// è·å–è¿™ä¸ªæ•´æ•°çš„å6ä½ï¼ˆå¯ä»¥æ ¹æ®éœ€è¦å–å8ä½ï¼‰
	int otp = binary % 1000000;
	// å°†æ•°å­—è½¬æˆå­—ç¬¦ä¸²ï¼Œä¸å¤Ÿ6ä½å‰é¢è¡¥0
	result = Integer.toString(otp);
	while (result.length() < codeDigits) {
		result = "0" + result;
	}
	return result;
}
```

è¿”å›çš„ç»“æœå°±æ˜¯çœ‹åˆ°ä¸€ä¸ªæ•°å­—çš„åŠ¨æ€å¯†ç ã€‚

#### HOTP

çŸ¥é“äº† OTP çš„åŸºæœ¬åŸç†ï¼ŒHOTP åªæ˜¯å°†å…¶ä¸­çš„å‚æ•° C å˜æˆäº†éšæœºæ•°

å…¬å¼ä¿®æ”¹ä¸€ä¸‹

> HOTP(K,C) = Truncate(HMAC-SHA-1(K,C))

HOTPï¼š Generates the OTP for the given count

å³ï¼šC ä½œä¸ºä¸€ä¸ªå‚æ•°ï¼Œè·å–åŠ¨æ€å¯†ç ã€‚

ä¸€èˆ¬è§„å®š HOTP çš„æ•£åˆ—å‡½æ•°ä½¿ç”¨ SHA2ï¼Œå³ï¼šåŸºäº SHA-256 or SHA-512 [SHA2] çš„æ•£åˆ—å‡½æ•°åšäº‹ä»¶åŒæ­¥éªŒè¯ï¼›

#### TOTP è¯¦è§£

> TOTP åªæ˜¯å°†å…¶ä¸­çš„å‚æ•° C å˜æˆäº†ç”±æ—¶é—´æˆ³äº§ç”Ÿçš„æ•°å­—ã€‚

`TOTP(K,C) = HOTP(K,C) = Truncate(HMAC-SHA-1(K,C))`

ä¸åŒç‚¹æ˜¯ TOTP ä¸­çš„ C æ˜¯æ—¶é—´æˆ³è®¡ç®—å¾—å‡ºã€‚

`C = (T - T0) / X;`

T è¡¨ç¤ºå½“å‰ Unix æ—¶é—´æˆ³

> T0 ä¸€èˆ¬å–å€¼ä¸º 0.
> 
> X è¡¨ç¤ºæ—¶é—´æ­¥æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šé•¿æ—¶é—´äº§ç”Ÿä¸€ä¸ªåŠ¨æ€å¯†ç ï¼Œè¿™ä¸ªæ—¶é—´é—´éš”å°±æ˜¯æ—¶é—´æ­¥æ•° Xï¼Œç³»ç»Ÿé»˜è®¤æ˜¯ 30 ç§’ï¼›
> 
> ä¾‹å¦‚:
> 
> T0 = 0;
> 
> X = 30;
> 
> T = 30 ~ 59, C = 1; è¡¨ç¤º 30 ~ 59 è¿™ 30 ç§’å†…çš„åŠ¨æ€å¯†ç ä¸€è‡´ã€‚
> 
> T = 60 ~ 89, C = 2; è¡¨ç¤º 30 ~ 59 è¿™ 30 ç§’å†…çš„åŠ¨æ€å¯†ç ä¸€è‡´ã€‚

ä¸åŒå‚å®¶ä½¿ç”¨çš„æ—¶é—´æ­¥æ•°ä¸åŒ;

- é˜¿é‡Œå·´å·´çš„èº«ä»½å®ä½¿ç”¨çš„æ—¶é—´æ­¥æ•°æ˜¯ 60 ç§’ï¼›
- å®ç›¾ä»¤ç‰Œä½¿ç”¨çš„æ—¶é—´æ­¥æ•°æ˜¯ 60 ç§’ï¼›
- Google çš„ [èº«ä»½éªŒè¯å™¨](https://github.com/google/google-authenticator)çš„æ—¶é—´æ­¥æ•°æ˜¯ 30 ç§’ï¼›
- è…¾è®¯çš„ Token æ—¶é—´æ­¥æ•°æ˜¯ 60 ç§’ï¼›

#### åº”ç”¨

å®¢æˆ·ç«¯çš„å®ç°æœ‰å¾ˆå¤šï¼Œä¸Šé¢å·²ç»åˆ—å‡ºæ¥äº†ã€‚è€ŒæœåŠ¡ç«¯çš„å®ç°åº“æ¯”è¾ƒå°‘ï¼Œè²Œä¼¼ä¹Ÿéƒ½æ˜¯éå®˜æ–¹çš„å®ç°ã€‚è¿™é‡Œæ¨èä¸€ä¸ª [JAVA çš„å®ç°åº“](https://github.com/wstrange/GoogleAuth), è¿™æ˜¯ä¸€ä¸ªç§äººçš„åº“, ä»‹æ„çš„æœ‹å‹åªèƒ½è‡ªå·±æ’¸è½®å­äº†ã€‚

è¿™é‡ŒåŸºäºä¸Šè¿°çš„å®ç°åº“ï¼Œç»™å‡ºä¸€æ®µ demo ä»£ç ï¼Œä»…ä¾›å‚è€ƒã€‚

```java
package com.github.chenqimiao.util;

import java.text.MessageFormat;

import com.warrenstrange.googleauth.GoogleAuthenticator;
import com.warrenstrange.googleauth.GoogleAuthenticatorConfig;
import com.warrenstrange.googleauth.GoogleAuthenticatorConfig.GoogleAuthenticatorConfigBuilder;
import com.warrenstrange.googleauth.GoogleAuthenticatorKey;

import lombok.SneakyThrows;
import lombok.extern.slf4j.Slf4j;

/**
 * @Auther: chenqimiao
 * @Date: 2019/8/26 22:58
 * @Description: refer https://github.com/wstrange/GoogleAuth
 */
@Slf4j
public class GoogleAuthenticatorUtils {
	// å‰ç¼€
	private static final String DEFAULT_USER_PREFIX = "TOTP_USER:";
	// ç”¨æˆ·å|å¯†é’¥|å‘è¡Œè€…
	public static final String QRCODE_TEMPLATE = "otpauth://totp/" + DEFAULT_USER_PREFIX + "{0}?secret={1}&issuer={2}";
	// é»˜è®¤çš„å‘è¡Œè€…
	public static final String DEFAULT_ISSUER = "DAS_TOTP";

	private static final GoogleAuthenticatorConfig DEFAULT_CONFIG;

	static {
		GoogleAuthenticatorConfigBuilder builder = new GoogleAuthenticatorConfigBuilder();

		// Do something here if you want to set config for GoogleAuthenticator

		DEFAULT_CONFIG = builder.build();
	}

	public static String createQrCodeContent(String username, String secret) {
		return createQrCodeContent(username, secret, DEFAULT_ISSUER);
	}

	public static String createQrCodeContent(String username, String secret, String issuer) {
		return MessageFormat.format(QRCODE_TEMPLATE, username, secret, issuer);
	}

	public static String createSecret() {
		return createSecret(DEFAULT_CONFIG);
	}

	public static String createSecret(GoogleAuthenticatorConfig config) {
		GoogleAuthenticator gAuth = new GoogleAuthenticator(config);
		final GoogleAuthenticatorKey key = gAuth.createCredentials();
		return key.getKey();
	}

	public static boolean verify(Integer totpPwd, String secret) {

		return verify(totpPwd, secret, DEFAULT_CONFIG);
	}

	public static boolean verify(Integer totpPwd, String secret, GoogleAuthenticatorConfig config) {
		GoogleAuthenticator gAuth = new GoogleAuthenticator(config);
		return gAuth.authorize(secret, totpPwd);
	}

	public static Integer getTotpPassword(String secret) {
		return getTotpPassword(secret, DEFAULT_CONFIG);
	}

	public static Integer getTotpPassword(String secret, GoogleAuthenticatorConfig config) {
		GoogleAuthenticator gAuth = new GoogleAuthenticator(config);
		return gAuth.getTotpPassword(secret);
	}

	@SneakyThrows
	public static void main(String args[]) {
		String secret = createSecret();
		String qrcodeContent = createQrCodeContent("chenqimiao", secret);
		System.out.println("qrcodeContent is " + qrcodeContent);

		Integer totpPwd = getTotpPassword(secret);
		System.out.println("Current totp password is " + totpPwd);

		boolean result = verify(totpPwd, secret);
		System.out.println("result is " + result);

	}
```

qrcodeContent å¯ä»¥é€šè¿‡äºŒç»´ç å·¥å…·ç”ŸæˆäºŒç»´ç ï¼Œä½¿ç”¨ [Google Authenticator](https://apps.apple.com/cn/app/google-authenticator/id388497605) æ‰«æè¯¥äºŒç»´ç ä¹‹åï¼Œå°±ç›¸å½“äºä¸ºç”¨æˆ·ç»‘å®šäº†ä¸€ä¸ªè®¤è¯å™¨ã€‚

## tip [ğŸ”](#weekly-97)

## share [ğŸ”](#weekly-97)

[readme](../README.md) | [previous](202501W2.md) | [next](202501W4.md)
