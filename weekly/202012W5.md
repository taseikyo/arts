> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2020-12-27 - 2021-01-02

# Weekly #9

[readme](../README.md) | [previous](202012W4.md) | [next](202101W1.md)

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
	- 保护你的 `.env` 文件（英文）
- [tip](#tip-)
	- Linux 下防止文件被删（中文）
- [share](#share-)

## algorithm [⬆](#weekly-9)

## review [⬆](#weekly-9)

### 1. [保护你的 `.env` 文件（英文）](https://tatooine-sunset.botond.online/2020-12-06-protect-your-dotenv/)

作者上线了一个小网站，10 个小时内就收到了许多可疑请求：

- /config/getuser?index=0
- /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
- /api/jsonws/invoke
- /solr/admin/info/system?wt=json
- /index.php?s=/Index/\x5Cthink\x5Capp/invokefunction &function=call_user_func_array&vars[0]=md5&vars[1][]=HelloThinkPHP21
- /console/
- /wp-content/plugins/wp-file-manager/readme.txt
- /Autodiscover/Autodiscover.xml
- /vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php
- /.env

最后一个请求尝试读取环境变量 `.env` 文件，`.env` 文件通常包含密码、密钥等敏感信息，所以作者提醒保护好该文件。

关键作者并不是一个名人（*I'm a nobody on the internet*），这样都收到了很多机器人请求（或者说是攻击也不为过），想象一下知名网站得收到多少奇奇怪怪的请求，网络安全确实是一个值得注意的大问题。

## tip [⬆](#weekly-9)

### 1. [Linux 下防止文件被删（中文）](http://smilejay.com/2020/06/linux-prevent-files-from-accidental-deletion/)

有时我们的一些重要的文件或目录，不希望被误删除或者修改，我们可以对其加上特殊的属性使其不可修改。

如果在 root 权限下，删除文件也被提示无权限 “Operation not permitted”，那么你可以查看一下文件是否被设置为不可修改的属性。

chattr（Change Attribute 的缩写）命令就是 Linux 改变文件属性的命令。对应地，lsattr 命令可以列出文件的属性。

```Bash
taseikyo@ubuntu ~> touch a.txt
taseikyo@ubuntu ~> sudo chattr +i a.txt
taseikyo@ubuntu ~> rm -rf a.txt
rm: cannot remove 'a.txt': Operation not permitted
taseikyo@ubuntu ~> sudo rm -rf a.txt
rm: cannot remove 'a.txt': Operation not permitted
taseikyo@ubuntu ~> lsattr a.txt
----i---------e--- a.txt
# 可以看到这里有一个 i 属性
taseikyo@ubuntu ~> sudo chattr -i a.txt
taseikyo@ubuntu ~> lsattr a.txt
--------------e---- a.txt
taseikyo@ubuntu ~> rm -rf a.txt
```

chattr 提供不同的属性，也就是 aAcCdDeijsStTu，每个字符代表一个特定文件属性，具体如下：

- a：只能向文件中添加数据
- A：不更新文件或目录的最后访问时间
- c：将文件或目录压缩后存放
- C：不适用写入时复制机制（CoW）
- d：设定文件不能成为 dump 程序的备份目标
- D：同步目录更新
- e：extend 格式存储
- i：文件或目录不可改变
- j：设定此参数使得当通过 mount 参数：data=ordered 或者 data=writeback 挂载的文件系统，文件在写入时会先被记录在日志中
- P：project 层次结构
- s：安全删除文件或目录
- S：即时更新文件或目录
- t：不进行尾部合并
- T：顶层目录层次结构
- u：不可删除


## share [⬆](#weekly-9)

[readme](../README.md) | [previous](202012W4.md) | [next](202101W1.md)
