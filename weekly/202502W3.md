> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2025-02-16 - 2025-02-22

# Weekly #102

[readme](../README.md) | [previous](202502W2.md) | [next](202502W4.md)

![](../images/2025/02/alex-shaw-g8sS1Kq7yRI-unsplash.jpg "Weekly #102")

\**Photo by [Alex Shaw](https://unsplash.com/@matt909) on [Unsplash](https://unsplash.com/photos/woman-in-black-coat-standing-near-brown-trees-during-daytime-g8sS1Kq7yRI)*

> 我党规定了中国革命的总路线和总政策，又规定了各项具体的工作路线和各项具体的政策。但是，许多同志往往记住了我党的具体的个别的工作路线和政策，忘记了我党的总路线和总政策。而如果真正忘记了我党的总路线和总政策，我们就将是一个盲目的不完全的不清醒的革命者，在我们执行具体工作路线和具体政策的时候，就会迷失方向，就会左右摇摆，就会贻误我们的工作。 —— 《在晋绥干部会议上的讲话》（一九四八年四月一日），《毛泽东选集》第四卷第一三一四页。

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
- [tip](#tip-)
	- Git pre-commit hook 检测重复提交
- [share](#share-)

## algorithm [🔝](#weekly-102)

## review [🔝](#weekly-102)

## tip [🔝](#weekly-102)

### 1. Git pre-commit hook

> 方法来自 https://chatgpt.com/

1. 创建 Git pre-commit hook

Git hook 文件位于 `.git/hooks/pre-commit` ，默认没有激活。你需要手动创建或修改它。

```bash
touch .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

2. pre-commit shell 脚本版本

放在 `.git/hooks/pre-commit` 中：

```bash
#!/bin/bash

# 使脚本出现任何错误立即退出
set -e

# 定义链接匹配正则（http 或 https 开头，空格或括号截止）
LINK_REGEX='https\?:\/\/[^ )\]]\+'

# 找出已存在的 markdown 文件（不含 staged 的）
existing_md_files=$(find . -maxdepth 1 -name "20*.md" ! -newermt "$(date -I)" | grep -v -Ff <(git diff --cached --name-only))

# 提取旧链接集合
existing_links=$(grep -hoE "$LINK_REGEX" $existing_md_files 2>/dev/null | sort -u)

# 提取本次 staged diff 中的新增链接
new_links=$(git diff --cached --unified=0 | grep '^+' | grep -v '^+++' | grep -oE "$LINK_REGEX" | sort -u)

# 交集判断
conflicts=""
for link in $new_links; do
    if echo "$existing_links" | grep -qx "$link"; then
        conflicts="$conflicts\n$link"
    fi
done

# 如果存在重复，阻止 commit
if [ -n "$conflicts" ]; then
    echo "❌ 检测到重复博客链接，禁止提交："
    echo -e "$conflicts"
    exit 1
fi

exit 0
```

3. 可以把 pre-commit 脚本存入版本控制，例如 `.githooks/pre-commit` ，然后在本地用：

```Bash
git config core.hooksPath .githooks
```

这样所有 clone 的人都会自动启用这套 hook。

## share [🔝](#weekly-102)

[readme](../README.md) | [previous](202502W2.md) | [next](202502W4.md)
