> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2025-02-16 - 2025-02-22

# Weekly #102

[readme](../README.md) | [previous](202502W2.md) | [next](202502W4.md)

![](../images/2025/02/alex-shaw-g8sS1Kq7yRI-unsplash.jpg "Weekly #102")

\**Photo by [Alex Shaw](https://unsplash.com/@matt909) on [Unsplash](https://unsplash.com/photos/woman-in-black-coat-standing-near-brown-trees-during-daytime-g8sS1Kq7yRI)*

> æˆ‘å…šè§„å®šäº†ä¸­å›½é©å‘½çš„æ€»è·¯çº¿å’Œæ€»æ”¿ç­–ï¼Œåˆè§„å®šäº†å„é¡¹å…·ä½“çš„å·¥ä½œè·¯çº¿å’Œå„é¡¹å…·ä½“çš„æ”¿ç­–ã€‚ä½†æ˜¯ï¼Œè®¸å¤šåŒå¿—å¾€å¾€è®°ä½äº†æˆ‘å…šçš„å…·ä½“çš„ä¸ªåˆ«çš„å·¥ä½œè·¯çº¿å’Œæ”¿ç­–ï¼Œå¿˜è®°äº†æˆ‘å…šçš„æ€»è·¯çº¿å’Œæ€»æ”¿ç­–ã€‚è€Œå¦‚æœçœŸæ­£å¿˜è®°äº†æˆ‘å…šçš„æ€»è·¯çº¿å’Œæ€»æ”¿ç­–ï¼Œæˆ‘ä»¬å°±å°†æ˜¯ä¸€ä¸ªç›²ç›®çš„ä¸å®Œå…¨çš„ä¸æ¸…é†’çš„é©å‘½è€…ï¼Œåœ¨æˆ‘ä»¬æ‰§è¡Œå…·ä½“å·¥ä½œè·¯çº¿å’Œå…·ä½“æ”¿ç­–çš„æ—¶å€™ï¼Œå°±ä¼šè¿·å¤±æ–¹å‘ï¼Œå°±ä¼šå·¦å³æ‘‡æ‘†ï¼Œå°±ä¼šè´»è¯¯æˆ‘ä»¬çš„å·¥ä½œã€‚ â€”â€” ã€Šåœ¨æ™‹ç»¥å¹²éƒ¨ä¼šè®®ä¸Šçš„è®²è¯ã€‹ï¼ˆä¸€ä¹å››å…«å¹´å››æœˆä¸€æ—¥ï¼‰ï¼Œã€Šæ¯›æ³½ä¸œé€‰é›†ã€‹ç¬¬å››å·ç¬¬ä¸€ä¸‰ä¸€å››é¡µã€‚

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
    - ä¸–ç•Œä¸Šæœ€å¿«çš„æ’åºç®—æ³•â€”â€”Timsort
- [tip](#tip-)
	- Git pre-commit hook æ£€æµ‹é‡å¤æäº¤
- [share](#share-)

## algorithm [ğŸ”](#weekly-102)

## review [ğŸ”](#weekly-102)

### 1. [ä¸–ç•Œä¸Šæœ€å¿«çš„æ’åºç®—æ³•â€”â€”Timsort](https://www.cnblogs.com/sunshuyi/p/12680918.html)

Timsort æ˜¯ä¸€ä¸ª**è‡ªé€‚åº”**çš„ã€**æ··åˆ**çš„ã€**ç¨³å®š**çš„æ’åºç®—æ³•ï¼Œèåˆäº†å½’å¹¶ç®—æ³•å’ŒäºŒåˆ†æ’å…¥æ’åºç®—æ³•çš„ç²¾é«“ï¼Œåœ¨ç°å®ä¸–ç•Œçš„æ•°æ®ä¸­æœ‰ç€ç‰¹åˆ«ä¼˜ç§€çš„è¡¨ç°ã€‚å®ƒæ˜¯ç”± Tim Peter äº 2002 å¹´å‘æ˜çš„ï¼Œç”¨åœ¨ Python è¿™ä¸ªç¼–ç¨‹è¯­è¨€é‡Œé¢ã€‚è¿™ä¸ªç®—æ³•ä¹‹æ‰€ä»¥å¿«ï¼Œæ˜¯å› ä¸ºå®ƒå……åˆ†åˆ©ç”¨äº†ç°å®ä¸–ç•Œçš„å¾…æ’åºæ•°æ®é‡Œé¢ï¼Œæœ‰å¾ˆå¤šå­ä¸²æ˜¯å·²ç»æ’å¥½åºçš„ä¸éœ€è¦å†é‡æ–°æ’åºï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§å¹¶ä¸”åŠ ä¸Šåˆé€‚çš„åˆå¹¶è§„åˆ™å¯ä»¥æ›´åŠ é«˜æ•ˆçš„æ’åºå‰©ä¸‹çš„å¾…æ’åºåºåˆ—ã€‚

å½“ Timsort è¿è¡Œåœ¨éƒ¨åˆ†æ’åºå¥½çš„æ•°ç»„é‡Œé¢çš„æ—¶å€™ï¼Œéœ€è¦çš„æ¯”è¾ƒæ¬¡æ•°è¦è¿œå°äº nlogn$nlogn$ï¼Œä¹Ÿæ˜¯è¿œå°äºç›¸åŒæƒ…å†µä¸‹çš„å½’å¹¶æ’åºç®—æ³•éœ€è¦çš„æ¯”è¾ƒæ¬¡æ•°ã€‚ä½†æ˜¯å’Œå…¶ä»–çš„å½’å¹¶æ’åºç®—æ³•ä¸€æ ·ï¼Œæœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(nlogn)$ çš„æ°´å¹³ã€‚ä½†æ˜¯åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼ŒTimsort éœ€è¦çš„ä¸´æ—¶å­˜å‚¨ç©ºé—´åªæœ‰ $n/2$ ï¼Œåœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œéœ€è¦çš„é¢å¤–ç©ºé—´æ˜¯å¸¸æ•°çº§åˆ«çš„ã€‚ä»å„ä¸ªæ–¹é¢éƒ½èƒ½å¤Ÿå‡»è´¥éœ€è¦ $O(n)$ ç©ºé—´å’Œç¨³å®š $O(nlogn)$ æ—¶é—´çš„å½’å¹¶ç®—æ³•ã€‚

#### é™åˆ¶

åœ¨æœ€åˆçš„ Tim å®ç°çš„ç‰ˆæœ¬ä¸­ï¼Œå¯¹äºé•¿åº¦å°äº `64` æ•°ç»„ç›´æ¥è¿›è¡ŒäºŒåˆ†æ’å…¥æ’åºï¼Œä¸ä¼šè¿›è¡Œå¤æ‚çš„å½’å¹¶æ’åºï¼Œå› ä¸ºåœ¨å°æ•°ç»„ä¸­æ’å…¥æ’åºçš„æ€§èƒ½å·²ç»è¶³å¤Ÿå¥½ã€‚åœ¨ Java ä¸­æœ‰ç•¥å¾®çš„æ”¹å˜ï¼Œè¿™ä¸ªé˜ˆå€¼è¢«ä¿®æ”¹æˆäº† `32` ï¼Œæ®è¯´åœ¨å®é™…ä¸­ `32` è¿™ä¸ªé˜ˆå€¼èƒ½å¤Ÿå¾—åˆ°æ›´å¥½çš„æ€§èƒ½ã€‚

#### äºŒåˆ†æ’å…¥æ’åº

æ’å…¥æ’åºçš„é€»è¾‘æ˜¯å°†æ’å¥½åºçš„æ•°ç»„ä¹‹åçš„ä¸€ä¸ªå…ƒç´ ä¸åœçš„å‘å‰ç§»åŠ¨äº¤æ¢å…ƒç´ ç›´åˆ°æ‰¾åˆ°åˆé€‚çš„ä½ç½®ï¼Œå¦‚æœè¿™ä¸ªæ–°å…ƒç´ æ¯”å‰é¢çš„åºåˆ—çš„æœ€å°çš„å…ƒç´ è¿˜è¦å°ï¼Œå°±è¦å’Œå‰é¢çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œæµªè´¹å¤§é‡çš„æ—¶é—´åœ¨æ¯”è¾ƒä¸Šé¢ã€‚é‡‡ç”¨äºŒåˆ†æœç´¢çš„æ–¹æ³•ç›´æ¥æ‰¾åˆ°è¿™ä¸ªå…ƒç´ åº”è¯¥æ’å…¥çš„ä½ç½®ï¼Œå°±å¯ä»¥å‡å°‘å¾ˆå¤šæ¬¡çš„æ¯”è¾ƒã€‚è™½ç„¶ä»ç„¶æ˜¯éœ€è¦ç§»åŠ¨ç›¸åŒæ•°é‡çš„å…ƒç´ ï¼Œä½†æ˜¯å¤åˆ¶æ•°ç»„çš„æ—¶é—´æ¶ˆè€—è¦å°äºå…ƒç´ é—´çš„ä¸€ä¸€äº’æ¢ã€‚

æ¯”å¦‚å¯¹äº `[2,3,4,5,6,1]` ï¼Œæƒ³æŠŠ `1` æ’å…¥åˆ°å‰é¢ï¼Œå¦‚æœä½¿ç”¨ç›´æ¥çš„æ’å…¥æ’åºï¼Œéœ€è¦ 5 æ¬¡æ¯”è¾ƒï¼Œä½†æ˜¯ä½¿ç”¨äºŒåˆ†æ’å…¥æ’åºï¼Œåªéœ€è¦ 2 æ¬¡æ¯”è¾ƒå°±ç›´åˆ°æ’å…¥çš„ä½ç½®ï¼Œç„¶åç›´æ¥æŠŠ `2,3,4,5,6` å…¨éƒ¨å‘åç§»åŠ¨ä¸€ä½ï¼ŒæŠŠ `1` æ”¾å…¥ç¬¬ä¸€ä½å°±å®Œæˆäº†æ’å…¥æ“ä½œã€‚

#### Run

é¦–å…ˆä»‹ç»å…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œè‹±æ–‡å«åš `run` ï¼Œæ‰€è°“çš„ `run` å°±æ˜¯ä¸€ä¸ªè¿ç»­ä¸Šå‡ï¼ˆæ­¤å¤„çš„ä¸Šå‡åŒ…æ‹¬ä¸¤ä¸ªå…ƒç´ ç›¸ç­‰çš„æƒ…å†µï¼‰æˆ–è€…ä¸‹é™ï¼ˆä¸¥æ ¼é€’å‡ï¼‰çš„å­ä¸²ã€‚

æ¯”å¦‚å¯¹äºåºåˆ— `[1,2,3,4,3,2,4,7,8]` ï¼Œå…¶ä¸­æœ‰ä¸‰ä¸ª `run` ï¼Œç¬¬ä¸€ä¸ªæ˜¯ `[1,2,3,4]` ï¼Œç¬¬äºŒä¸ªæ˜¯ `[3,2]` ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ `[4,7,8]` ï¼Œè¿™ä¸‰ä¸ª `run` éƒ½æ˜¯å•è°ƒçš„ï¼Œåœ¨å®é™…ç¨‹åºä¸­å¯¹äºå•è°ƒé€’å‡çš„ `run` ä¼šè¢« **åè½¬æˆé€’å¢çš„åºåˆ—** ã€‚

![](../images/2025/02/1938187-20200411165441195-1304164361.gif)

åœ¨åˆå¹¶åºåˆ—çš„æ—¶å€™ï¼Œå¦‚æœ `run` çš„æ•°é‡ç­‰äºæˆ–è€…ç•¥å°äº `2` çš„å¹‚æ¬¡æ–¹çš„æ—¶å€™ï¼Œæ•ˆç‡æ˜¯æœ€é«˜çš„ï¼›å¦‚æœç•¥å¤§äº `2` çš„å¹‚æ¬¡æ–¹ï¼Œæ•ˆç‡å°±ä¼šç‰¹åˆ«ä½ã€‚æ‰€ä»¥ä¸ºäº†æé«˜åˆå¹¶æ—¶å€™çš„æ•ˆç‡ï¼Œéœ€è¦å°½é‡æ§åˆ¶æ¯ä¸ª `run` çš„é•¿åº¦ï¼Œå®šä¹‰ä¸€ä¸ª `minrun` è¡¨ç¤ºæ¯ä¸ª `run` çš„æœ€å°é•¿åº¦ï¼Œå¦‚æœé•¿åº¦å¤ªçŸ­ï¼Œå°±ç”¨äºŒåˆ†æ’å…¥æ’åºæŠŠ `run` åé¢çš„å…ƒç´ æ’å…¥åˆ°å‰é¢çš„ `run` é‡Œé¢ã€‚å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœ `minrun=5` ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ª `run` æ˜¯ä¸ç¬¦åˆè¦æ±‚çš„ï¼Œå°±ä¼šæŠŠåé¢çš„ `3` æ’å…¥åˆ°ç¬¬ä¸€ä¸ª `run` é‡Œé¢ï¼Œå˜æˆ `[1,2,3,3,4]` ã€‚

![](../images/2025/02/1938187-20200411165500253-391196363.gif)

åœ¨æ‰§è¡Œæ’åºç®—æ³•ä¹‹å‰ï¼Œä¼šè®¡ç®—å‡ºè¿™ä¸ª `minrun` çš„å€¼ï¼ˆæ‰€ä»¥è¯´è¿™ä¸ªç®—æ³•æ˜¯è‡ªé€‚åº”çš„ï¼Œä¼šæ ¹æ®æ•°æ®çš„ç‰¹ç‚¹æ¥è¿›è¡Œè‡ªæˆ‘è°ƒæ•´ï¼‰ï¼Œ `minrun` ä¼šä» 32 åˆ° 64ï¼ˆåŒ…æ‹¬ï¼‰é€‰æ‹©ä¸€ä¸ªæ•°å­—ï¼Œä½¿å¾—æ•°ç»„çš„é•¿åº¦é™¤ä»¥ `minrun` ç­‰äºæˆ–è€…ç•¥å°äº `2` çš„å¹‚æ¬¡æ–¹ã€‚æ¯”å¦‚é•¿åº¦æ˜¯ `65` ï¼Œé‚£ä¹ˆ `minrun` çš„å€¼å°±æ˜¯ `33` ï¼›å¦‚æœé•¿åº¦æ˜¯ `165` ï¼Œ `minrun` å°±æ˜¯ `42` ï¼ˆæ³¨æ„è¿™é‡Œçš„ Java çš„ `minrun` çš„å–å€¼ä¼šåœ¨ 16 åˆ° 32 ä¹‹é—´ï¼‰ã€‚

è¿™é‡Œç”¨ Java æºç åšç¤ºèŒƒï¼š

```Java
private static int minRunLength(int n) {
    assert n >= 0;
    int r = 0;        // å¦‚æœä½ä½ä»»ä½•ä¸€ä½æ˜¯1ï¼Œå°±ä¼šå˜æˆ1
    while (n >= 64) { // æ”¹æˆäº†64
        r |= (n & 1);
        n >>= 1;
    }
    return n + r;
}
```

#### åˆå¹¶

åœ¨å½’å¹¶ç®—æ³•ä¸­åˆå¹¶æ˜¯ä¸¤ä¸¤åˆ†åˆ«åˆå¹¶ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªåˆå¹¶ï¼Œç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªåˆå¹¶ï¼Œç„¶åå†åˆå¹¶è¿™ä¸¤ä¸ªå·²ç»åˆå¹¶çš„åºåˆ—ã€‚ä½†æ˜¯åœ¨ Timsort ä¸­ï¼Œåˆå¹¶æ˜¯è¿ç»­çš„ï¼Œæ¯æ¬¡è®¡ç®—å‡ºäº†ä¸€ä¸ª `run` ä¹‹åéƒ½æœ‰å¯èƒ½å¯¼è‡´ä¸€æ¬¡åˆå¹¶ï¼Œè¿™æ ·çš„åˆå¹¶é¡ºåºèƒ½å¤Ÿåœ¨åˆå¹¶çš„åŒæ—¶ä¿è¯ç®—æ³•çš„ **ç¨³å®šæ€§** ã€‚

åœ¨ Timsort ä¸­ç”¨ä¸€ä¸ª **æ ˆ** æ¥ä¿å­˜æ¯ä¸ª `run` ï¼Œæ¯”å¦‚å¯¹äºä¸Šé¢çš„ `[1,2,3,4,3,2,4,7,8]` è¿™ä¸ªä¾‹å­ï¼Œæ ˆåº•æ˜¯ `[1,2,3,4]` ï¼Œä¸­é—´æ˜¯ `[3,2]` ï¼Œæ ˆé¡¶æ˜¯ `[4,7,8]` ï¼Œæ¯æ¬¡åˆå¹¶ä»…é™äºæ ˆé‡Œé¢ç›¸é‚»çš„ä¸¤ä¸ª `run` ã€‚

![](../images/2025/02/1938187-20200411165520150-1046591031.gif)

#### åˆå¹¶æ¡ä»¶

ä¸ºäº†ä¿è¯ Timsort çš„åˆå¹¶å¹³è¡¡æ€§ï¼ŒTim åˆ¶å®šä¸€ä¸ªåˆå¹¶è§„åˆ™ï¼Œå¯¹äºåœ¨æ ˆé¡¶çš„ä¸‰ä¸ª`run`ï¼Œç”¨`X`ã€`Y`å’Œ`Z`åˆ†åˆ«è¡¨ç¤ºä»–ä»¬çš„é•¿åº¦ï¼Œå…¶ä¸­`X`åœ¨æ ˆé¡¶ï¼Œå¿…é¡»å§‹ç»ˆç»´æŒä¸€ä¸‹çš„ä¸¤ä¸ªè§„åˆ™ï¼š

$$Z > Y + X$$

$$Y > X$$

ä¸€æ—¦æœ‰å…¶ä¸­çš„ä¸€ä¸ªæ¡ä»¶ä¸è¢«æ»¡è¶³ï¼Œ `Y` è¿™ä¸ªå­åºåˆ—å°±ä¼šå’Œ `X` äº `Z` ä¸­è¾ƒå°çš„å…ƒç´ åˆå¹¶å½¢æˆä¸€ä¸ªæ–° `run` ï¼Œç„¶åä¼šå†æ¬¡æ£€æŸ¥æ ˆé¡¶çš„ä¸‰ä¸ª `run` çœ‹çœ‹æ˜¯å¦ä»ç„¶æ»¡è¶³æ¡ä»¶ã€‚å¦‚æœä¸æ»¡è¶³åˆ™ä¼šç»§ç»­è¿›è¡Œåˆå¹¶ï¼Œç›´è‡³æ ˆé¡¶çš„ä¸‰ä¸ªå…ƒç´ ï¼ˆå¦‚æœåªæœ‰ä¸¤ä¸ª `run` å°±åªéœ€è¦æ»¡è¶³ç¬¬äºŒä¸ªæ¡ä»¶ï¼‰æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ã€‚

![](../images/2025/02/1938187-20200411165537212-1672378816.png)

æ‰€è°“çš„åˆå¹¶çš„å¹³è¡¡æ€§å°±æ˜¯ä¸ºäº†è®©åˆå¹¶çš„ä¸¤ä¸ªæ•°ç»„çš„å¤§å°å°½é‡æ¥è¿‘ï¼Œæé«˜åˆå¹¶çš„æ•ˆç‡ã€‚æ‰€ä»¥åœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­éœ€è¦å°½é‡ä¿ç•™è¿™äº› `run` ç”¨äºå‘ç°åæ¥çš„æ¨¡å¼ï¼Œä½†æ˜¯æˆ‘ä»¬åˆæƒ³å°½é‡å¿«çš„åˆå¹¶å†…å­˜å±‚çº§æ¯”è¾ƒé«˜çš„ `run` ï¼Œå¹¶ä¸”æ ˆçš„ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œä¸èƒ½æµªè´¹å¤ªå¤šçš„æ ˆç©ºé—´ã€‚é€šè¿‡ä»¥ä¸Šçš„ä¸¤ä¸ªé™åˆ¶ï¼Œå¯ä»¥å°†æ•´ä¸ªæ ˆä»åº•éƒ¨åˆ°é¡¶éƒ¨çš„ `run` çš„å¤§å°å˜æˆä¸¥æ ¼é€’å‡çš„ï¼Œå¹¶ä¸”æ”¶æ•›é€Ÿåº¦å’Œ **æ–æ³¢é‚£å¥‘æ•°åˆ—** ä¸€æ ·ï¼Œè¿™æ ·å°±å¯ä»¥åº”ç”¨æ–æ³¢é‚£å¥‘æ•°åˆ—å’Œçš„å…¬å¼æ ¹æ®æ•°ç»„çš„é•¿åº¦è®¡ç®—å‡ºéœ€è¦çš„æ ˆçš„å¤§å°ï¼Œä¸€å®šæ˜¯æ¯” $log_{1.618}N$ è¦å°çš„ï¼Œå…¶ä¸­ `N` æ˜¯æ•°ç»„çš„é•¿åº¦ã€‚

åœ¨æœ€ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ ˆä»åº•éƒ¨åˆ°é¡¶éƒ¨çš„æ•°å­—åº”è¯¥æ˜¯ `128` ã€ `64` ã€ `32` ã€ `16` ã€ `8` ã€ `4` ã€ `2` ã€ `2` ï¼Œè¿™æ ·ä»æ ˆé¡¶åˆå¹¶åˆ°æ ˆåº•ï¼Œæ¯æ¬¡åˆå¹¶çš„ä¸¤ä¸ª `run` çš„é•¿åº¦éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œéƒ½æ˜¯å®Œç¾çš„åˆå¹¶ã€‚

å¦‚æœé‡åˆ°ä¸å®Œç¾çš„æƒ…å†µæ¯”å¦‚ `500` ã€ `400` ã€ `1000` ï¼Œé‚£ä¹ˆæ ¹æ®è§„åˆ™å°±ä¼šåˆå¹¶å˜æˆ `900` ã€ `1000` ï¼Œå†æ¬¡æ£€æŸ¥è§„åˆ™ä¹‹åå‘ç°è¿˜æ˜¯ä¸æ»¡è¶³ï¼Œäºæ˜¯åˆå¹¶å˜æˆäº† `1900` ã€‚

#### åˆå¹¶å†…å­˜æ¶ˆè€—

ä¸ä½¿ç”¨é¢å¤–çš„å†…å­˜åˆå¹¶ä¸¤ä¸ª `run` æ˜¯å¾ˆå›°éš¾çš„ï¼Œæœ‰è¿™ç§åŸåœ°åˆå¹¶ç®—æ³•ï¼Œä½†æ˜¯æ•ˆç‡å¤ªä½ï¼Œä½œä¸º trade-offï¼Œå¯ä»¥ä½¿ç”¨å°‘é‡çš„å†…å­˜ç©ºé—´æ¥è¾¾åˆ°åˆå¹¶çš„ç›®çš„ã€‚

æ¯”å¦‚æœ‰ä¸¤ä¸ªç›¸é‚»çš„ `run` ä¸€å‰ä¸€ååˆ†åˆ«æ˜¯ `A` å’Œ `B` ï¼Œå¦‚æœ `A` çš„é•¿åº¦æ¯”è¾ƒå°ï¼Œé‚£ä¹ˆå°±æŠŠ `A` å¤åˆ¶åˆ°ä¸´æ—¶å†…å­˜é‡Œé¢ï¼Œç„¶å **ä»å°åˆ°å¤§** å¼€å§‹åˆå¹¶æ’åºæ”¾å…¥ `A` å’Œ `B` åŸæ¥çš„ç©ºé—´é‡Œé¢ä¸å½±å“åŸæ¥çš„æ•°æ®çš„ä½¿ç”¨ã€‚å¦‚æœ `B` çš„é•¿åº¦æ¯”è¾ƒå°ï¼Œ `B` å°±ä¼šè¢«æ”¾åˆ°ä¸´æ—¶å†…å­˜é‡Œé¢ï¼Œç„¶å **ä»å¤§åˆ°å°** å¼€å§‹åˆå¹¶ã€‚

å¦å¤–è¿˜æœ‰ä¸€ä¸ªä¼˜åŒ–çš„ç‚¹åœ¨äºå¯ä»¥ç”¨äºŒåˆ†æ³•æ‰¾åˆ° `B[0]` åœ¨ `A` ä¸­åº”è¯¥æ’å…¥çš„ä½ç½® `i` ä»¥åŠ `A[A.length-1]` åœ¨ `B` ä¸­åº”è¯¥æ’å…¥çš„ä½ç½® `j` ï¼Œè¿™æ ·åœ¨ `i` **ä¹‹å‰** å’Œ `j` **ä¹‹å** çš„æ•°æ®éƒ½å¯ä»¥æ”¾åœ¨åŸåœ°ä¸éœ€è¦å˜åŒ–ï¼Œè¿›ä¸€æ­¥å‡å°äº† `A` å’Œ `B` çš„å¤§å°ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ç¼©å‡äº†ä¸´æ—¶ç©ºé—´çš„å¤§å°ã€‚

![](../images/2025/02/1938187-20200411165554730-1348588495.gif)

#### åŠ é€Ÿåˆå¹¶

åœ¨å½’å¹¶æ’åºç®—æ³•ä¸­åˆå¹¶ä¸¤ä¸ªæ•°ç»„å°±æ˜¯ä¸€ä¸€æ¯”è¾ƒæ¯ä¸ªå…ƒç´ ï¼ŒæŠŠè¾ƒå°çš„æ”¾åˆ°ç›¸åº”çš„ä½ç½®ï¼Œç„¶åæ¯”è¾ƒä¸‹ä¸€ä¸ªï¼Œè¿™æ ·æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯å¦‚æœ `A` ä¸­å¦‚æœæœ‰å¤§é‡çš„å…ƒç´  `A[i...j]` æ˜¯å°äº `B` ä¸­æŸä¸€ä¸ªå…ƒç´  `B[k]` çš„ï¼Œç¨‹åºä»ç„¶ä¼šæŒç»­çš„æ¯”è¾ƒ `A[i...j]` ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å’Œ `B[k]` ï¼Œå¢åŠ åˆå¹¶è¿‡ç¨‹ä¸­çš„æ—¶é—´æ¶ˆè€—ã€‚

ä¸ºäº†ä¼˜åŒ–åˆå¹¶çš„è¿‡ç¨‹ï¼ŒTim è®¾å®šäº†ä¸€ä¸ªé˜ˆå€¼ `MIN_GALLOP` ï¼Œå¦‚æœ `A` ä¸­è¿ç»­ `MIN_GALLOP` ä¸ªå…ƒç´ æ¯” `B` ä¸­æŸä¸€ä¸ªå…ƒç´ è¦å°ï¼Œé‚£ä¹ˆå°±è¿›å…¥ `GALLOP` æ¨¡å¼ï¼Œåä¹‹äº¦ç„¶ã€‚é»˜è®¤çš„ `MIN_GALLOP` å€¼æ˜¯ 7ã€‚

åœ¨ `GALLOP` æ¨¡å¼ä¸­ï¼Œé¦–å…ˆé€šè¿‡äºŒåˆ†æœç´¢æ‰¾åˆ° `A[0]` åœ¨ `B` ä¸­çš„ä½ç½® `i0` ï¼ŒæŠŠ `B` ä¸­ `i0` ä¹‹å‰çš„å…ƒç´ ç›´æ¥æ”¾å…¥åˆå¹¶çš„ç©ºé—´ä¸­ï¼Œç„¶åå†åœ¨ `A` ä¸­æ‰¾åˆ° `B[i0]` æ‰€åœ¨çš„ä½ç½® `j0` ï¼ŒæŠŠ `A` ä¸­ `j0` ä¹‹å‰çš„å…ƒç´ ç›´æ¥æ”¾å…¥åˆå¹¶ç©ºé—´ä¸­ï¼Œå¦‚æ­¤å¾ªç¯ç›´è‡³åœ¨ `A` å’Œ `B` ä¸­æ¯æ¬¡æ‰¾åˆ°çš„æ–°çš„ä½ç½®å’ŒåŸä½ç½®çš„å·®å€¼æ˜¯å°äº `MIN_GALLOP` çš„ï¼Œè¿™æ‰åœæ­¢ç„¶åç»§ç»­è¿›è¡Œä¸€å¯¹ä¸€çš„æ¯”è¾ƒã€‚

![](../images/2025/02/1938187-20200411165617030-182317248.gif)

#### GALLOP æ¨¡å¼

GALLOP æœç´¢å…ƒç´ åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³æ‰¾åˆ° `A` ä¸­çš„å…ƒç´  `x` åœ¨ `B` ä¸­çš„ä½ç½®

ç¬¬ä¸€æ­¥æ˜¯åœ¨ `B` ä¸­æ‰¾åˆ°åˆé€‚çš„ç´¢å¼•åŒºé—´ $(2^k-1,2^{k+1}-1)$ ä½¿å¾— `x` åœ¨è¿™ä¸ªå…ƒç´ çš„èŒƒå›´å†…

ç¬¬äºŒæ­¥æ˜¯åœ¨ç¬¬ä¸€æ­¥æ‰¾åˆ°çš„èŒƒå›´å†…é€šè¿‡äºŒåˆ†æœç´¢æ¥æ‰¾åˆ°å¯¹åº”çš„ä½ç½®ã€‚

é€šè¿‡è¿™ç§æœç´¢æ–¹å¼æœç´¢åºåˆ— `B` æœ€å¤šéœ€è¦ $2lgB$ æ¬¡çš„æ¯”è¾ƒï¼Œç›¸æ¯”äºç›´æ¥è¿›è¡ŒäºŒåˆ†æœç´¢çš„ $lg(B+1)$ æ¬¡æ¯”è¾ƒï¼Œåœ¨æ•°ç»„é•¿åº¦æ¯”è¾ƒçŸ­æˆ–è€…é‡å¤å…ƒç´ æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œè¿™ç§æœç´¢æ–¹å¼æ›´åŠ æœ‰ä¼˜åŠ¿ã€‚

è¿™ä¸ªæœç´¢ç®—æ³•åˆå«åš **æŒ‡æ•°æœç´¢**ï¼ˆexponential searchï¼‰ï¼Œåœ¨ Peter McIlroy äº 1993 å¹´å‘æ˜çš„ä¸€ç§ä¹è§‚æ’åºç®—æ³•ä¸­é¦–æ¬¡æå‡ºçš„ã€‚

#### æ€»ç»“

æ€»ç»“ä¸€ä¸‹ä¸Šé¢çš„æ’åºçš„è¿‡ç¨‹ï¼š

1. å¦‚æœé•¿åº¦å°äº `64` ç›´æ¥è¿›è¡Œæ’å…¥æ’åº
2. é¦–å…ˆéå†æ•°ç»„æ”¶é›†æ¯ä¸ªå…ƒç´ æ ¹æ®ç‰¹å®šçš„æ¡ä»¶ç»„æˆä¸€ä¸ª `run`
3. å¾—åˆ°ä¸€ä¸ª `run` ä¹‹åä¼šæŠŠä»–æ”¾å…¥æ ˆä¸­
4. å¦‚æœæ ˆé¡¶éƒ¨å‡ ä¸ªçš„ `run` ç¬¦åˆåˆå¹¶æ¡ä»¶ï¼Œå°±ä¼šè§¦å‘åˆå¹¶æ“ä½œåˆå¹¶ç›¸é‚»çš„ä¸¤ä¸ª `run` ç•™ä¸‹ä¸€ä¸ª `run`
5. åˆå¹¶æ“ä½œä¼šä½¿ç”¨å°½é‡å°çš„å†…å­˜ç©ºé—´å’Œ GALLOP æ¨¡å¼æ¥åŠ é€Ÿåˆå¹¶

## tip [ğŸ”](#weekly-102)

### 1. Git pre-commit hook

> æ–¹æ³•æ¥è‡ª https://chatgpt.com/

1. åˆ›å»º Git pre-commit hook

Git hook æ–‡ä»¶ä½äº `.git/hooks/pre-commit` ï¼Œé»˜è®¤æ²¡æœ‰æ¿€æ´»ã€‚ä½ éœ€è¦æ‰‹åŠ¨åˆ›å»ºæˆ–ä¿®æ”¹å®ƒã€‚

```bash
touch .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

2. pre-commit shell è„šæœ¬ç‰ˆæœ¬

æ”¾åœ¨ `.git/hooks/pre-commit` ä¸­ï¼š

```bash
#!/bin/bash
set -e

echo "ğŸ” pre-commit hook æ­£åœ¨æ‰§è¡Œï¼šæ£€æŸ¥é“¾æ¥æ˜¯å¦é‡å¤..."

# æå–æ–°å¢é“¾æ¥ï¼ˆæ”¯æŒ Markdown å’Œè£¸é“¾æ¥ï¼‰
new_links=$(git diff --cached --unified=0 | grep '^+' | grep -v '^+++' \
  | perl -nE '
      while (/\[[^\]]+\]\((https?:\/\/[^)]+)\)/g) { say $1 }
      while (/(https?:\/\/[^\s<>"'\''\)\]}]+)/g) { say $1 }
  ' | sort -u)

if [[ -z "$new_links" ]]; then
    echo "â„¹ï¸  æœ¬æ¬¡æäº¤æœªæ–°å¢é“¾æ¥ï¼Œè·³è¿‡æ£€æŸ¥ã€‚"
    exit 0
fi

echo "æœ¬æ¬¡æ–°å¢çš„é“¾æ¥ï¼š"
echo "$new_links"

map_file=$(mktemp)
existing_md_files=$(find weekly -type f -name "20*.md" | grep -v -Ff <(git diff --cached --name-only))

for file in $existing_md_files; do
    perl -nE '
        while (/\[[^\]]+\]\((https?:\/\/[^)]+)\)/g) { say "$1\t'"$file"'" }
        while (/(https?:\/\/[^\s<>"'\''\)\]}]+)/g) { say "$1\t'"$file"'" }
    ' "$file" >> "$map_file"
done

conflict_found=false
while read -r link; do
    match=$(grep -F "$link" "$map_file" || true)
    if [[ -n "$match" ]]; then
        if [ "$conflict_found" = false ]; then
            echo "âŒ æ£€æµ‹åˆ°é‡å¤é“¾æ¥ï¼Œç¦æ­¢æäº¤ï¼š"
            conflict_found=true
        fi
        echo "  - $link   â† å·²å‡ºç°åœ¨ $(echo "$match" | head -n1 | cut -f2)"
    fi
done <<< "$new_links"

rm -f "$map_file"

if [ "$conflict_found" = true ]; then
    exit 1
fi

echo "âœ… é“¾æ¥æ£€æŸ¥é€šè¿‡ï¼Œç»§ç»­æäº¤ã€‚"
exit 0
```

3. å¯ä»¥æŠŠ pre-commit è„šæœ¬å­˜å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œä¾‹å¦‚ `.githooks/pre-commit` ï¼Œç„¶ååœ¨æœ¬åœ°ç”¨ï¼š

```Bash
git config core.hooksPath .githooks
```

è¿™æ ·æ‰€æœ‰ clone çš„äººéƒ½ä¼šè‡ªåŠ¨å¯ç”¨è¿™å¥— hookã€‚


## share [ğŸ”](#weekly-102)

[readme](../README.md) | [previous](202502W2.md) | [next](202502W4.md)
