> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2025-02-16 - 2025-02-22

# Weekly #102

[readme](../README.md) | [previous](202502W2.md) | [next](202502W4.md)

![](../images/2025/02/alex-shaw-g8sS1Kq7yRI-unsplash.jpg "Weekly #102")

\**Photo by [Alex Shaw](https://unsplash.com/@matt909) on [Unsplash](https://unsplash.com/photos/woman-in-black-coat-standing-near-brown-trees-during-daytime-g8sS1Kq7yRI)*

> æˆ‘å…šè§„å®šäº†ä¸­å›½é©å‘½çš„æ€»è·¯çº¿å’Œæ€»æ”¿ç­–ï¼Œåˆè§„å®šäº†å„é¡¹å…·ä½“çš„å·¥ä½œè·¯çº¿å’Œå„é¡¹å…·ä½“çš„æ”¿ç­–ã€‚ä½†æ˜¯ï¼Œè®¸å¤šåŒå¿—å¾€å¾€è®°ä½äº†æˆ‘å…šçš„å…·ä½“çš„ä¸ªåˆ«çš„å·¥ä½œè·¯çº¿å’Œæ”¿ç­–ï¼Œå¿˜è®°äº†æˆ‘å…šçš„æ€»è·¯çº¿å’Œæ€»æ”¿ç­–ã€‚è€Œå¦‚æœçœŸæ­£å¿˜è®°äº†æˆ‘å…šçš„æ€»è·¯çº¿å’Œæ€»æ”¿ç­–ï¼Œæˆ‘ä»¬å°±å°†æ˜¯ä¸€ä¸ªç›²ç›®çš„ä¸å®Œå…¨çš„ä¸æ¸…é†’çš„é©å‘½è€…ï¼Œåœ¨æˆ‘ä»¬æ‰§è¡Œå…·ä½“å·¥ä½œè·¯çº¿å’Œå…·ä½“æ”¿ç­–çš„æ—¶å€™ï¼Œå°±ä¼šè¿·å¤±æ–¹å‘ï¼Œå°±ä¼šå·¦å³æ‘‡æ‘†ï¼Œå°±ä¼šè´»è¯¯æˆ‘ä»¬çš„å·¥ä½œã€‚ â€”â€” ã€Šåœ¨æ™‹ç»¥å¹²éƒ¨ä¼šè®®ä¸Šçš„è®²è¯ã€‹ï¼ˆä¸€ä¹å››å…«å¹´å››æœˆä¸€æ—¥ï¼‰ï¼Œã€Šæ¯›æ³½ä¸œé€‰é›†ã€‹ç¬¬å››å·ç¬¬ä¸€ä¸‰ä¸€å››é¡µã€‚

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
- [tip](#tip-)
	- Git pre-commit hook æ£€æµ‹é‡å¤æäº¤
- [share](#share-)

## algorithm [ğŸ”](#weekly-102)

## review [ğŸ”](#weekly-102)

## tip [ğŸ”](#weekly-102)

### 1. Git pre-commit hook

> æ–¹æ³•æ¥è‡ª https://chatgpt.com/

1. åˆ›å»º Git pre-commit hook

Git hook æ–‡ä»¶ä½äº `.git/hooks/pre-commit` ï¼Œé»˜è®¤æ²¡æœ‰æ¿€æ´»ã€‚ä½ éœ€è¦æ‰‹åŠ¨åˆ›å»ºæˆ–ä¿®æ”¹å®ƒã€‚

```bash
touch .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

2. pre-commit shell è„šæœ¬ç‰ˆæœ¬

æ”¾åœ¨ `.git/hooks/pre-commit` ä¸­ï¼š

```bash
#!/bin/bash
set -e

echo "ğŸ” pre-commit hook æ­£åœ¨æ‰§è¡Œï¼šæ£€æŸ¥é“¾æ¥æ˜¯å¦é‡å¤..."

# æå–æ–°å¢é“¾æ¥ï¼ˆæ”¯æŒ Markdown å’Œè£¸é“¾æ¥ï¼‰
new_links=$(git diff --cached --unified=0 | grep '^+' | grep -v '^+++' \
  | perl -nE '
      while (/\[[^\]]+\]\((https?:\/\/[^)]+)\)/g) { say $1 }
      while (/(https?:\/\/[^\s<>"'\''\)\]}]+)/g) { say $1 }
  ' | sort -u)

if [[ -z "$new_links" ]]; then
    echo "â„¹ï¸  æœ¬æ¬¡æäº¤æœªæ–°å¢é“¾æ¥ï¼Œè·³è¿‡æ£€æŸ¥ã€‚"
    exit 0
fi

echo "æœ¬æ¬¡æ–°å¢çš„é“¾æ¥ï¼š"
echo "$new_links"

map_file=$(mktemp)
existing_md_files=$(find weekly -type f -name "20*.md" | grep -v -Ff <(git diff --cached --name-only))

for file in $existing_md_files; do
    perl -nE '
        while (/\[[^\]]+\]\((https?:\/\/[^)]+)\)/g) { say "$1\t'"$file"'" }
        while (/(https?:\/\/[^\s<>"'\''\)\]}]+)/g) { say "$1\t'"$file"'" }
    ' "$file" >> "$map_file"
done

conflict_found=false
while read -r link; do
    match=$(grep -F "$link" "$map_file" || true)
    if [[ -n "$match" ]]; then
        if [ "$conflict_found" = false ]; then
            echo "âŒ æ£€æµ‹åˆ°é‡å¤é“¾æ¥ï¼Œç¦æ­¢æäº¤ï¼š"
            conflict_found=true
        fi
        echo "  - $link   â† å·²å‡ºç°åœ¨ $(echo "$match" | head -n1 | cut -f2)"
    fi
done <<< "$new_links"

rm -f "$map_file"

if [ "$conflict_found" = true ]; then
    exit 1
fi

echo "âœ… é“¾æ¥æ£€æŸ¥é€šè¿‡ï¼Œç»§ç»­æäº¤ã€‚"
exit 0
```

3. å¯ä»¥æŠŠ pre-commit è„šæœ¬å­˜å…¥ç‰ˆæœ¬æ§åˆ¶ï¼Œä¾‹å¦‚ `.githooks/pre-commit` ï¼Œç„¶ååœ¨æœ¬åœ°ç”¨ï¼š

```Bash
git config core.hooksPath .githooks
```

è¿™æ ·æ‰€æœ‰ clone çš„äººéƒ½ä¼šè‡ªåŠ¨å¯ç”¨è¿™å¥— hookã€‚


## share [ğŸ”](#weekly-102)

[readme](../README.md) | [previous](202502W2.md) | [next](202502W4.md)
