> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2025-03-09 - 2025-03-15

# Weekly #105

[readme](../README.md) | [previous](202503W1.md) | [next](202503W3.md)

![](../images/2025/03/photo-nic-H3SStjMB7XY-unsplash.jpg "Weekly #105")

\**Photo by [photo nic](https://unsplash.com/@chiro) on [Unsplash](https://unsplash.com/photos/macro-shot-of-white-veil-H3SStjMB7XY)*

> ä»€ä¹ˆäººç«™åœ¨é©å‘½äººæ°‘æ–¹é¢ï¼Œä»–å°±æ˜¯é©å‘½æ´¾ï¼Œä»€ä¹ˆäººç«™åœ¨å¸å›½ä¸»ä¹‰å°å»ºä¸»ä¹‰å®˜åƒšèµ„æœ¬ä¸»ä¹‰æ–¹é¢ï¼Œä»–å°±æ˜¯åé©å‘½æ´¾ã€‚ä»€ä¹ˆäººåªæ˜¯å£å¤´ä¸Šç«™åœ¨é©å‘½äººæ°‘æ–¹é¢è€Œåœ¨è¡ŒåŠ¨ä¸Šåˆ™å¦æ˜¯ä¸€æ ·ï¼Œä»–å°±æ˜¯ä¸€ä¸ªå£å¤´é©å‘½æ´¾ï¼Œå¦‚æœä¸ä½†åœ¨å£å¤´ä¸Šè€Œä¸”åœ¨è¡ŒåŠ¨ä¸Šä¹Ÿç«™åœ¨é©å‘½äººæ°‘æ–¹é¢ï¼Œä»–å°±æ˜¯ä¸€ä¸ªå®Œå…¨çš„é©å‘½æ´¾ã€‚ â€”â€” åœ¨ä¸­å›½äººæ°‘æ”¿æ²»åå•†ä¼šè®®ç¬¬ä¸€å±Šå…¨å›½å§”å‘˜ä¼šç¬¬äºŒæ¬¡ä¼šè®®ä¸Šçš„é—­å¹•è¯ï¼ˆä¸€ä¹äº”é›¶å¹´å…­æœˆäºŒåä¸‰æ—¥ï¼‰ï¼Œä¸€ä¹äº”é›¶å¹´å…­æœˆäºŒåå››æ—¥ã€Šäººæ°‘æ—¥æŠ¥ã€‹

-[toc]

## algorithm [ğŸ”](#weekly-105)

## review [ğŸ”](#weekly-105)

### 1. [ã€ŠC++11ã€‹å„ç§åˆå§‹åŒ–æ–¹å¼çš„è¯¦ç»†åˆ—ä¸¾ä¸å¯¹æ¯”](https://lizhuo.blog.csdn.net/article/details/144970023)

#### 1. C++98/C++03 çš„åˆå§‹åŒ–æ–¹å¼

åœ¨ C++98 å’Œ C++03 ä¸­ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§åˆå§‹åŒ–æ–¹å¼ï¼š

1. ç›´æ¥åˆå§‹åŒ–ï¼ˆDirect Initializationï¼‰

ä½¿ç”¨æ„é€ å‡½æ•°ç›´æ¥åˆå§‹åŒ–å¯¹è±¡ã€‚

```C++
int a(5);
std::vector<int> v(5, 1);
```

2. å¤åˆ¶åˆå§‹åŒ–ï¼ˆCopy Initializationï¼‰

ä½¿ç”¨èµ‹å€¼æ“ä½œç¬¦ = è¿›è¡Œåˆå§‹åŒ–ã€‚

```C++
int b = 5;
std::vector<int> w = std::vector<int>(5, 1);
```

- 3. åŠ¨æ€åˆå§‹åŒ–ï¼ˆDynamic Initializationï¼‰

ä½¿ç”¨ `new` å…³é”®å­—åŠ¨æ€åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–å¯¹è±¡ã€‚

```C++
int* p = new int(5);
std::vector<int>* vec = new std::vector<int>(5, 1);
```

4. åˆ—è¡¨åˆå§‹åŒ–ï¼ˆList Initializationï¼‰

åœ¨ C++98/C++03 ä¸­å¹¶ä¸æ”¯æŒåˆ—è¡¨åˆå§‹åŒ–ï¼Œä½†å¯ä»¥ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–æ•°ç»„ã€‚

```C++
int arr[5] = {1, 2, 3, 4, 5};
```

#### 2. C++11 åŠä¹‹åçš„åˆå§‹åŒ–æ–¹å¼

C++11 å¼•å…¥äº†åˆ—è¡¨åˆå§‹åŒ–ï¼Œå¹¶å¯¹å…¶ä»–åˆå§‹åŒ–æ–¹å¼è¿›è¡Œäº†æ”¹è¿›ã€‚ä»¥ä¸‹æ˜¯ C++11 åŠä¹‹åçš„åˆå§‹åŒ–æ–¹å¼ï¼š

1. åˆ—è¡¨åˆå§‹åŒ–ï¼ˆList Initializationï¼‰

ä½¿ç”¨å¤§æ‹¬å· `{}` æ¥åˆå§‹åŒ–å¯¹è±¡ã€‚

```C++
int a = {5};
std::vector<int> v = {1, 2, 3};
```

å‘½ååˆ—è¡¨åˆå§‹åŒ–

å¯ä»¥ä¸ºå…ƒç»„æˆ–ç»“æ„ä½“çš„æˆå‘˜å‘½åï¼ˆC++20 æ”¯æŒï¼‰ã€‚

```C++
struct Point {
    int x;
    int y;
};

Point p = { .x = 1, .y = 2 };
```

2. ç›´æ¥åˆå§‹åŒ–ï¼ˆDirect Initializationï¼‰

C++11 ç»§ç»­æ”¯æŒç›´æ¥åˆå§‹åŒ–ã€‚

```C++
int a(5);
std::vector<int> v(5, 1);
```

3. å¤åˆ¶åˆå§‹åŒ–ï¼ˆCopy Initializationï¼‰

C++11 ç»§ç»­æ”¯æŒå¤åˆ¶åˆå§‹åŒ–ã€‚

```C++
int b = 5;
std::vector<int> w = {1, 2, 3};
```

4. åŠ¨æ€åˆå§‹åŒ–ï¼ˆDynamic Initializationï¼‰

C++11 ç»§ç»­æ”¯æŒåŠ¨æ€åˆå§‹åŒ–ã€‚

```C++
int* p = new int(5);
std::vector<int>* vec = new std::vector<int>{1, 2, 3};
```

5. ç»Ÿä¸€åˆå§‹åŒ–ï¼ˆUniform Initializationï¼‰

C++11 å¼•å…¥çš„ç»Ÿä¸€åˆå§‹åŒ–æ–¹å¼ï¼Œä½¿ç”¨å¤§æ‹¬å· `{}`ï¼Œå¯ä»¥ç”¨äºæ‰€æœ‰ç±»å‹çš„å¯¹è±¡ã€‚

```C++
int a{5};
std::vector<int> v{1, 2, 3};
```

6. åˆå§‹åŒ–ç±»çš„éé™æ€æˆå‘˜

åœ¨ç±»å®šä¹‰ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–æ¥åˆå§‹åŒ–éé™æ€æˆå‘˜ã€‚

```C++
struct Point {
    int x{0};
    int y{0};
};
```

7. ç»“æ„ä½“å’Œç±»çš„åˆå§‹åŒ–

C++11 å…è®¸ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–æ¥åˆå§‹åŒ–ç»“æ„ä½“å’Œç±»ã€‚

```C++
struct Point {
    int x;
    int y;
};

Point p{1, 2};
```

#### 3. å„ç§åˆå§‹åŒ–æ–¹å¼çš„å¯¹æ¯”

| åˆå§‹åŒ–æ–¹å¼ | C++98/C++03 | C++11 åŠä¹‹å |
|---|---|---|
| ç›´æ¥åˆå§‹åŒ– | âˆš | âˆš |
| å¤åˆ¶åˆå§‹åŒ– | âˆš | âˆš |
| åŠ¨æ€åˆå§‹åŒ– | âˆš | âˆš |
| åˆ—è¡¨åˆå§‹åŒ– | Ã— | âˆš |
| ç»Ÿä¸€åˆå§‹åŒ– | Ã— | âˆš |
| é˜²æ­¢çª„åŒ–è½¬æ¢ | Ã— | âˆš (ä»…åˆ—è¡¨åˆå§‹åŒ–) |
| åˆå§‹åŒ–ç±»çš„éé™æ€æˆå‘˜ | Ã— | âˆš (ä»…åˆ—è¡¨åˆå§‹åŒ–) |
| å‘½ååˆå§‹åŒ– | Ã— | âˆš (C++20) |

#### 4. æ·±å…¥ç†è§£ C++11 åŠä»¥åçš„æ–°ç‰¹æ€§

åœ¨ C++ ä¸­ï¼Œç‰¹åˆ«æ˜¯ C++11 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µæ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒä»¬å¸®åŠ©å¼€å‘è€…ç¼–å†™æ›´å®‰å…¨å’Œæ›´æ˜“äºç»´æŠ¤çš„ä»£ç ã€‚

1. é˜²æ­¢çª„åŒ–è½¬æ¢

å®šä¹‰ï¼šçª„åŒ–è½¬æ¢ï¼ˆNarrowing Conversionï¼‰æ˜¯æŒ‡å°†ä¸€ä¸ªè¾ƒå¤§èŒƒå›´çš„ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ªè¾ƒå°èŒƒå›´çš„ç±»å‹ï¼Œè¿™ç§è½¬æ¢å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä¾‹å¦‚ï¼Œå°† `double` è½¬æ¢ä¸º `int`ï¼Œæˆ–è€…å°† `long` è½¬æ¢ä¸º `short`ã€‚

ç¤ºä¾‹ï¼š

```C++
double d = 3.14;
int a = d;
```

åœ¨ C++11 ä¸­ï¼Œä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–ï¼ˆå¦‚ `{}`ï¼‰æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨çª„åŒ–è½¬æ¢ã€‚å¦‚æœå­˜åœ¨ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œä»è€Œé˜²æ­¢æ½œåœ¨çš„æ•°æ®ä¸¢å¤±ã€‚

```C++
int a = {3.14};
```

ä¼˜ç‚¹ï¼š

- å®‰å…¨æ€§ï¼šé˜²æ­¢äº†æ„å¤–çš„æ•°æ®ä¸¢å¤±ï¼Œå¢å¼ºäº†ä»£ç çš„å®‰å…¨æ€§ã€‚
- å¯è¯»æ€§ï¼šé€šè¿‡ç¼–è¯‘å™¨çš„é”™è¯¯æç¤ºï¼Œå¼€å‘è€…å¯ä»¥æ›´æ¸…æ™°åœ°äº†è§£æ½œåœ¨çš„é—®é¢˜ã€‚

2. åˆå§‹åŒ–ç±»çš„éé™æ€æˆå‘˜

å®šä¹‰ï¼šåœ¨ C++11 ä¸­ï¼Œå¯ä»¥åœ¨ç±»çš„å®šä¹‰ä¸­ç›´æ¥ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–æ¥åˆå§‹åŒ–éé™æ€æˆå‘˜å˜é‡ã€‚è¿™ç§æ–¹å¼ä½¿å¾—ç±»çš„æ„é€ æ›´åŠ ç®€æ´å’Œç›´è§‚ã€‚

ç¤ºä¾‹ï¼š

```C++
struct Point {
    int x{0};
    int y{0};
};

Point p;
```

ä¼˜ç‚¹ï¼š

- ç®€æ´æ€§ï¼šåœ¨ç±»å®šä¹‰ä¸­ç›´æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡ï¼Œå‡å°‘äº†æ„é€ å‡½æ•°çš„å¤æ‚æ€§ã€‚
- å¯è¯»æ€§ï¼šä½¿å¾—ç±»çš„é»˜è®¤çŠ¶æ€æ›´åŠ æ˜ç¡®ï¼Œä¾¿äºç†è§£ã€‚

3. å‘½ååˆå§‹åŒ–

å®šä¹‰ï¼šå‘½ååˆå§‹åŒ–ï¼ˆNamed Initializationï¼‰æ˜¯æŒ‡åœ¨åˆå§‹åŒ–ç»“æ„ä½“æˆ–ç±»æ—¶ï¼Œå¯ä»¥ä¸ºæˆå‘˜æŒ‡å®šåç§°ã€‚è¿™ç§ç‰¹æ€§åœ¨ C++20 ä¸­å¾—åˆ°äº†æ­£å¼æ”¯æŒï¼Œä½†åœ¨ C++11 ä¸­å¹¶æ²¡æœ‰ç›´æ¥çš„å‘½ååˆå§‹åŒ–è¯­æ³•ã€‚

ç¤ºä¾‹ï¼ˆC++20ï¼‰

```C++
struct Point {
    int x;
    int y;
};

Point p{.x = 1, .y = 2};
```

ä¼˜ç‚¹ï¼š

- å¯è¯»æ€§ï¼šé€šè¿‡ä¸ºæˆå‘˜å‘½åï¼Œä»£ç çš„å¯è¯»æ€§å¤§å¤§æé«˜ï¼Œç‰¹åˆ«æ˜¯åœ¨ç»“æ„ä½“æˆ–ç±»æœ‰å¤šä¸ªæˆå‘˜æ—¶ã€‚
- çµæ´»æ€§ï¼šå¯ä»¥åœ¨åˆå§‹åŒ–æ—¶åªæŒ‡å®šéƒ¨åˆ†æˆå‘˜ï¼ŒæœªæŒ‡å®šçš„æˆå‘˜ä¼šä½¿ç”¨é»˜è®¤å€¼ã€‚

æ³¨æ„ï¼šåœ¨ C++11 ä¸­ï¼Œè™½ç„¶æ²¡æœ‰ç›´æ¥çš„å‘½ååˆå§‹åŒ–è¯­æ³•ï¼Œä½†å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æˆ–å…¶ä»–æ–¹å¼å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚

### 2. [å¸¸è§è½¯ä»¶è®¾è®¡æ¨¡å¼ä»‹ç»ï¼šä¸‰å±‚æ¶æ„ã€MVCã€SSMã€EDDã€DDD](https://blog.csdn.net/footless_bird/article/details/144421357)

#### ä¸‰å±‚æ¶æ„ï¼ˆView Service Daoï¼‰

ä¸‰å±‚æ¶æ„æ˜¯æŒ‡ï¼šè§†å›¾å±‚ viewï¼ˆè¡¨ç°å±‚ï¼‰ï¼ŒæœåŠ¡å±‚ serviceï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰ï¼ŒæŒä¹…å±‚ Daoï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰

- è¡¨ç°å±‚ï¼šç›´æ¥è·Ÿå‰ç«¯æ‰“äº¤äº’ï¼ˆä¸€æ˜¯æ¥æ”¶å‰ç«¯ ajax è¯·æ±‚ï¼ŒäºŒæ˜¯è¿”å› json æ•°æ®ç»™å‰ç«¯ï¼‰
- ä¸šåŠ¡é€»è¾‘å±‚ï¼šä¸€æ˜¯å¤„ç†è¡¨ç°å±‚è½¬å‘è¿‡æ¥çš„å‰ç«¯è¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯å…·ä½“ä¸šåŠ¡ï¼‰ï¼ŒäºŒæ˜¯å°†ä»æŒä¹…å±‚è·å–çš„æ•°æ®è¿”å›åˆ°è¡¨ç°å±‚ã€‚
- æ•°æ®è®¿é—®å±‚ï¼šè´Ÿè´£æ•°æ®åº“çš„è®¿é—®ï¼ˆå¯ä»¥è®¿é—®æ•°æ®åº“ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€æ–‡æœ¬æ–‡ä»¶ç­‰ï¼‰ï¼Œæ˜¯å¯¹æ•°æ®åº“ï¼Œè€Œä¸æ˜¯å¯¹æ•°æ®çš„æ“ä½œï¼Œç›´æ¥æ“ä½œæ•°æ®åº“å®Œæˆ CRUDï¼Œå¹¶å°†è·å¾—çš„æ•°æ®è¿”å›åˆ°ä¸Šä¸€å±‚ï¼ˆä¹Ÿå°±æ˜¯ä¸šåŠ¡é€»è¾‘å±‚ï¼‰ã€‚

ä¸‰å±‚æ¶æ„çš„å‡ºç°æ˜¯ä¸ºäº†é™ä½è€¦åˆåº¦ã€‚

ä½¿ç”¨é¢å‘æŠ½è±¡ç¼–ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸Šå±‚å¯¹ä¸‹å±‚çš„è°ƒç”¨ï¼Œç›´æ¥é€šè¿‡æ¥å£æ¥å®Œæˆï¼Œè€Œä¸‹å±‚å¯¹ä¸Šå±‚çš„çœŸæ­£æœåŠ¡æä¾›è€…ï¼Œæ˜¯ä¸‹å±‚å®ç°çš„æ¥å£å®ç°ç±»ã€‚å®ç°ç±»æ˜¯å¯ä»¥æ›´æ¢çš„ï¼Œè¿™å°±å®ç°äº†å±‚é—´çš„è§£è€¦åˆã€‚

å®é™…é¡¹ç›®ä¸­çš„åŒ…å‘½åç»“æ„ï¼Œå…¶å®å°±æ˜¯ä¸‰å±‚æ¶æ„çš„ä½“ç°ï¼š

![](../images/2025/03/aa386c131278488f934559cbaab90ac2.png)

#### MVCï¼ˆModel View Controllerï¼‰

MVC æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­çš„ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ç§åˆ†ç¦»ä¸šåŠ¡é€»è¾‘ä¸æ˜¾ç¤ºç•Œé¢çš„è®¾è®¡æ–¹æ³•ï¼Œå®ƒæŠŠè½¯ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†ï¼šæ¨¡å‹ï¼ˆmodelï¼‰ã€è§†å›¾ï¼ˆviewï¼‰ã€æ§åˆ¶å™¨ï¼ˆcontrollerï¼‰

MVC æ¶æ„æä¾›äº†ä¸€ç§ç»“æ„åŒ–çš„æ–¹æ³•æ¥å¼€å‘è½¯ä»¶ï¼Œç‰¹åˆ«æ˜¯ Web åº”ç”¨ç¨‹åºï¼Œé€šè¿‡å°†ä¸šåŠ¡é€»è¾‘ã€ç”¨æˆ·ç•Œé¢å’Œç”¨æˆ·è¾“å…¥åˆ†ç¦»å¼€æ¥ï¼Œä»¥æé«˜ä»£ç çš„å¯é‡ç”¨æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

MVC æ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ï¼š

- æ¨¡å‹ï¼ˆModelï¼‰ï¼šè´Ÿè´£ç®¡ç†æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ï¼Œé€šå¸¸åŒ…æ‹¬æ•°æ®çš„å­˜å–å’Œä¸šåŠ¡è§„åˆ™çš„å¤„ç†ã€‚æ¨¡å‹ä¸è§†å›¾å’Œæ§åˆ¶å™¨åˆ†ç¦»ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚model ä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼š
    - æ•°æ®æ‰¿è½½ beanï¼šæ˜¯æŒ‡ä¸“é—¨æ‰¿è½½ä¸šåŠ¡æ•°æ®çš„å®ä½“ç±»ï¼Œæ¯”å¦‚ Studentï¼ŒUser ç­‰ã€‚
    - ä¸šåŠ¡æ‰¿è½½ beanï¼šæ˜¯æŒ‡è¿›è¡Œä¸šåŠ¡å¤„ç†çš„ Service æˆ–è€… Dao å¯¹è±¡ï¼Œä¸“é—¨å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ã€‚
- è§†å›¾ï¼ˆViewï¼‰ï¼šè´Ÿè´£å±•ç¤ºæ•°æ®ç»™ç”¨æˆ·ï¼Œé€šå¸¸æ˜¯é€šè¿‡ç”¨æˆ·ç•Œé¢å‘ˆç°ã€‚è§†å›¾ä»æ¨¡å‹ä¸­è·å–æ•°æ®ï¼Œä½†ä¸å¤„ç†æ•°æ®ã€‚
- æ§åˆ¶å™¨ï¼ˆControllerï¼‰ï¼šè´Ÿè´£å¤„ç†ç”¨æˆ·çš„è¾“å…¥ï¼Œæ§åˆ¶ç¨‹åºçš„æµç¨‹ã€‚æ§åˆ¶å™¨æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ï¼Œè°ƒç”¨æ¨¡å‹è·å–æ•°æ®ï¼Œç„¶åé€‰æ‹©åˆé€‚çš„è§†å›¾æ¥å±•ç¤ºæ•°æ®ã€‚

MVC æ¡†æ¶çš„ä¼˜åŠ¿ï¼š

- é«˜å†…èšä½è€¦åˆï¼šMVC æ¡†æ¶é€šè¿‡å°†åº”ç”¨ç¨‹åºåˆ†ä¸ºä¸‰ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†ï¼Œå‡å°‘äº†å„éƒ¨åˆ†ä¹‹é—´çš„ä¾èµ–ï¼Œæé«˜äº†ä»£ç çš„æ¨¡å—åŒ–å’Œé‡ç”¨æ€§ã€‚
- æ˜“äºç»´æŠ¤ï¼šç”±äºå„ä¸ªéƒ¨åˆ†èŒè´£æ˜ç¡®ï¼Œå½“éœ€è¦ä¿®æ”¹åŠŸèƒ½æ—¶ï¼Œåªéœ€å…³æ³¨ç›¸å…³çš„éƒ¨åˆ†ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–éƒ¨åˆ†ã€‚
- å¯æ‰©å±•æ€§ï¼šå½“éœ€è¦æ·»åŠ æ–°çš„åŠŸèƒ½æ—¶ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ç°æœ‰æ¶æ„ä¸Šæ·»åŠ æ–°çš„æ¨¡å‹ã€è§†å›¾æˆ–æ§åˆ¶å™¨ï¼Œè€Œä¸éœ€è¦é‡å†™æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚

#### SSMï¼ˆSpring SpringMVC MyBatisï¼‰

SSMï¼šå³ Spring ã€SpringMVCã€ä¸ MyBatis ä¸‰ä¸ªæ¡†æ¶ï¼š
- Springï¼šä»¥æ•´ä¸ªåº”ç”¨å¤§ç®¡å®¶çš„èº«ä»½å‡ºç°ã€‚æ•´ä¸ªåº”ç”¨ä¸­æ‰€æœ‰ Bean çš„ç”Ÿå‘½å‘¨æœŸè¡Œä¸ºï¼Œå‡ç”± Spring æ¥ç®¡ç†ã€‚å³æ•´ä¸ªåº”ç”¨ä¸­æ‰€æœ‰å¯¹è±¡çš„åˆ›å»ºã€åˆå§‹åŒ–ã€é”€æ¯ï¼ŒåŠå¯¹è±¡é—´å…³è”å…³ç³»çš„ç»´æŠ¤ï¼Œå‡ç”± Spring è¿›è¡Œç®¡ç†ã€‚
- SpringMVCï¼šä½œä¸º Controller å±‚çš„å®ç°è€…ï¼Œå®Œæˆç”¨æˆ·çš„è¯·æ±‚æ¥æ”¶åŠŸèƒ½ã€‚SpringMVC çš„ Controller ä½œä¸ºæ•´ä¸ªåº”ç”¨çš„æ§åˆ¶å™¨ï¼Œå®Œæˆç”¨æˆ·è¯·æ±‚çš„è½¬å‘åŠå¯¹ç”¨æˆ·çš„å“åº”ã€‚Spring MVC æ˜¯ä¸»æµçš„ Web æ¡†æ¶ã€‚
- MyBatisï¼šä½œä¸º Dao å±‚çš„å®ç°è€…ï¼Œå®Œæˆå¯¹æ•°æ®åº“çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥åŠŸèƒ½

#### EDDï¼ˆEvent Driven Designï¼‰

äº‹ä»¶é©±åŠ¨è®¾è®¡ï¼ˆEvent Driven Designï¼ŒEDDï¼‰æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡èŒƒå¼ï¼Œå…¶ä¸­ç¨‹åºçš„æ‰§è¡Œæµç”±å¤–éƒ¨äº‹ä»¶ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ã€ç³»ç»Ÿä¿¡å·ã€ç½‘ç»œæ•°æ®ç­‰ï¼‰æ¥å†³å®šã€‚è¿™ç§è®¾è®¡æ–¹æ³•å¹¿æ³›åº”ç”¨äºå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰ã€ç½‘ç»œæœåŠ¡å™¨ã€å®æ—¶ç³»ç»Ÿç­‰é¢†åŸŸï¼Œæ—¨åœ¨æé«˜ç³»ç»Ÿçš„å“åº”èƒ½åŠ›å’Œçµæ´»æ€§ã€‚

äº‹ä»¶é©±åŠ¨è®¾è®¡æ˜¯ä¸€ç§å¼ºå¤§ä¸”çµæ´»çš„è®¾è®¡æ¨¡å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤„ç†å¤§é‡å¼‚æ­¥æ“ä½œå’Œå®æ—¶æ•°æ®æµçš„ç³»ç»Ÿã€‚é€šè¿‡è§£è€¦ç»„ä»¶ã€æé«˜çµæ´»æ€§å’Œå“åº”æ€§ï¼Œäº‹ä»¶é©±åŠ¨è®¾è®¡å¯ä»¥å¸®åŠ©æ„å»ºé«˜æ•ˆã€å¯æ‰©å±•çš„åº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼Œå®ƒä¹Ÿå¸¦æ¥äº†å¤æ‚æ€§å’Œè°ƒè¯•å›°éš¾ç­‰æŒ‘æˆ˜ï¼Œéœ€è¦åœ¨è®¾è®¡å’Œå®ç°æ—¶ä»”ç»†æƒè¡¡ã€‚

äº‹ä»¶é©±åŠ¨è®¾è®¡çš„æ ¸å¿ƒè¦ç´ ï¼š

- äº‹ä»¶æºï¼ˆEvent Sourceï¼‰ï¼šäº§ç”Ÿäº‹ä»¶çš„å¯¹è±¡æˆ–ç³»ç»Ÿç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·ç‚¹å‡»æŒ‰é’®ã€ä¼ æ„Ÿå™¨æ•°æ®æ›´æ–°ç­‰ã€‚
- äº‹ä»¶ï¼ˆEventï¼‰ï¼šè¡¨ç¤ºç³»ç»Ÿä¸­å‘ç”Ÿçš„ä¸€ä¸ªæœ‰æ„ä¹‰çš„å˜åŒ–æˆ–åŠ¨ä½œã€‚ä¾‹å¦‚ï¼Œé¼ æ ‡ç‚¹å‡»äº‹ä»¶ã€é”®ç›˜è¾“å…¥äº‹ä»¶ç­‰ã€‚
- äº‹ä»¶é˜Ÿåˆ—ï¼ˆEvent Queueï¼‰ï¼šç”¨äºå­˜å‚¨æœªå¤„ç†çš„äº‹ä»¶ï¼Œç¡®ä¿äº‹ä»¶æŒ‰ç…§å‘ç”Ÿçš„é¡ºåºè¢«å¤„ç†ã€‚
- äº‹ä»¶ç›‘å¬å™¨ï¼ˆEvent Listenerï¼‰ï¼šå¯¹ç‰¹å®šäº‹ä»¶æ„Ÿå…´è¶£çš„å¯¹è±¡ï¼Œè´Ÿè´£å¤„ç†äº‹ä»¶ã€‚ä¾‹å¦‚ï¼ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶çš„å¤„ç†å‡½æ•°ã€‚
- äº‹ä»¶è°ƒåº¦å™¨ï¼ˆEvent Schedulerï¼‰ï¼šè´Ÿè´£ä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºäº‹ä»¶å¹¶åˆ†æ´¾ç»™ç›¸åº”çš„äº‹ä»¶ç›‘å¬å™¨ã€‚
- å›è°ƒå‡½æ•°ï¼ˆCallback Functionï¼‰ï¼šäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¼šè°ƒç”¨é¢„å…ˆæ³¨å†Œçš„å›è°ƒå‡½æ•°æ¥å¤„ç†äº‹ä»¶ã€‚

äº‹ä»¶é©±åŠ¨è®¾è®¡çš„ä¼˜ç‚¹ï¼š

- æé«˜å“åº”èƒ½åŠ›ï¼šäº‹ä»¶é©±åŠ¨è®¾è®¡ä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿå¿«é€Ÿå“åº”å¤–éƒ¨äº‹ä»¶ï¼Œæé«˜äº†ç”¨æˆ·ä½“éªŒã€‚
- è§£è€¦ç»„ä»¶ï¼šäº‹ä»¶é©±åŠ¨è®¾è®¡é€šè¿‡äº‹ä»¶å’Œç›‘å¬å™¨çš„æœºåˆ¶ï¼Œè§£è€¦äº†äº‹ä»¶å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è”ç³»ï¼Œä½¿å¾—ç³»ç»Ÿç»„ä»¶æ›´åŠ ç‹¬ç«‹å’Œå¯é‡ç”¨ã€‚
- ç®€åŒ–å¹¶å‘å¤„ç†ï¼šäº‹ä»¶é©±åŠ¨è®¾è®¡é€šå¸¸é‡‡ç”¨å•çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯æ¥å¤„ç†äº‹ä»¶ï¼Œé¿å…äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„å¤æ‚æ€§å’Œæ½œåœ¨çš„æ­»é”é—®é¢˜ã€‚
- æ˜“äºæ‰©å±•ï¼šç”±äºç»„ä»¶ä¹‹é—´çš„ä½è€¦åˆæ€§ï¼Œæ–°çš„ç»„ä»¶å¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼Œåªè¦å®ƒä»¬èƒ½å¤Ÿäº§ç”Ÿæˆ–å¤„ç†ç›¸åº”çš„äº‹ä»¶ã€‚è¿™ä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿæ–¹ä¾¿åœ°é€‚åº”ä¸æ–­å˜åŒ–çš„ä¸šåŠ¡éœ€æ±‚ã€‚

äº‹ä»¶é©±åŠ¨è®¾è®¡çš„åº”ç”¨åœºæ™¯ï¼š
- å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰ï¼šå‡ ä¹æ‰€æœ‰ç°ä»£ GUI æ¡†æ¶ï¼ˆå¦‚ Qtã€Java Swingã€WPF ç­‰ï¼‰éƒ½é‡‡ç”¨äº†äº‹ä»¶é©±åŠ¨è®¾è®¡ã€‚
- ç½‘ç»œæœåŠ¡å™¨ï¼šè®¸å¤šé«˜æ€§èƒ½ç½‘ç»œæœåŠ¡å™¨ï¼ˆå¦‚ Node.js ã€Nginx ç­‰ï¼‰é‡‡ç”¨äº‹ä»¶é©±åŠ¨è®¾è®¡æ¥å¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚
- æ¸¸æˆå¼€å‘ï¼šæ¸¸æˆä¸­çš„è®¸å¤šäº¤äº’å’ŒåŠ¨ç”»æ•ˆæœéƒ½ä¾èµ–äºäº‹ä»¶é©±åŠ¨è®¾è®¡ã€‚
- åµŒå…¥å¼ç³»ç»Ÿï¼šè®¸å¤šåµŒå…¥å¼ç³»ç»Ÿï¼ˆå¦‚æ™ºèƒ½å®¶å±…è®¾å¤‡ã€å·¥ä¸šæ§åˆ¶ç³»ç»Ÿç­‰ï¼‰é‡‡ç”¨äº‹ä»¶é©±åŠ¨è®¾è®¡æ¥å¤„ç†å®æ—¶äº‹ä»¶ã€‚

#### DDDï¼ˆDomain Driven Designï¼‰

DDD æ˜¯é€šè¿‡ **é¢†åŸŸåˆ’åˆ†** å’Œ **é¢†åŸŸå»ºæ¨¡** ç­‰ä¸€äº›åˆ—æ‰‹æ®µæ¥æ§åˆ¶è½¯ä»¶å¤æ‚åº¦çš„æ–¹æ³•è®ºï¼Œä¸»è¦æ˜¯ç”¨æ¥æŒ‡å¯¼å¦‚ä½•è§£è€¦ä¸šåŠ¡ç³»ç»Ÿï¼Œåˆ’åˆ†ä¸šåŠ¡æ¨¡å—ï¼Œå®šä¹‰ä¸šåŠ¡é¢†åŸŸæ¨¡å‹åŠå…¶äº¤äº’ã€‚

å¼€å‘è¿‡ç¨‹ä¸å†ä»¥æ•°æ®æ¨¡å‹ä¸ºèµ·ç‚¹ï¼Œè€Œæ˜¯ä»¥é¢†åŸŸæ¨¡å‹ä¸ºå‡ºå‘ç‚¹ï¼Œé¢†åŸŸæ¨¡å‹å¯¹åº”ä¸šåŠ¡å®ä½“ã€‚

ç¨‹åºä¸­ä¸»è¦è¡¨ç°ä¸ºç±»ã€èšåˆæ ¹å’Œå€¼å¯¹è±¡ï¼Œæ›´åŠ å…³æ³¨ä¸šåŠ¡è¯­ä¹‰çš„æ˜¾æ€§åŒ–è¡¨è¾¾ï¼Œè€Œä¸æ˜¯æ•°æ®çš„å­˜å‚¨å’Œæ•°æ®ä¹‹é—´çš„å…³ç³»ã€‚

é¢†åŸŸé©±åŠ¨çš„ç ”å‘è¿‡ç¨‹ä¸ºï¼šéœ€æ±‚åˆ†æ ----> é¢†åŸŸåˆ†æ ----> é¢†åŸŸå»ºæ¨¡ ----> æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ ----> æŠ€æœ¯ç»†èŠ‚ï¼ˆDBã€Cacheã€Message...ï¼‰

æ•°æ®é©±åŠ¨çš„ç ”å‘è¿‡ç¨‹ä¸ºï¼šéœ€æ±‚åˆ†æ ----> æ•°æ®å»ºæ¨¡ï¼ˆER å›¾ï¼‰ ----> å»ºåº“å»ºè¡¨ï¼Œå†™ DAO å±‚ ----> ç¼–å†™ä¸šåŠ¡é€»è¾‘

#### DDD å’Œ MVC å¯¹æ¯”

- DDD æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œä¾§é‡é¢†åŸŸæ‹†åˆ†ï¼ŒMVC æ˜¯è½¯ä»¶æ¶æ„è®¾è®¡ï¼Œä¾§é‡ä»£ç æ‹†åˆ†ã€‚è¿™ä¸¤ä¸ªæ˜¯ä¸åŒè§’åº¦æè¿°ä¸åŒé—®é¢˜çš„ï¼Œå®Œå…¨å¯ä»¥ååŒå·¥ä½œï¼Œæ²¡æœ‰è°æ›¿ä»£è°ä¸€è¯´ã€‚è¿™ä¸¤è€…éƒ½æ˜¯é€šç”¨çš„è·¨è¯­è¨€çš„è½¯ä»¶æ¶æ„æ€æƒ³ã€‚
- ç°åœ¨çš„å¾®æœåŠ¡éƒ½æ˜¯æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†çš„ï¼Œå®ƒä»¬å¯ä»¥æ‹†å‡ºæ¥å¤ç”¨ï¼Œç”šè‡³åšä¸­å°ï¼Œå¹¿ä¹‰æ¥è¯´ä¹Ÿå¯ä»¥ç®—æ˜¯é¢†åŸŸæ‹†åˆ†ï¼Œæ˜¯ä¸€ç§ DDD çš„æ€æƒ³ã€‚
- MVC æ˜¯æŠ€æœ¯å±‚é¢åŸºäºåˆ†å±‚çš„è½¯ä»¶æ¶æ„ï¼Œæ˜¯ä¸€ç§èŒƒå¼ä»£ç åˆ†å±‚

#### å®ä½“ç±»ï¼šVOã€DTOã€POã€DOã€Form

- VOï¼ˆView Objectï¼‰ï¼šè§†å›¾å¯¹è±¡ï¼Œä¸»è¦å¯¹åº”ç•Œé¢æ˜¾ç¤ºçš„æ•°æ®å¯¹è±¡ã€‚å¯¹äºä¸€ä¸ª WEB é¡µé¢ï¼Œæˆ–è€… SWTã€SWING çš„ä¸€ä¸ªç•Œé¢ï¼Œç”¨ä¸€ä¸ª VO å¯¹è±¡å¯¹åº”æ•´ä¸ªç•Œé¢çš„å€¼ã€‚
- DTOï¼ˆData Transfer Objectï¼‰ï¼šæ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œä¸»è¦ç”¨äºè¿œç¨‹è°ƒç”¨ç­‰éœ€è¦å¤§é‡ä¼ è¾“å¯¹è±¡çš„åœ°æ–¹ã€‚æ¯”å¦‚ä¸€å¼ è¡¨æœ‰ 100 ä¸ªå­—æ®µï¼Œé‚£ä¹ˆå¯¹åº”çš„ PO å°±æœ‰ 100 ä¸ªå±æ€§ã€‚ä½†æ˜¯ç•Œé¢ä¸Šåªè¦æ˜¾ç¤º 10 ä¸ªå­—æ®µï¼Œå®¢æˆ·ç«¯ç”¨ WEB service æ¥è·å–æ•°æ®ï¼Œæ²¡æœ‰å¿…è¦æŠŠæ•´ä¸ª PO å¯¹è±¡ä¼ é€’åˆ°å®¢æˆ·ç«¯ï¼Œè¿™æ—¶å°±å¯ä»¥ç”¨åªæœ‰è¿™ 10 ä¸ªå±æ€§çš„ DTO æ¥ä¼ é€’ç»“æœåˆ°å®¢æˆ·ç«¯ï¼Œè¿™æ ·ä¹Ÿä¸ä¼šæš´éœ²æœåŠ¡ç«¯è¡¨ç»“æ„ã€‚åˆ°è¾¾å®¢æˆ·ç«¯ä»¥åï¼Œå¦‚æœç”¨è¿™ä¸ªå¯¹è±¡æ¥å¯¹åº”ç•Œé¢æ˜¾ç¤ºï¼Œé‚£æ­¤æ—¶å®ƒçš„èº«ä»½å°±è½¬ä¸º VOã€‚åœ¨è¿™é‡Œï¼Œæ³›æŒ‡ç”¨äºå±•ç¤ºå±‚ä¸æœåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯¹è±¡ã€‚
- DOï¼ˆDomain Objectï¼‰ï¼šé¢†åŸŸå¯¹è±¡ï¼Œå°±æ˜¯ä»ç°å®ä¸–ç•Œä¸­æŠ½è±¡å‡ºæ¥çš„æœ‰å½¢æˆ–æ— å½¢çš„ä¸šåŠ¡å®ä½“ã€‚
- POï¼ˆPersistent Objectï¼‰ï¼šæŒä¹…åŒ–å¯¹è±¡ï¼Œå®ƒè·ŸæŒä¹…å±‚ï¼ˆé€šå¸¸æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼‰çš„æ•°æ®ç»“æ„å½¢æˆä¸€ä¸€å¯¹åº”çš„æ˜ å°„å…³ç³»ï¼Œå¦‚æœæŒä¹…å±‚æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œé‚£ä¹ˆï¼Œæ•°æ®è¡¨ä¸­çš„æ¯ä¸ªå­—æ®µï¼ˆæˆ–è‹¥å¹²ä¸ªï¼‰å°±å¯¹åº” PO çš„ä¸€ä¸ªï¼ˆæˆ–è‹¥å¹²ä¸ªï¼‰å±æ€§ã€‚æœ€å½¢è±¡çš„ç†è§£å°±æ˜¯ä¸€ä¸ª PO å°±æ˜¯æ•°æ®åº“ä¸­çš„ä¸€æ¡è®°å½•ï¼Œå¥½å¤„æ˜¯å¯ä»¥æŠŠä¸€æ¡è®°å½•ä½œä¸ºä¸€ä¸ªå¯¹è±¡å¤„ç†ï¼Œå¯ä»¥æ–¹ä¾¿çš„è½¬ä¸ºå…¶å®ƒå¯¹è±¡ã€‚
- Form ï¼šè¡¨å•å¯¹è±¡ï¼Œä¸€èˆ¬ç”¨äºåœ¨ Controller å±‚æ¥æ”¶å‰ç«¯å‚æ•°ã€‚

### 3. [å¸¸è§é™æµç®—æ³•æ€»ç»“](https://blog.csdn.net/mydearlarry/article/details/144171890)

å¸¸è§çš„é™æµç®—æ³•å¦‚ä¸‹ï¼š

- è®¡æ•°å™¨é™æµç®—æ³•
- æ»‘åŠ¨çª—å£é™æµç®—æ³•
- æ¼æ¡¶ç®—æ³•
- ä»¤ç‰Œæ¡¶ç®—æ³•

#### ä¸€ã€è®¡æ•°å™¨é™æµç®—æ³•

ç®—æ³•æ¦‚è¿°ï¼šå®šä¹‰ä¸€ä¸ªæ—¶é—´çª—å£å’Œæœ€å¤§çš„è¯·æ±‚æ•°ï¼Œç»Ÿè®¡åœ¨æ—¶é—´çª—å£å†…çš„è¯·æ±‚æ•°é‡ï¼Œå¦‚æœè¶…è¿‡äº†æœ€å¤§è¯·æ±‚æ•°å°±ä¼šè§¦å‘é™æµã€‚

ä»£ç å®ç°ï¼š

```JAVA
private final static int MAX_COUNT = 20; //å•ä½æ—¶é—´å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ•°é‡
private final static long TIME_WINDOW = 1000L;//å•ä½æ—¶é—´
private long timestamp = System.currentTimeMillis();//å½“å‰æ—¶é—´
private int count = 0;


@Override
public synchronized boolean limit() {
    long now = System.currentTimeMillis();
    if(timestamp + TIME_WINDOW > now){
        //åœ¨æ—¶é—´çª—å£å†…ï¼Œåˆ¤æ–­è¯·æ±‚æ•°é‡æ˜¯å¦è¶…è¿‡é™åˆ¶
        return ++count > MAX_COUNT;
    }else{
        //å¼€å¯ä¸€ä¸ªæ–°çš„è®¡æ•°çª—å£
        timestamp = System.currentTimeMillis();
        count = 1;
    }
    return false;
}
```

é—®é¢˜åˆ†æï¼š

è¿™ç§å›ºå®šçª—å£çš„å®ç°æœ€ç®€å•ï¼Œä½†æ˜¯å­˜åœ¨çš„é—®é¢˜ä¹Ÿæœ€æ˜æ˜¾ã€‚å…³é”®ç‚¹åœ¨äºä»–çš„çª—å£æ˜¯å›ºå®šçš„ï¼Œæ— æ³•å¤„ç†åœ¨ **çª—å£è¾¹ç•Œ** å¤„çš„æµé‡ã€‚å‡æƒ³ä¸€ä¸‹å¦‚æœè¯·æ±‚å‘ç”Ÿåœ¨å‰ä¸€ä¸ªçª—å£çš„ååŠæ®µå’Œåä¸€ä¸ªçª—å£çš„å‰åŠæ®µï¼Œä»–ä»¬åœ¨å„è‡ªçš„çª—å£å†…éƒ½æ²¡æœ‰è¶…è¿‡æœ€å¤§è¯·æ±‚æ•°ï¼Œä½†æ˜¯åŠ åœ¨ä¸€èµ·å¯èƒ½è¾¾åˆ° 2N å€çš„è¯·æ±‚ã€‚å¦‚ä¸‹å›¾å‰ 1s æœ€åè¯·æ±‚é‡ 100ï¼Œå 1s å¼€å§‹è¯·æ±‚é‡ä¹Ÿæ˜¯ 100ï¼Œä»–ä»¬åœ¨å„è‡ªçš„çª—å£å†…éƒ½æ²¡æœ‰è¶…è¿‡ 100ï¼Œä½†æ˜¯åŠ åœ¨ä¸€èµ·è¾¾åˆ°äº† 200.

![](../images/2025/03/a9121ccfd5c64cba948a958734aae750.png)

æ‰€ä»¥è¿™ç§é™æµå®ç°ï¼Œå¾ˆå°‘ç”¨åœ¨å®é™…çš„ç”Ÿäº§ä¸­ï¼Œä»–çš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†å¼•å‡ºæ»‘åŠ¨çª—å£é™æµç®—æ³•ã€‚

#### äºŒã€æ»‘åŠ¨çª—å£é™æµç®—æ³•

ç®—æ³•æ¦‚è¿°ï¼šä¸ºäº†è§£å†³å›ºå®šçª—å£è¾¹ç•Œçš„é—®é¢˜ï¼Œæ»‘åŠ¨çª—å£ç»Ÿè®¡çš„æ—¶é—´çª—å£ä¸å†æ˜¯å›ºå®šçš„ï¼Œä»–ä¼šåœ¨æ–°çš„è¯·æ±‚åˆ°æ¥çš„æ—¶å€™åŠ¨æ€çš„è®¡ç®—ä¸€ä¸ªæ—¶é—´çª—å£ï¼Œä¹Ÿå°±æ˜¯ ï¼ˆå½“å‰è¯·æ±‚æ—¶é—´ - çª—å£æ—¶é—´ï¼‰ï¼Œæ¥å®ç°çª—å£çš„åŠ¨æ€æ»‘åŠ¨æ›´æ–°ã€‚

è¿™é‡Œæä¾›çº¯ JAVA å’Œ Redis+Lua ä¸¤ç§å®ç°æ–¹å¼ã€‚å…¶ä¸­çº¯ JAVA å®ç°é€‚ç”¨äºå•ä½“æœåŠ¡ï¼Œè€Œ Redis æ›´é€‚ç”¨äºåˆ†å¸ƒå¼æœåŠ¡ã€‚

1. JAVA å®ç°

å®šä¹‰ä¸€ä¸ªåŒç«¯é˜Ÿåˆ— Deque<Long>ï¼Œé˜Ÿåˆ—ä¸­å­˜æ”¾çš„æ˜¯æ¯ä¸ªè¯·æ±‚å‘ç”Ÿçš„æ—¶é—´ã€‚æ¯å½“æœ‰æ–°çš„è¯·æ±‚å‘ç”Ÿçš„æ—¶å€™ï¼Œå…ˆè®¡ç®—å½“å‰çš„çª—å£ï¼ˆnow - TIME_WINDOWï¼‰ï¼Œå°†çª—å£ä¹‹å¤–çš„è¯·æ±‚å‡ºé˜Ÿã€‚ç„¶åå†ç»Ÿè®¡çª—å£å†…çš„è¯·æ±‚æ•°é‡æ˜¯å¦è¶…è¿‡æœ€å¤§å€¼ã€‚

```Java
//æ—¶é—´çª—å£
private final static long TIME_WINDOW = 1000L;
//å•ä½æ—¶é—´å†…çš„æœ€å¤§è®¿é—®é‡
private final static int MAX_COUNT = 20;
//å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¾è¯·æ±‚
private final Deque<Long> requestQueue = new LinkedList<>();


@Override
public synchronized boolean limit() {
    long now = System.currentTimeMillis();
    long startTime = now - TIME_WINDOW;
    while(!requestQueue.isEmpty() && requestQueue.peekFirst() < startTime){
        //æ’é™¤åœ¨çª—å£å¤–çš„è¯·æ±‚
        requestQueue.pollFirst();
    }

    int curReqCount = requestQueue.size();
    if (++curReqCount > MAX_COUNT){
        return true;
    }
    requestQueue.addLast(now);
    return false;
}
```

2. Redis å®ç°

åŸºäº redis ä¸­çš„ zset æ•°æ®ç»“æ„ï¼ŒåŸç†å’Œä¸Šé¢ä¸€æ ·ã€‚ æ¯å½“æœ‰è¯·æ±‚è¿›æ¥çš„æ—¶å€™

1. å…ˆè®¡ç®—æ–°çª—å£ï¼Œåˆ é™¤çª—å£å‰çš„æ•°æ®ï¼Œè¿™é‡Œç”¨çš„æ˜¯ zremrangeByScore æ–¹æ³•ã€‚ å…¶ä¸­ score å­˜çš„æ˜¯æ¯ä¸ªè¯·æ±‚çš„æ—¶é—´ `redis.call('zremrangeByScore', KEYS[1], 0, tonumber(ARGV[2])-tonumber(ARGV[1]))`
2. åˆ¤æ–­è¯·æ±‚æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼Œå¦‚æœè¶…è¿‡ç›´æ¥æ‹’ç»ï¼Œå¦‚æœæ²¡æœ‰å°±è°ƒç”¨ zadd æ–¹æ³•å°†è¯·æ±‚æ·»åŠ çš„ set ä¸­ã€‚
3. å°† redis æ“ä½œéƒ½å°è£…åˆ° LUA è„šæœ¬ä¸­ï¼Œä¿è¯äº†æ“ä½œçš„åŸå­æ€§ã€‚

```JAVA
@Autowired
private StringRedisTemplate redisTemplate;
//LUAè„šæœ¬
private static DefaultRedisScript<Long> redisScript;
//æ—¶é—´çª—å£
private final static long TIME_WINDOW = 1000L;
//å•ä½æ—¶é—´å†…çš„æœ€å¤§è®¿é—®é‡
private final static int MAX_COUNT = 3;

static {
    redisScript = new DefaultRedisScript<>();
    redisScript.setResultType(Long.class);
    redisScript.setScriptSource(new ResourceScriptSource(new ClassPathResource("limit.lua")));
}

@Override
public boolean limit() {
    //å¯ä»¥æ ¹æ®ä¸šåŠ¡æ¥è®¾å®šå”¯ä¸€çš„key
    String key = "UNIQUE_BY_BUSINESS";
    //å½“å‰è¯·æ±‚æ—¶é—´
    long now = System.currentTimeMillis();
    //valueä¸è¦ç›´æ¥è®¾ç½®ä¸ºå½“å‰æ—¶é—´æˆ³ï¼Œé«˜å¹¶å‘çš„æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´åˆ†æ•°ä¸€æ ·ï¼Œè€Œseté›†åˆä¸­é‡å¤çš„å…ƒç´ æ˜¯ä¼šè¦†ç›–çš„ï¼Œå¯¼è‡´ç»Ÿè®¡çš„è¯·æ±‚æ•°å°‘äºå®é™…çš„
    //å¯ä»¥é‡‡ç”¨é›ªèŠ±ç®—æ³•æˆ–è€…UUID
    //hutoolå·¥å…·ç±»æä¾›çš„é›ªèŠ±ç®—æ³•
    long value = IdUtil.getSnowflake().nextId();
    try {
        Long res = redisTemplate.execute(redisScript, Collections.singletonList(key), String.valueOf(TIME_WINDOW), String.valueOf(now), String.valueOf(MAX_COUNT), String.valueOf(value));
        return Objects.nonNull(res) && res.intValue() == 1;
    } catch (Exception e) {
        //redisæŒ‚äº†æˆ–è€…luaæ‰§è¡Œå‡ºé”™äº†ï¼Œ éœ€è¦ç³»ç»Ÿå‘Šè­¦ï¼Œè¿™é‡Œå…ˆæ”¾è¡Œ
        System.out.println("execute lua fail ====" + e.getCause());
        return false;
    }
}
```

```Lua
--KEYS[1]: key
--ARGV[1]: çª—å£
--ARGV[2]: å½“å‰æ—¶é—´æˆ³score
--ARGV[3]: é˜ˆå€¼
--ARGV[4]: scoreValue
--1.åˆ é™¤å¼€å§‹çª—å£å‰çš„æ•°æ®
redis.call('zremrangeByScore', KEYS[1], 0, tonumber(ARGV[2])-tonumber(ARGV[1]))
--2.ç»Ÿè®¡å½“å‰å…ƒç´ æ•°é‡
local res = redis.call('zcard', KEYS[1])
--3.æ˜¯å¦è¶…è¿‡é˜ˆå€¼
if (res == nil) or (res < tonumber(ARGV[3])) then
    redis.call('zadd', KEYS[1], ARGV[2], ARGV[4])
    redis.call('expire', KEYS[1], tonumber(ARGV[1])/1000)
    return 0
else
    return 1
end
```

#### ä¸‰ã€æ¼æ¡¶ç®—æ³•

æ¼æ¡¶ç®—æ³•ï¼Œå°†è¯·æ±‚æ”¾åˆ°ä¸€ä¸ªæ¡¶ä¸­ï¼Œæ¡¶ä»¥å›ºå®šçš„é€Ÿç‡æ”¾å‡ºè¯·æ±‚ï¼Œè¶…è¿‡æ¡¶å®¹é‡çš„è¯·æ±‚å°†è¢«æ‹’ç»ã€‚

- ä¼˜ç‚¹ï¼šç¨³å®šçš„æµé‡æ§åˆ¶ï¼Œæ˜“äºå®ç°ã€‚
- ç¼ºç‚¹ï¼šç¼ºä¹å¼¹æ€§ï¼Œæ— æ³•åº”å¯¹çªå‘æµé‡ã€‚

é€‚ç”¨äºç¨³å®šæµé‡å¤„ç†ï¼Œä¸”å¯¹çªå‘æµé‡è¦æ±‚ä¸é«˜ã€‚æ¯”å¦‚è§†é¢‘æµçš„ä¼ è¾“ï¼Œä»¥æ’å®šé€Ÿç‡è¿›è¡Œä¼ è¾“é¿å…å¡é¡¿ã€‚

#### å››ã€ä»¤ç‰Œæ¡¶ç®—æ³•

æ¯ä¸ªè¯·æ±‚åˆ°çš„æ—¶å€™ä¼šå…ˆå°è¯•ä»ä»¤ç‰Œæ¡¶ä¸­è·å–ä»¤ç‰Œï¼Œå¦‚æœè·å–æˆåŠŸæ”¾è¡Œï¼Œå¤±è´¥åˆ™é™æµã€‚ä»¤ç‰Œä»¥ä¸€å®šçš„é€Ÿç‡æ·»åŠ ï¼Œå¯ä»¥è‡ªå·±æ§åˆ¶æ·»åŠ ä»¤ç‰Œçš„é€Ÿåº¦ï¼Œä½¿å¾—é™æµæ›´åŠ å¹³æ»‘ã€‚

- ä¼˜ç‚¹ï¼šçµæ´»æ€§é«˜ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•å¯ä»¥æ ¹æ®å®é™…æƒ…å†µåŠ¨æ€è°ƒæ•´ç”Ÿæˆä»¤ç‰Œçš„é€Ÿç‡ï¼Œä»è€Œå®ç°è¾ƒé«˜ç²¾åº¦çš„é™æµã€‚

æ¯”å¦‚ Sentinel ä¸­çš„é¢„çƒ­æ¨¡å¼é™æµå°±æ˜¯é‡‡ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•æ¥å®ç°çš„ï¼Œé€‚ç”¨äºç³»ç»Ÿåˆšå¯åŠ¨çš„æ—¶å€™éœ€è¦åˆ›å»ºå„ç§èµ„æºï¼Œæ­¤æ—¶å¹¶å‘èƒ½åŠ›ç›¸å¯¹è¾ƒå·®ï¼Œç­‰åç»­ç³»ç»Ÿç¨³å®šåå¹¶å‘èƒ½åŠ›ä¼šé€æ¸æå‡ã€‚è¿™æ—¶å€™åªè¦æ§åˆ¶å¼€å§‹çš„æ—¶å€™ä»¤ç‰Œç”Ÿæˆçš„é€Ÿåº¦æ…¢ä¸€äº›ï¼Œç­‰ç³»ç»Ÿç¨³å®šååœ¨æå‡ä»¤ç‰Œç”Ÿæˆé€Ÿåº¦ã€‚

Redisson å’Œ guava ä¸­éƒ½æœ‰ä»¤ç‰Œæ¡¶ç®—æ³•çš„å®ç°ï¼Œå¯ä»¥ç›´æ¥ç”¨

Redisson å®ç°

```Java
<dependency>
    <groupId>org.redisson</groupId>
    <artifactId>redisson</artifactId>
    <version>3.27.2</version>
</dependency>
```

```Java
//å¼•å…¥redissonå®¢æˆ·ç«¯
@Bean
public RedissonClient redissonClient(){

    Config config = new Config();
    config.useSingleServer().setAddress("redis://ip:port").setPassword("password");
    return Redisson.create(config);
}


//å…·ä½“å®ç°
@Autowired
private RedissonClient redissonClient;

private RRateLimiter rateLimiter;
//å•ä½æ—¶é—´å†…æ·»åŠ ä»¤ç‰Œçš„é€Ÿåº¦
private static final long RATE = 3;
//æ—¶é—´é—´éš”
private static final long INTERVAL = 1;

@PostConstruct
public void init(){
    rateLimiter = redissonClient.getRateLimiter("uniqueKey");
    rateLimiter.setRate(RateType.OVERALL, RATE, INTERVAL, RateIntervalUnit.SECONDS);
}


@Override
public boolean limit() {
    return !rateLimiter.tryAcquire();
}
```

Guava å®ç°

```Java
<dependency>
    <groupId>com.google.guava</groupId>
    <artifactId>guava</artifactId>
    <version>33.3.1-jre</version>
</dependency>
```

```Java
private RateLimiter rateLimiter;

@PostConstruct
public void init(){
    rateLimiter = RateLimiter.create(3);
}

@Override
public boolean limit() {
    return !rateLimiter.tryAcquire();
}
```

## tip [ğŸ”](#weekly-105)

## share [ğŸ”](#weekly-105)

[readme](../README.md) | [previous](202503W1.md) | [next](202503W3.md)
