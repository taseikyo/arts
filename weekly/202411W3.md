> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2024-11-17 - 2024-11-23

# Weekly #89

[readme](../README.md) | [previous](202411W2.md) | [next](202411W4.md)

![](../images/2024/11/yusuf-onuk-d94ltt7Zesk-unsplash.jpg "Weekly #89")

\**Photo by [Yusuf Onuk](https://unsplash.com/@onkysf) on [Unsplash](https://unsplash.com/photos/persons-hand-on-blue-ocean-water-during-daytime-d94ltt7Zesk)*

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
	- Instagram çš„æ—©æœŸæ¶æ„ï¼ˆè‹±æ–‡ï¼‰
- [tip](#tip-)
	- å¦‚ä½•æŸ¥çœ‹ Linux ç³»ç»Ÿçš„å®‰è£…æ—¶é—´ï¼ˆè‹±æ–‡ï¼‰
	- WSL å¿˜è®° root å¯†ç ï¼ˆUbuntuï¼‰
- [share](#share-)

## algorithm [ğŸ”](#weekly-89)

## review [ğŸ”](#weekly-89)

### 1. [Instagram çš„æ—©æœŸæ¶æ„ï¼ˆè‹±æ–‡ï¼‰](https://read.engineerscodex.com/p/how-instagram-scaled-to-14-million)

ä» 2010 å¹´ 10 æœˆåˆ° 2011 å¹´ 12 æœˆï¼ŒInstagram åœ¨ä»…ä»…ä¸€å¹´çš„æ—¶é—´å†…ä» 0 åˆ° 1400 ä¸‡ç”¨æˆ·ï¼ŒæœŸé—´ä»…æœ‰ 3 ä½å·¥ç¨‹å¸ˆã€‚

ä»–ä»¬é€šè¿‡éµå¾ª3ä¸ªå…³é”®åŸåˆ™å¹¶æ‹¥æœ‰å¯é çš„æŠ€æœ¯å †æ ˆæ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚

- ä¿æŒäº‹æƒ…éå¸¸ç®€å•
- ä¸è¦é‡æ–°å‘æ˜è½®å­
- å°½å¯èƒ½ä½¿ç”¨ç»è¿‡éªŒè¯çš„æŠ€æœ¯

> - Keep things very simple.
>
> - Donâ€™t re-invent the wheel.
>
> - Use proven, solid technologies when possible.

Instagram æ—©æœŸæ˜¯ç§Ÿç”¨ AWS çš„ EC2 æœåŠ¡å™¨ã€‚

1ã€å‰ç«¯

Instagram 2010 å‘å¸ƒï¼Œï¼Œè€Œ Swift äº 2014 æ‰å‘å¸ƒï¼Œæ‰€ä»¥å¯ä»¥å‡è®¾ Instagram æ˜¯ä½¿ç”¨ Objective-C å’Œ Uikit ç­‰å…¶ä»–å†…å®¹ç»„åˆç¼–å†™çš„ã€‚

![](../images/2024/11/b1f72ce0-1963-4176-a493-517a1788a277_374x395.png)

2ã€è´Ÿè½½å‡è¡¡

Instagram ä½¿ç”¨äº†äºšé©¬é€Šçš„å¼¹æ€§è´Ÿè½½å¹³è¡¡å™¨ï¼Œä»–ä»¬æœ‰ 3 ä¸ª NGINX å®ä¾‹ã€‚

![](../images/2024/11/c2e2b88d-751d-4c2c-b87e-95cd90aef20e_642x395.png)

3ã€åç«¯

Instagram çš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä½¿ç”¨äº† Djangoï¼Œå®ƒæ˜¯ç”¨ Python ç¼–å†™çš„ï¼Œå°† Gunicorn ä½œä¸º WSGI æœåŠ¡å™¨ã€‚

WSGIï¼ˆWeb Server Gateway Interfaceï¼‰å°†è¯·æ±‚ä»WebæœåŠ¡å™¨è½¬å‘åˆ°Webåº”ç”¨ç¨‹åºã€‚

Instagram ä½¿ç”¨ Fabric åœ¨è®¸å¤šå®ä¾‹ä¸ŠåŒæ—¶åŒæ—¶è¿è¡Œå‘½ä»¤ã€‚

![](../images/2024/11/d644ba96-4f13-4fe2-8e9f-e01cdec85171_1005x395.png)

4ã€æ•°æ®åº“

Postgress

5ã€å›¾ç‰‡å­˜å‚¨

Amazon S3 & Cloudfront

6ã€ç¼“å­˜

redis & memcached

redis ç”¨æ¥å­˜å‚¨ å›¾ç‰‡ ID åˆ°ç”¨æˆ· ID çš„æ˜ å°„ï¼Œmemcached ç”¨æ¥ç¼“å­˜æ•°æ®åº“è¯»åˆ°çš„æ•°æ®

![](../images/2024/11/96c6476f-b900-4591-a672-295048bda0a4_1466x597.png)

7ã€push æ¨é€ & å¼‚æ­¥ä»»åŠ¡

push é€šçŸ¥æ˜¯ä½¿ç”¨ PYAPN å‘é€çš„ã€‚PYAPNS æ˜¯ä¸€ç§å¼€æºçš„ï¼Œé€šç”¨çš„ Apple Push Notification Serviceï¼ˆAPNSï¼‰æä¾›å•†ã€‚

å¼‚æ­¥ä»»åŠ¡ä½¿ç”¨ [Gearman](https://gearman.org/)ï¼Œ Gearman ç”¨äºå¤šä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œä¾‹å¦‚å‘æ‰€æœ‰ç”¨æˆ·çš„å…³æ³¨è€…æ¨å‡ºæ´»åŠ¨ï¼ˆå¦‚å‘å¸ƒçš„æ–°ç…§ç‰‡ï¼‰

![](../images/2024/11/b586cf1d-c74f-4166-abe3-c143c54c4151_682x678.png)

8ã€ç›‘æ§æŠ¥è­¦

- Instagram ä½¿ç”¨ Sentryï¼ˆå¼€æº Django åº”ç”¨ç¨‹åºï¼‰å®æ—¶ç›‘è§† Python é”™è¯¯
- Munin ç”¨äºç»˜åˆ¶æ•´ä¸ªç³»ç»ŸèŒƒå›´çš„æŒ‡æ ‡å¹¶æé†’å¼‚å¸¸ã€‚Instagram æœ‰ä¸€å †è‡ªå®šä¹‰çš„ Munin æ’ä»¶æ¥è·Ÿè¸ªåº”ç”¨ç¨‹åºçº§åˆ«çš„æŒ‡æ ‡ï¼Œä¾‹å¦‚æ¯ç§’å‘å¸ƒçš„ç…§ç‰‡
- pingdom ç”¨äºå¤–éƒ¨æœåŠ¡ç›‘æ§
- Pagerduty ç”¨äºå¤„ç†äº‹ä»¶å’Œé€šçŸ¥

9ã€æ€»ä½“æ¶æ„

![](../images/2024/11/a279781f-8c76-4e67-8a63-6b9930d1a48c_1984x937.png)

## tip [ğŸ”](#weekly-89)

### 1. [å¦‚ä½•æŸ¥çœ‹ Linux ç³»ç»Ÿçš„å®‰è£…æ—¶é—´ï¼ˆè‹±æ–‡ï¼‰](https://linuxiac.com/how-to-find-linux-os-installation-date)

ä½¿ç”¨ `stat / | awk '/Birth: /{print $2 " " substr($3,1,5)}'` å‘½ä»¤å³å¯æŸ¥çœ‹å®‰è£… Linux ç³»ç»Ÿçš„ç¡®åˆ‡æ—¥æœŸï¼š

```bash
taseikyo at Polaris in /mnt/d/Github/arts (w89)
$ stat / | awk '/Birth: /{print $2 " " substr($3,1,5)}'
2024-12-07 19:30
```

å¦‚æœæƒ³ç®€å•ç‚¹ï¼Œç›´æ¥ç”¨ `stat /` å‘½ä»¤å¹¶æŸ¥çœ‹â€œBirthâ€è¡Œï¼š

```bash
taseikyo at Polaris in /mnt/d/Github/arts (w89â—â—)
$ stat /
  File: /
  Size: 4096            Blocks: 8          IO Block: 4096   directory
Device: 8,32    Inode: 2           Links: 22
Access: (0755/drwxr-xr-x)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2025-03-22 12:52:45.883003957 +0800
Modify: 2025-03-22 12:52:44.703003950 +0800
Change: 2025-03-22 12:52:44.703003950 +0800
 Birth: 2024-12-07 19:30:24.000000000 +0800
```

å¦ä¸€ä¸ªæ–¹æ³•æ˜¯ `fsname=$(df / | tail -1 | cut -f1 -d' ') && tune2fs -l $fsname | grep 'created'` ï¼Œä½†æ˜¯éœ€è¦å…ˆåˆ‡æ¢ä¸º root ç”¨æˆ·ï¼š

```bash
root@Polaris:/mnt/d/Github/arts# fsname=$(df / | tail -1 | cut -f1 -d' ') && tune2fs -l $fsname | grep 'created'
Filesystem created:       Sat Dec  7 19:30:24 2024
```

ä¸‹é¢æ˜¯å„ç§å‘è¡Œç‰ˆè‡ªå·±çš„å‘½ä»¤ï¼š

- Debian / Ubuntu

```bash
sudo head -n1 /var/log/installer/syslog
```

- Fedora / Rocky Linux / AlmaLinux

```bash
sudo rpm -qi basesystem | grep -i "install date"
```

- Arch Linux

```bash
head -n1 /var/log/pacman.log
```

### 2. [WSL å¿˜è®° root å¯†ç ï¼ˆUbuntuï¼‰](https://blog.csdn.net/weixin_45100742/article/details/140101405)

1ã€é—®é¢˜æè¿°

Windows ä¸‹çš„ WSLï¼ˆUbuntuï¼‰å¿˜è®°äº† root å¯†ç ï¼Œæ— æ³•ä½¿ç”¨ç®¡ç†å‘˜æƒé™ã€‚

2ã€è§£å†³æ–¹æ³•

- å…³é—­ Ubuntu çª—å£ã€‚
- æ‰“å¼€ Windows çš„ Powershell æˆ– cmdï¼Œ ä»¥ root é»˜è®¤ç™»é™† WSLã€‚

```bash
wsl -u root
```

- ä¿®æ”¹å¯†ç 

```bash
passwd
```

- è¾“å…¥å¯†ç ï¼Œç¡®è®¤å¯†ç ï¼Œä¿®æ”¹æˆåŠŸã€‚

## share [ğŸ”](#weekly-89)

[readme](../README.md) | [previous](202411W2.md) | [next](202411W4.md)
