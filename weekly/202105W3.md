> @Author  : Lewis Tian (taseikyo@gmail.com)
>
> @Link    : github.com/taseikyo
>
> @Range   : 2021-05-16 - 2021-05-22

# Weekly #29

[readme](../README.md) | [previous](202105W2.md) | [next](202105W4.md)

## Table of Contents

- [algorithm](#algorithm-)
- [review](#review-)
    - ä¸‹ä¸€ä»£å›¾ç‰‡æ ¼å¼ï¼šAVIF
- [tip](#tip-)
    - AirPodsPro å£°éŸ³å°çš„è§£å†³åŠæ³•
    - Git ä»“åº“æ¸…ç†ç˜¦èº«
- [share](#share-)

## algorithm [ğŸ”](#weekly-29)

## review [ğŸ”](#weekly-29)

### 1. [ä¸‹ä¸€ä»£å›¾ç‰‡æ ¼å¼ï¼šAVIF](https://darekkay.com/blog/avif-images)

è¿™ç¯‡æ–‡ç« ä»‹ç»äº† AVIFï¼ˆAV1 Image File Formatï¼‰æ ¼å¼å›¾ç‰‡ï¼Œæ®è¯´æ˜¯ä¸‹ä¸€ä»£å›¾ç‰‡æ ¼å¼ï¼Œå‹ç¼©ç‡æé«˜ï¼Œæ¯” webp è¿˜é«˜ã€‚

| æ ¼å¼ | å¤§å° | å›¾ç‰‡ |
|:-:|:-:|:-:|
| JPEG | 30 kB | ![](../images/2021/05/cow.jpg) |
| WebP | 15 kB | ![](../images/2021/05/cow.webp) |
| AVIF | 11 kB | <picture><source type="image/avif" srcset="../images/2021/05/cow.avif" /><img src="../images/2021/05/format-not-supported.png" alt="Cow" /></picture> |

å¦‚æœä¸Šé¢ç¬¬ä¸‰ä¸ªå›¾ç‰‡æ˜¾ç¤ºçš„ä¸æ˜¯ç‰›ï¼Œå°±è¡¨ç¤ºä½ æ­£åœ¨ç”¨çš„æµè§ˆå™¨ä¸æ”¯æŒã€‚

æ¯”å¦‚åœ¨æˆ‘çœ‹çš„æ—¶å€™ Edge è¿˜ä¸æ”¯æŒï¼Œæ¢æˆ Chrome å°±å¥½äº†ã€‚

webp å’Œ avif æ ¼å¼ç›¸å¯¹äº jpeg åˆ†åˆ«å‡å°‘äº† 50% å’Œ 63%ã€‚

æœ‰å‡ ç§å°†å…¶ä»–æ ¼å¼å›¾ç‰‡æ¢æˆ AVIF æ ¼å¼å›¾ç‰‡çš„æ–¹æ³•ï¼š

- [Squoosh](https://squoosh.app/)

å¾ˆå¥½ç”¨çš„ä¸€ä¸ªå›¾ç‰‡æ ¼å¼è½¬åŒ–ç½‘ç«™ï¼Œæˆ‘ä¹‹å‰ç”¨è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œè¿˜å¯ä»¥å‹ç¼©å›¾ç‰‡ï¼Œä¸æ„§æ˜¯è°·æ­Œå‡ºå“ã€‚

- [Squoosh CLI](https://www.npmjs.com/package/@squoosh/cli)

```Bash
squoosh-cli --avif '{speed: 2}' cow.jpg
```

*speed* å‚æ•°è¶Šå°ä¼šä½¿è½¬æ¢é€Ÿåº¦è¶Šæ…¢ï¼Œä½†æ–‡ä»¶å¤§å°ä¼šæ›´å°ã€‚

- [ImageMagick](https://imagemagick.org/index.php)

```Bash
convert -quality 75 cow.jpg cow.avif
```

ä¸€ä¸ªæ¸è¿›å¼å¢å¼ºï¼ˆProgressive enhancementï¼‰çš„ä¾‹å­ï¼š

æˆªè‡³ 2021 å¹´ 4 æœˆï¼ŒWebP çš„å…¨çƒä½¿ç”¨ç‡ä¸º 93%ï¼ŒAVIF ä¸º 63%ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªå‘åå…¼å®¹çš„åŠŸèƒ½ï¼Œä¸ºä¸æ”¯æŒçš„æµè§ˆå™¨æä¾›ä¸€ä¸ªå›é€€ã€‚

```HTML
<picture>
  <source type="image/avif" srcset="cow.avif" />
  <source type="image/webp" srcset="cow.webp" />
  <img src="cow.jpg" srcset="cow.png" alt="Cow" />
</picture>
```

æµè§ˆå™¨å°†ä»ä¸Šåˆ°ä¸‹åŒ¹é…æ ¼å¼ï¼Œå¹¶ä½¿ç”¨å®ƒæ”¯æŒçš„ç¬¬ä¸€ä¸ªæ ¼å¼ã€‚AVIF è¢«åˆ—ä¸ºç¬¬ä¸€ç§æ ¼å¼ï¼Œå› ä¸ºå®ƒæä¾›æœ€å¥½çš„å‹ç¼©ã€‚

å¦‚æœæµè§ˆå™¨å®Œå…¨ä¸æ”¯æŒ `<picture>`ï¼ˆIE11ï¼šä½ çœ‹æˆ‘å¹²å˜›ï¼Ÿï¼‰ï¼Œæ‰€æœ‰çš„ `<source>` æ¡ç›®å°†è¢«å¿½ç•¥ï¼ŒJPEG `<img>` å°†è¢«ä½œä¸ºåå¤‡ã€‚è¿™å°±æ˜¯æ¸è¿›å¼å¢å¼ºçš„ä¸€ä¸ªå®Œç¾ä¾‹å­ã€‚

## tip [ğŸ”](#weekly-29)

### 1. AirPodsPro å£°éŸ³å°çš„è§£å†³åŠæ³•

ç¬¬äºŒæ¬¡é‡åˆ°äº†ï¼Œç´¢æ€§åšä¸ªè®°å½•å§ï¼Œè§£å†³æ–¹æ³•æ¥è‡ªé…·å®‰ï¼š

![](../images/2021/05/1620374097677.jpg)

### 2. [Git ä»“åº“æ¸…ç†ç˜¦èº«](https://www.cnblogs.com/bushuosx/archive/2004/01/13/10965485.html)

1ã€æ‰¾å‡ºå¤§æ–‡ä»¶æˆ–è¯¯æ·»åŠ çš„æ–‡ä»¶

```Bash
git rev-list --objects --all | grep "$(git verify-pack -v .git/objects/pack/*.idx | sort -k 3 -n | tail -5 | awk '{print $1}')"
```

2ã€ä»ä»“åº“ä¸­åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹

åˆ æ–‡ä»¶ï¼Œå°† bigfile æ¢æˆä¸Šé¢æ‰¾å‡ºçš„æ–‡ä»¶å

```Bash
git filter-branch --force --index-filter \
  'git rm --cached --ignore-unmatch "bigfile"' \
  --prune-empty -- --all
```

åˆ æ–‡ä»¶å¤¹ï¼Œå°† wrongdir æ¢æˆä¸Šé¢æ‰¾å‡ºçš„æ–‡ä»¶å¤¹

```Bash
git filter-branch --force --index-filter \
  'git rm -r --cached --ignore-unmatch "wrongdir"' \
  --prune-empty -- --all
```

3ã€åˆ é™¤ç¼“å­˜çš„å¯¹è±¡

è¿™ä¸€æ­¥å¯ä»¥æš‚æ—¶è·³è¿‡ï¼Œç­‰åˆ°ç¡®è®¤å®Œå…¨ä¸ä¼šå‡ºç°é—®é¢˜ä¹‹åå†æ‰§è¡Œã€‚ï¼ˆè¿™äº›ç¼“å­˜å¯¹è±¡ç»™ä½ æä¾›äº†æ’¤é”€æ“ä½œçš„ä¸€æ¬¡æœºä¼šï¼‰ã€‚

```Bash
git for-each-ref --format='delete %(refname)' refs/original | git update-ref --stdin
git reflog expire --expire=now --all
git gc --prune=now
```

4ã€å¼ºåˆ¶æ›´æ–°è¿œç¨‹ä»“åº“

(è¿™ä¸€æ­¥æ‰§è¡Œäº†ï¼Œå°±çœŸæ²¡æ•‘äº†ã€‚è¯·ç¡®è®¤å·²å¤‡ä»½ã€‚)

```Bash
git push --force --verbose --dry-run
git push --force
```

## share [ğŸ”](#weekly-29)

[readme](../README.md) | [previous](202105W2.md) | [next](202105W4.md)
